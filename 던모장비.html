<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„¸íŠ¸ ì¥ë¹„ ì¡°íšŒ ì‹œìŠ¤í…œ</title>
  <style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f4f4f9;
}

h1 {
  color: #333;
}

h2 {
  margin-top: 30px;
  color: #444;
}

.set-group {
  margin-bottom: 20px;
}

.set-list {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.set-list button {
  padding: 8px 12px;
  border: none;
  background: #4a90e2; /* ê¸°ë³¸ íŒŒë€ìƒ‰ */
  color: white;
  border-radius: 5px;
  cursor: pointer;
}

/* íŒŒë€ ë²„íŠ¼ hover */
.set-list button:hover {
  background: #357ab8; /* ì¡°ê¸ˆ ë” ì§„í•œ íŒŒë€ìƒ‰ */
}

/* íŒŒë€ ë²„íŠ¼ í´ë¦­(active) */
.set-list button:active {
  background: #2a5d99; /* ë” ì§„í•œ íŒŒë€ìƒ‰ */
}

/* íšŒìƒ‰ ë²„íŠ¼ */
.set-list button.disabled {
  background: #999; /* ê¸°ë³¸ íšŒìƒ‰ */
  cursor: pointer;
}

/* íšŒìƒ‰ ë²„íŠ¼ hover */
.set-list button.disabled:hover {
  background: #777; /* hover ì‹œ ì§„í•œ íšŒìƒ‰ */
}

/* íšŒìƒ‰ ë²„íŠ¼ í´ë¦­(active) */
.set-list button.disabled:active {
  background: #555; /* í´ë¦­ ì‹œ ë” ì§„í•œ íšŒìƒ‰ */
}

#result {
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
}

th {
  background: #eee;
}


  </style>
</head>
<body>
  <h1>ì„¸íŠ¸ ì¥ë¹„ ì¡°íšŒ ì‹œìŠ¤í…œ</h1>

  <!-- CSV íŒŒì¼ ì„ íƒ -->
  <input type="file" id="csvFile" accept=".csv">
  
  <button onclick="saveCSV()">CSV ì €ì¥</button>


  <!-- ë°©ì–´êµ¬ -->
  <div class="set-group">
    <h2>[ë°©ì–´êµ¬]</h2>
    <div class="set-list" id="armorButtons"></div>
  </div>

  <!-- ì•…ì„¸ -->
  <div class="set-group">
    <h2>[ì•…ì„¸]</h2>
    <div class="set-list" id="accButtons"></div>
  </div>

  <!-- íŠ¹ì¥ -->
  <div class="set-group">
    <h2>[íŠ¹ì¥]</h2>
    <div class="set-list" id="specialButtons"></div>
  </div>

  <!-- ê²°ê³¼ ì¶œë ¥ -->
  <div id="result">CSV íŒŒì¼ì„ ì„ íƒí•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>

  <script>
    const armorSets = [
      "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ","í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë”","ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì•„ì´ì–¸",
      "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì","ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ","ìŠ¤í‹°í‚¤ ì• ì‹œë“œ ì›¨í€",
      "ì„¬ëœ©í•œ ê°•ì²  ìš©","ìµìŠ¤í”Œë¡œì‹œë¸Œ ë²„ë‹ ìŠ¤í†¤","ë¹›ì˜ í—Œì‹ ì",
      "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ì","ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€","ê·¸ë€í…Œ ì „íˆ¬ê¸°ê°‘ íŒŒì¸ "
    ];
    const accSets = [
      "ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ","ì„¬ëœ©í•œ ë¹›ì˜ ê´€ë¦¬ì","ë¶€ì‹ëœ ë©”íƒˆê¸°ì–´",
      "í™”ë ¥ ê°œì¡° íƒ„ë ","ì‹ ë¹„ë¡œìš´ ë¹›ì˜ ì†Œìš©ëŒì´","ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ ì—°ì‚°ì¥ì¹˜"
    ];
    const specialSets = [
      "ê°œêµ¬ìŸì´ í˜¸ë¬¸ì¿¨ë£¨ìŠ¤","ë¼ì´íŠ¸ë‹ ì—ë„ˆì§€ ì½”ì–´","ì² ê°‘ì„ ë‘ë¥¸ íƒ‘ì˜ ìˆ˜í˜¸ê¾¼",
      "ê¹Šì€ ë¶ˆêµ¬ë©ì´ì˜ ì„¬ë©¸ì","í—ˆì˜ ì† ì–´ë‘ ì˜ í”¼ì¡°ë¬¼","ë¶€ì •í•œ ë¹›ì˜ ìš°ìƒ"
    ];

    let data = [];

    // CSV íŒŒì‹±
    function parseCSV(csv) {
      const lines = csv.trim().split("\n");
      const headers = lines[0].split(",").map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim() : "");
        ["P1","P2","P3","P4","P5"].forEach(p => obj[p] = parseInt(obj[p]) || 0);
        return obj;
      });
    }

    // ë²„íŠ¼ ìƒì„±
function createButtons(setNames, containerId, type) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  setNames.forEach(setName => {
    const btn = document.createElement("button");
    btn.textContent = setName;
    btn.classList.add("disabled"); // ê¸°ë³¸ íšŒìƒ‰
    btn.onclick = () => showSet(setName, type);

    const filtered = data.filter(d => d.Set === setName);
    let partKeys = (type === "armor") ? ["P1","P2","P3","P4","P5"] : ["P1","P2","P3"];

    let nonZeroCount = 0;
    for (let key of partKeys) {
      const sum = filtered.reduce((acc, d) => acc + d[key], 0);
      if (sum > 0) nonZeroCount++;
    }

    let threeSetCount = 0, fiveSetCount = 0;
    if (type === "armor") {
      filtered.forEach(d => {
        const partsOwned = partKeys.filter(k => d[k] > 0).length;
        if (partsOwned >= 3 && partsOwned < 5) threeSetCount++;
        if (partsOwned === 5) fiveSetCount++;
      });
      // ğŸ”¹ ë°©ì–´êµ¬: xê°œ ì œê±° â†’ (y/z)ë§Œ í‘œì‹œ
      btn.textContent = `${setName} (${threeSetCount}/${fiveSetCount})`;
      if (nonZeroCount === 5) btn.classList.remove("disabled");
    } else {
      // ğŸ”¹ ì•…ì„¸/íŠ¹ì¥: nê°œ ì œê±° â†’ ì¡°ê±´ë§Œ í‘œì‹œ
      const fullOwnedCount = filtered.filter(d => partKeys.every(k => d[k] > 0)).length;
      btn.textContent = `${setName} (${fullOwnedCount})`;
      if (nonZeroCount === partKeys.length) btn.classList.remove("disabled");
    }

    container.appendChild(btn);
  });
}



    // ì„¸íŠ¸ ì¶œë ¥
    function showSet(setName, type) {
      const filtered = data.filter(d => d.Set === setName);
      const visible = filtered.map(d => ({ d, idx: data.indexOf(d) }))
        .filter(x => x.d.P1+x.d.P2+x.d.P3+x.d.P4+x.d.P5 > 0);

      let html = `<h2>${setName} ë³´ìœ  í˜„í™©</h2>`;
      if (visible.length === 0) {
        html += `<p>ë³´ìœ  ì—†ìŒ</p>`;
      } else {
        const makeCell = (x, key) => `
          <td>
            <button class="part-btn" data-type="${type}" data-index="${x.idx}" data-key="${key}" data-delta="-1">-</button>
            <span style="color:blue; font-weight:bold">${x.d[key] > 0 ? x.d[key] : ""}</span>
            <button class="part-btn" data-type="${type}" data-index="${x.idx}" data-key="${key}" data-delta="1">+</button>
          </td>`;

        if (type === "armor") {
          html += `<table><tr><th>ìºë¦­í„°</th><th>ì§ì—…</th>
            <th>ìƒì˜</th><th>í•˜ì˜</th><th>ì–´ê¹¨</th><th>ë²¨íŠ¸</th><th>ì‹ ë°œ</th></tr>`;
          visible.forEach(x => {
            const owned = ["P1","P2","P3","P4","P5"].filter(k => x.d[k] > 0).length;
            let rowColor = "";
            if (owned >= 3 && owned < 5) rowColor = "background-color:#fefeeb;";
            else if (owned === 5) rowColor = "background-color:#ffff99;";
            html += `<tr style="${rowColor}">
              <td>${x.d.Name}</td><td>${x.d.Class}</td>
              ${makeCell(x,"P1")}
              ${makeCell(x,"P2")}
              ${makeCell(x,"P3")}
              ${makeCell(x,"P4")}
              ${makeCell(x,"P5")}
            </tr>`;
          });
        } else if (type === "acc") {
          html += `<table><tr><th>ìºë¦­í„°</th><th>ì§ì—…</th>
            <th>íŒ”ì°Œ</th><th>ëª©ê±¸ì´</th><th>ë°˜ì§€</th></tr>`;
          visible.forEach(x => {
            const owned = ["P1","P2","P3"].filter(k => x.d[k] > 0).length;
            let rowColor = owned === 3 ? "background-color:#ffff99;" : "";
            html += `<tr style="${rowColor}">
              <td>${x.d.Name}</td><td>${x.d.Class}</td>
              ${makeCell(x,"P1")}
              ${makeCell(x,"P2")}
              ${makeCell(x,"P3")}
            </tr>`;
          });
        } else if (type === "special") {
          html += `<table><tr><th>ìºë¦­í„°</th><th>ì§ì—…</th>
            <th>ê·€ê±¸ì´</th><th>ë§ˆë²•ì„</th><th>ë³´ì¥</th></tr>`;
          visible.forEach(x => {
            const owned = ["P1","P2","P3"].filter(k => x.d[k] > 0).length;
            let rowColor = owned === 3 ? "background-color:#ffff99;" : "";
            html += `<tr style="${rowColor}">
              <td>${x.d.Name}</td><td>${x.d.Class}</td>
              ${makeCell(x,"P1")}
              ${makeCell(x,"P2")}
              ${makeCell(x,"P3")}
            </tr>`;
          });
        }
        html += `</table>`;
      }
      document.getElementById("result").innerHTML = html;
    }

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ìœ„ì„ (ì¦ê° ì²˜ë¦¬)
    document.getElementById("result").addEventListener("click", function(e) {
      const btn = e.target.closest(".part-btn");
      if (!btn) return;

      const idx = parseInt(btn.dataset.index, 10);
      const key = btn.dataset.key;
      const delta = parseInt(btn.dataset.delta, 10);
      const type = btn.dataset.type;

      const target = data[idx];
      if (!target) return;

      // íƒ€ì…ë³„ í—ˆìš© í‚¤ í™•ì¸
      const allowedKeys = type === "armor" ? ["P1","P2","P3","P4","P5"] : ["P1","P2","P3"];
      if (!allowedKeys.includes(key)) return;

      target[key] = Math.max(0, (parseInt(target[key], 10) || 0) + delta);

      // ë‹¤ì‹œ ë Œë”ë§
      showSet(target.Set, type);
      createButtons(armorSets, "armorButtons", "armor");
      createButtons(accSets, "accButtons", "acc");
      createButtons(specialSets, "specialButtons", "special");
    });

    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    document.getElementById("csvFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const text = event.target.result;
        data = parseCSV(text);

        // ë²„íŠ¼ ê·¸ë£¹ ìƒì„±
        createButtons(armorSets, "armorButtons", "armor");
        createButtons(accSets, "accButtons", "acc");
        createButtons(specialSets, "specialButtons", "special");

        document.getElementById("result").innerHTML = "ì„¸íŠ¸ë¥¼ í´ë¦­í•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
      };
      reader.readAsText(file);
    });
	
	
	// ë°ì´í„°ë¥¼ csvë¡œ ë³€í™˜
	function convertToCSV(data) {
	if (data.length === 0) return "";
	
	const headers = Object.keys(data[0]);
	const rows = data.map(obj => headers.map(h => obj[h]).join(","));
	return [headers.join(","), ...rows].join("\n");
	}

	// csv ì €ì¥
function saveCSV() {
  const csvContent = convertToCSV(data);

  // ì˜¤ëŠ˜ ë‚ ì§œì™€ ì‹œê°„ êµ¬í•˜ê¸° (YYYY-MM-DD_HH:MM:SS í˜•ì‹)
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, "0");
  const day = String(now.getDate()).padStart(2, "0");
  const hours = String(now.getHours()).padStart(2, "0");
  const minutes = String(now.getMinutes()).padStart(2, "0");
  const seconds = String(now.getSeconds()).padStart(2, "0");

  const dateStr = `${year}-${month}-${day}_${hours}${minutes}${seconds}`;

  // íŒŒì¼ëª…: dnfm_backup_YYYY-MM-DD_HH:MM:SS.csv
  const fileName = `dnfm_backup_${dateStr}.csv`;

  const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);

  const link = document.createElement("a");
  link.setAttribute("href", url);
  link.setAttribute("download", fileName);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}





  </script>
</body>
</html>