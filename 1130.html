<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„¸íŠ¸ ì¥ë¹„ ì¡°íšŒ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f9;
    }
    h1 { color: #333; }
    h2 { margin-top: 30px; color: #444; }
    .set-group { margin-bottom: 20px; }
    .set-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .set-list button {
      padding: 8px 12px;
      border: none;
      background: #4a90e2;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .set-list button:hover { background: #357ab8; }
    .set-list button.disabled {
      background: #999;
      cursor: pointer; /* ğŸš« ëŒ€ì‹  ì¼ë°˜ í¬ì¸í„° */
    }
    #result {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
    }
    th { background: #eee; }

    /* íšŒìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ë°˜ì§ì„ íš¨ê³¼ */
    .set-list button.disabled.clicked {
      animation: flash 0.5s ease;
    }
    @keyframes flash {
      0%   { background-color: #999; }
      50%  { background-color: #cccccc; } /* ë°ê²Œ ë°˜ì§ì„ */
      100% { background-color: #999; }
    }
  </style>
</head>
<body>
  <h1>ì„¸íŠ¸ ì¥ë¹„ ì¡°íšŒ ì‹œìŠ¤í…œ</h1>

  <!-- CSV íŒŒì¼ ì„ íƒ -->
  <input type="file" id="csvFile" accept=".csv">

  <!-- ë°©ì–´êµ¬ -->
  <div class="set-group">
    <h2>[ë°©ì–´êµ¬]</h2>
    <div class="set-list" id="armorButtons"></div>
  </div>

  <!-- ì•…ì„¸ -->
  <div class="set-group">
    <h2>[ì•…ì„¸]</h2>
    <div class="set-list" id="accButtons"></div>
  </div>

  <!-- íŠ¹ì¥ -->
  <div class="set-group">
    <h2>[íŠ¹ì¥]</h2>
    <div class="set-list" id="specialButtons"></div>
  </div>

  <!-- ê²°ê³¼ ì¶œë ¥ -->
  <div id="result">CSV íŒŒì¼ì„ ì„ íƒí•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>

  <script>
    // íšŒìƒ‰ ë²„íŠ¼ì—ë„ í´ë¦­ íš¨ê³¼ ì£¼ê¸°
    document.addEventListener("click", function(e) {
      if (e.target.classList.contains("disabled")) {
        e.target.classList.add("clicked");
        setTimeout(() => e.target.classList.remove("clicked"), 500); // 0.5ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ
      }
    });

    // ì„¸íŠ¸ ë¶„ë¥˜
    const armorSets = [
      "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ","í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë”","ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì•„ì´ì–¸",
      "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì","ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ","ìŠ¤í‹°í‚¤ ì• ì‹œë“œ ì›¨í€",
      "ì„¬ëœ©í•œ ê°•ì²  ìš©","ìµìŠ¤í”Œë¡œì‹œë¸Œ ë²„ë‹ ìŠ¤í†¤","ë¹›ì˜ í—Œì‹ ì",
      "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ì","ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€","ê·¸ë€í…Œ ì „íˆ¬ê¸°ê°‘ íŒŒì¸ "
    ];
    const accSets = [
      "ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ","ì„¬ëœ©í•œ ë¹›ì˜ ê´€ë¦¬ì","ë¶€ì‹ëœ ë©”íƒˆê¸°ì–´",
      "í™”ë ¥ ê°œì¡° íƒ„ë ","ì‹ ë¹„ë¡œìš´ ë¹›ì˜ ì†Œìš©ëŒì´","ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ ì—°ì‚°ì¥ì¹˜"
    ];
    const specialSets = [
      "ê°œêµ¬ìŸì´ í˜¸ë¬¸ì¿¨ë£¨ìŠ¤","ë¼ì´íŠ¸ë‹ ì—ë„ˆì§€ ì½”ì–´","ì² ê°‘ì„ ë‘ë¥¸ íƒ‘ì˜ ìˆ˜í˜¸ê¾¼",
      "ê¹Šì€ ë¶ˆêµ¬ë©ì´ì˜ ì„¬ë©¸ì","í—ˆì˜ ì† ì–´ë‘ ì˜ í”¼ì¡°ë¬¼","ë¶€ì •í•œ ë¹›ì˜ ìš°ìƒ"
    ];

    let data = [];

    // CSV íŒŒì‹± í•¨ìˆ˜
    function parseCSV(csv) {
      const lines = csv.trim().split("\n");
      const headers = lines[0].split(",").map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim() : "");
        ["P1","P2","P3","P4","P5"].forEach(p => obj[p] = parseInt(obj[p]) || 0);
        return obj;
      });
    }

    // ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
    function createButtons(setNames, containerId, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";

      setNames.forEach(setName => {
        const btn = document.createElement("button");
        btn.textContent = setName;
        btn.onclick = () => showSet(setName, type);

        const filtered = data.filter(d => d.Set === setName);
        let partKeys = [];
        if (type === "armor") partKeys = ["P1","P2","P3","P4","P5"];
        else if (type === "acc" || type === "special") partKeys = ["P1","P2","P3"];

        // ê° íŒŒì¸ ë³„ í•©ì‚° â†’ ë³´ìœ  ê°œìˆ˜ ê³„ì‚°
        let nonZeroCount = 0;
        for (let key of partKeys) {
          const sum = filtered.reduce((acc, d) => acc + d[key], 0);
          if (sum > 0) nonZeroCount++;
        }

        // ì„¸íŠ¸ ê°œìˆ˜ ê³„ì‚° (armorë§Œ ì ìš©)
        let threeSetCount = 0;
        let fiveSetCount = 0;
        if (type === "armor") {
          filtered.forEach(d => {
            const partsOwned = partKeys.filter(k => d[k] > 0).length;
            if (partsOwned >= 3 && partsOwned < 5) threeSetCount++;
            if (partsOwned === 5) fiveSetCount++;
          });
        }

        // ë²„íŠ¼ í‘œì‹œ ê·œì¹™
        if (type === "armor") {
          if (nonZeroCount === 5) {
            btn.textContent = `${setName} (${nonZeroCount}ê°œ ë³´ìœ /${threeSetCount}/${fiveSetCount})`;
          } else {
            btn.classList.add("disabled");
            btn.textContent = `${setName} (${nonZeroCount}ê°œ ë³´ìœ /${threeSetCount}/${fiveSetCount})`;
          }
        } else {
          if (nonZeroCount === 0) {
            btn.classList.add("disabled");
          } else if (nonZeroCount < partKeys.length) {
            btn.classList.add("disabled");
            btn.textContent = `${setName} (${nonZeroCount}ê°œ ë³´ìœ )`;
          }
        }

        container.appendChild(btn);
      });
    }

    // ì„¸íŠ¸ ì¶œë ¥ í•¨ìˆ˜
    function showSet(setName, type) {
      const filtered = data.filter(d => d.Set === setName);
      const visible = filtered.filter(d => d.P1+d.P2+d.P3+d.P4+d.P5 > 0);

      let html = `<h2>${setName} ë³´ìœ  í˜„í™©</h2>`;
      if (visible.length === 0) {
        html += `<p>ì´ ì„¸íŠ¸ë¥¼ ë³´ìœ í•œ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
      } else {
        if (type === "armor") {
          html += `<table><tr>
            <th>ìºë¦­í„°</th><th>ì§ì—…</th>
            <th>ìƒì˜(P1)</th><th>í•˜ì˜(P2)</th><th>ì–´ê¹¨(P3)</th><th>ë²¨íŠ¸(P4)</th><th>ì‹ ë°œ(P5)</th>
          </tr>`;
          visible.forEach(d => {
            const partsOwned = ["P1","P2","P3","P4","P5"].filter(k => d[k] > 0).length;
            let rowColor = "";
            if (partsOwned >= 3 && partsOwned < 5) {
              rowColor = "background-color:#fffacd;";
            } else if (partsOwned === 5) {
              rowColor = "background-color:#ffff99;";
            }

            const formatVal = (val) => {
              if (val === 0) return "";
              else return `<span style="color:blue; font-weight:bold">${val}</span>`;
            };
			
			html += `<tr style="${rowColor}">
              <td>${d.Name}</td>
              <td>${d.Class}</td>
              <td>${formatVal(d.P1)}</td>
              <td>${formatVal(d.P2)}</td>
              <td>${formatVal(d.P3)}</td>
              <td>${formatVal(d.P4)}</td>
              <td>${formatVal(d.P5)}</td>
            </tr>`;
          });
        } else if (type === "acc") {
          html += `<table><tr>
            <th>ìºë¦­í„°</th><th>ì§ì—…</th>
            <th>íŒ”ì°Œ(P1)</th><th>ëª©ê±¸ì´(P2)</th><th>ë°˜ì§€(P3)</th>
          </tr>`;
          visible.forEach(d => {
            const formatVal = (val) => {
              if (val === 0) return "";
              else return `<span style="color:blue; font-weight:bold">${val}</span>`;
            };
            html += `<tr>
              <td>${d.Name}</td>
              <td>${d.Class}</td>
              <td>${formatVal(d.P1)}</td>
              <td>${formatVal(d.P2)}</td>
              <td>${formatVal(d.P3)}</td>
            </tr>`;
          });
        } else if (type === "special") {
          html += `<table><tr>
            <th>ìºë¦­í„°</th><th>ì§ì—…</th>
            <th>ê·€ê±¸ì´(P1)</th><th>ë§ˆë²•ì„(P2)</th><th>ë³´ì¥(P3)</th>
          </tr>`;
          visible.forEach(d => {
            const formatVal = (val) => {
              if (val === 0) return "";
              else return `<span style="color:blue; font-weight:bold">${val}</span>`;
            };
            html += `<tr>
              <td>${d.Name}</td>
              <td>${d.Class}</td>
              <td>${formatVal(d.P1)}</td>
              <td>${formatVal(d.P2)}</td>
              <td>${formatVal(d.P3)}</td>
            </tr>`;
          });
        }
        html += `</table>`;
      }
      document.getElementById("result").innerHTML = html;
    }

    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    document.getElementById("csvFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const text = event.target.result;
        data = parseCSV(text);

        // ë””ë²„ê¹… ë¡œê·¸
        console.log("ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì•„ì´ì–¸:", data.filter(d => d.Set === "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì•„ì´ì–¸"));
        console.log("ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì:", data.filter(d => d.Set === "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì"));

        // ë²„íŠ¼ ê·¸ë£¹ ìƒì„±
        createButtons(armorSets, "armorButtons", "armor");
        createButtons(accSets, "accButtons", "acc");
        createButtons(specialSets, "specialButtons", "special");

        document.getElementById("result").innerHTML = "ì„¸íŠ¸ë¥¼ í´ë¦­í•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>

