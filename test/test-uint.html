<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ - RPG ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #0f0f12;
            color: #ddd;
            padding: 20px;
            margin: 0;
        }

        h1 {
            color: #c5a678;
            border-bottom: 2px solid #c5a678;
            padding-bottom: 10px;
        }

        h2 {
            color: #fcc419;
            margin-top: 30px;
        }

        .test-suite {
            background: #1a1a1f;
            border: 1px solid #444;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .test-case {
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #666;
            background: #121216;
        }

        .test-case.pass {
            border-left-color: #4ade80;
            background: #1a4a2a;
        }

        .test-case.fail {
            border-left-color: #f87171;
            background: #4a1a1a;
        }

        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .test-result {
            font-size: 12px;
            color: #888;
        }

        .test-error {
            color: #ff5252;
            font-family: monospace;
            font-size: 11px;
            margin-top: 5px;
            padding: 5px;
            background: #000;
            border-radius: 2px;
        }

        .summary {
            background: #2a2a32;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border: 2px solid #c5a678;
        }

        .summary-item {
            display: inline-block;
            margin-right: 20px;
            font-weight: bold;
        }

        .pass-count { color: #4ade80; }
        .fail-count { color: #f87171; }
        .total-count { color: #c5a678; }

        button {
            background: #1d4ed8;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
            margin: 10px 5px 10px 0;
        }

        button:hover {
            background: #2563eb;
        }

        .run-all {
            background: #059669;
        }

        .run-all:hover {
            background: #10b981;
        }
    </style>
</head>
<body>
<h1>ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ - RPG ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>

<div>
    <button class="run-all" onclick="runAllTests()">â–¶ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <button onclick="clearResults()">ğŸ—‘ï¸ ê²°ê³¼ ì´ˆê¸°í™”</button>
</div>

<div id="summary" class="summary" style="display: none;">
    <span class="summary-item total-count">ì´ <span id="totalTests">0</span>ê°œ</span>
    <span class="summary-item pass-count">í†µê³¼ <span id="passTests">0</span>ê°œ</span>
    <span class="summary-item fail-count">ì‹¤íŒ¨ <span id="failTests">0</span>ê°œ</span>
    <span class="summary-item">ì†Œìš” ì‹œê°„: <span id="duration">0</span>ms</span>
</div>

<div id="testResults"></div>

<!-- í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
<script src="../js/constants.js"></script>
<script src="../js/data.js"></script>
<script src="../js/state.js"></script>
<script src="../js/utils.js"></script>

<!-- í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ -->
<script>
    // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
    class TestRunner {
        constructor() {
            this.tests = [];
            this.results = [];
            this.currentSuite = null;
        }

        describe(suiteName, fn) {
            this.currentSuite = {
                name: suiteName,
                tests: []
            };
            fn();
            this.tests.push(this.currentSuite);
            this.currentSuite = null;
        }

        it(testName, fn) {
            if (!this.currentSuite) {
                console.error('it() must be called inside describe()');
                return;
            }
            this.currentSuite.tests.push({
                name: testName,
                fn: fn
            });
        }

        async runAll() {
            const startTime = performance.now();
            this.results = [];

            for (const suite of this.tests) {
                for (const test of suite.tests) {
                    const result = await this.runTest(suite.name, test);
                    this.results.push(result);
                }
            }

            const endTime = performance.now();
            const duration = Math.round(endTime - startTime);

            this.displayResults(duration);
        }

        async runTest(suiteName, test) {
            try {
                await test.fn();
                return {
                    suite: suiteName,
                    name: test.name,
                    passed: true,
                    error: null
                };
            } catch (error) {
                return {
                    suite: suiteName,
                    name: test.name,
                    passed: false,
                    error: error.message
                };
            }
        }

        displayResults(duration) {
            const container = document.getElementById('testResults');
            container.innerHTML = '';

            let currentSuite = null;
            let suiteDiv = null;

            this.results.forEach(result => {
                if (currentSuite !== result.suite) {
                    currentSuite = result.suite;
                    suiteDiv = document.createElement('div');
                    suiteDiv.className = 'test-suite';
                    suiteDiv.innerHTML = `<h2>${currentSuite}</h2>`;
                    container.appendChild(suiteDiv);
                }

                const testDiv = document.createElement('div');
                testDiv.className = `test-case ${result.passed ? 'pass' : 'fail'}`;

                testDiv.innerHTML = `
                        <div class="test-name">
                            ${result.passed ? 'âœ…' : 'âŒ'} ${result.name}
                        </div>
                        ${result.error ? `<div class="test-error">${result.error}</div>` : ''}
                    `;

                suiteDiv.appendChild(testDiv);
            });

            // ìš”ì•½ í‘œì‹œ
            const passCount = this.results.filter(r => r.passed).length;
            const failCount = this.results.filter(r => !r.passed).length;

            document.getElementById('summary').style.display = 'block';
            document.getElementById('totalTests').textContent = this.results.length;
            document.getElementById('passTests').textContent = passCount;
            document.getElementById('failTests').textContent = failCount;
            document.getElementById('duration').textContent = duration;
        }
    }

    // ì–´ì„œì…˜ í—¬í¼
    function expect(actual) {
        return {
            toBe(expected) {
                if (actual !== expected) {
                    throw new Error(`Expected ${JSON.stringify(expected)}, but got ${JSON.stringify(actual)}`);
                }
            },
            toEqual(expected) {
                if (JSON.stringify(actual) !== JSON.stringify(expected)) {
                    throw new Error(`Expected ${JSON.stringify(expected)}, but got ${JSON.stringify(actual)}`);
                }
            },
            toBeTruthy() {
                if (!actual) {
                    throw new Error(`Expected truthy value, but got ${actual}`);
                }
            },
            toBeFalsy() {
                if (actual) {
                    throw new Error(`Expected falsy value, but got ${actual}`);
                }
            },
            toContain(item) {
                if (!actual.includes(item)) {
                    throw new Error(`Expected array to contain ${item}`);
                }
            },
            toHaveProperty(prop) {
                if (!(prop in actual)) {
                    throw new Error(`Expected object to have property ${prop}`);
                }
            },
            toBeInstanceOf(constructor) {
                if (!(actual instanceof constructor)) {
                    throw new Error(`Expected instance of ${constructor.name}`);
                }
            },
            toThrow() {
                try {
                    actual();
                    throw new Error('Expected function to throw an error');
                } catch (e) {
                    // ì„±ê³µ
                }
            }
        };
    }

    const runner = new TestRunner();

    // ============================================
    // 1. AppConstants í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('AppConstants - ìƒìˆ˜ ì •ì˜', () => {
        runner.it('STORAGE_KEYê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(AppConstants.STORAGE_KEY).toBe('dnfm_character_equipment_data');
        });

        runner.it('SLOTS ë°°ì—´ì´ 18ê°œ ìŠ¬ë¡¯ì„ í¬í•¨í•´ì•¼ í•¨', () => {
            expect(AppConstants.SLOTS.length).toBe(18);
        });

        runner.it('SLOTSì— ë¬´ê¸° ìŠ¬ë¡¯ì´ ìˆì–´ì•¼ í•¨', () => {
            expect(AppConstants.SLOTS).toContain('ë¬´ê¸°');
        });

        runner.it('HEAVY_BORDER_SLOTSê°€ ë°°ì—´ì´ì–´ì•¼ í•¨', () => {
            expect(Array.isArray(AppConstants.HEAVY_BORDER_SLOTS)).toBeTruthy();
        });

        runner.it('PREFIXESê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(AppConstants.PREFIXES).toBeTruthy();
        });

        runner.it('RUNE_NAMESê°€ ë°°ì—´ì´ì–´ì•¼ í•¨', () => {
            expect(Array.isArray(AppConstants.RUNE_NAMES)).toBeTruthy();
        });

        runner.it('RARITY_COLORS ê°ì²´ê°€ ì—í”½ ìƒ‰ìƒì„ í¬í•¨í•´ì•¼ í•¨', () => {
            expect(AppConstants.RARITY_COLORS).toHaveProperty('ì—í”½');
        });
    });

    // ============================================
    // 2. GameData í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('GameData - ê²Œì„ ë°ì´í„°', () => {
        runner.it('sealDataê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(GameData.sealData).toBeTruthy();
        });

        runner.it('sealData.weaponì´ n1, n2ë¥¼ í¬í•¨í•´ì•¼ í•¨', () => {
            expect(GameData.sealData.weapon).toHaveProperty('n1');
            expect(GameData.sealData.weapon).toHaveProperty('n2');
        });

        runner.it('itemOptionsê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(GameData.itemOptions).toBeTruthy();
        });

        runner.it('itemOptions.ìƒì˜ê°€ ë°°ì—´ì´ì–´ì•¼ í•¨', () => {
            expect(Array.isArray(GameData.itemOptions['ìƒì˜'])).toBeTruthy();
        });

        runner.it('armorSetsê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(GameData.armorSets).toBeTruthy();
        });

        runner.it('accSetsê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(GameData.accSets).toBeTruthy();
        });

        runner.it('specialSetsê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(GameData.specialSets).toBeTruthy();
        });
    });

    // ============================================
    // 3. AppState í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('AppState - ìƒíƒœ ê´€ë¦¬', () => {
        runner.it('charRuneData ê°ì²´ê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(AppState.charRuneData).toBeTruthy();
        });

        runner.it('changeHistory ë°°ì—´ì´ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(Array.isArray(AppState.changeHistory)).toBeTruthy();
        });

        runner.it('lastSnapshot ë°°ì—´ì´ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(Array.isArray(AppState.lastSnapshot)).toBeTruthy();
        });

        runner.it('compareSelection ê°ì²´ê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(AppState.compareSelection).toBeTruthy();
        });

        runner.it('init ë©”ì„œë“œê°€ í•¨ìˆ˜ì—¬ì•¼ í•¨', () => {
            expect(typeof AppState.init).toBe('function');
        });

        runner.it('saveHistory ë©”ì„œë“œê°€ í•¨ìˆ˜ì—¬ì•¼ í•¨', () => {
            expect(typeof AppState.saveHistory).toBe('function');
        });

        runner.it('updateSnapshot ë©”ì„œë“œê°€ í•¨ìˆ˜ì—¬ì•¼ í•¨', () => {
            expect(typeof AppState.updateSnapshot).toBe('function');
        });
    });

    // ============================================
    // 4. DOMUtils í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('DOMUtils - DOM ìœ í‹¸ë¦¬í‹°', () => {
        runner.it('getSlotElement ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof DOMUtils.getSlotElement).toBe('function');
        });

        runner.it('getSlotElements ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof DOMUtils.getSlotElements).toBe('function');
        });

        runner.it('getCharInfo ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof DOMUtils.getCharInfo).toBe('function');
        });

        runner.it('getCharInfos ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof DOMUtils.getCharInfos).toBe('function');
        });
    });

    // ============================================
    // 5. SlotUtils í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('SlotUtils - ìŠ¬ë¡¯ ìœ í‹¸ë¦¬í‹°', () => {
        runner.it('ARMOR_SLOTSê°€ ë°°ì—´ì´ì–´ì•¼ í•¨', () => {
            expect(Array.isArray(SlotUtils.ARMOR_SLOTS)).toBeTruthy();
        });

        runner.it('ACCESSORY_SLOTSê°€ ë°°ì—´ì´ì–´ì•¼ í•¨', () => {
            expect(Array.isArray(SlotUtils.ACCESSORY_SLOTS)).toBeTruthy();
        });

        runner.it('ìƒì˜ê°€ ë°©ì–´êµ¬ ìŠ¬ë¡¯ìœ¼ë¡œ ì¸ì‹ë˜ì–´ì•¼ í•¨', () => {
            expect(SlotUtils.isArmorSlot('ìƒì˜')).toBeTruthy();
        });

        runner.it('ëª©ê±¸ì´ê°€ ì•…ì„¸ì„œë¦¬ ìŠ¬ë¡¯ìœ¼ë¡œ ì¸ì‹ë˜ì–´ì•¼ í•¨', () => {
            expect(SlotUtils.isAccessorySlot('ëª©ê±¸ì´')).toBeTruthy();
        });

        runner.it('ë³´ì¡°ì¥ë¹„ê°€ íŠ¹ìˆ˜ ìŠ¬ë¡¯ìœ¼ë¡œ ì¸ì‹ë˜ì–´ì•¼ í•¨', () => {
            expect(SlotUtils.isSpecialSlot('ë³´ì¡°ì¥ë¹„')).toBeTruthy();
        });

        runner.it('getSlotTypeì´ ì˜¬ë°”ë¥¸ íƒ€ì…ì„ ë°˜í™˜í•´ì•¼ í•¨', () => {
            expect(SlotUtils.getSlotType('ìƒì˜')).toBe('armor');
            expect(SlotUtils.getSlotType('ëª©ê±¸ì´')).toBe('accessory');
            expect(SlotUtils.getSlotType('ë³´ì¡°ì¥ë¹„')).toBe('special');
        });
    });

    // ============================================
    // 6. ClassUtils í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('ClassUtils - í´ë˜ìŠ¤ ì¡°ì‘ ìœ í‹¸ë¦¬í‹°', () => {
        runner.it('removeClassesStartingWith ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof ClassUtils.removeClassesStartingWith).toBe('function');
        });

        runner.it('toggleHighlight ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof ClassUtils.toggleHighlight).toBe('function');
        });

        runner.it('removeHighlightFromAll ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof ClassUtils.removeHighlightFromAll).toBe('function');
        });
    });

    // ============================================
    // 7. DataTables í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('DataTables - ë°ì´í„° í…Œì´ë¸” ìœ í‹¸ë¦¬í‹°', () => {
        runner.it('COMMON_VALUESê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(DataTables.COMMON_VALUES).toBeTruthy();
        });

        runner.it('í˜ ìŠ¤íƒ¯ ê°’ì´ 46ì´ì–´ì•¼ í•¨', () => {
            expect(DataTables.COMMON_VALUES['í˜']).toBe('46');
        });

        runner.it('WEAPON_SEAL1ì´ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(DataTables.WEAPON_SEAL1).toBeTruthy();
        });

        runner.it('getSealValue ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
            expect(typeof DataTables.getSealValue).toBe('function');
        });

        runner.it('ë¬´ê¸° seal1 ë°ë¯¸ì§€ ì¦ê°€ ê°’ì´ 8ì´ì–´ì•¼ í•¨', () => {
            const value = DataTables.getSealValue('weapon', 'ë°ë¯¸ì§€ ì¦ê°€', 1);
            expect(value).toBe('8');
        });
    });

    // ============================================
    // 8. í—¬í¼ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
    // ============================================
    runner.describe('Helper Functions - í—¬í¼ í•¨ìˆ˜', () => {
        runner.it('getCurrentDateTimeì´ ë¬¸ìì—´ì„ ë°˜í™˜í•´ì•¼ í•¨', () => {
            const result = getCurrentDateTime();
            expect(typeof result).toBe('string');
        });

        runner.it('getCurrentDateTimeì´ ë‚ ì§œ í˜•ì‹ì„ í¬í•¨í•´ì•¼ í•¨', () => {
            const result = getCurrentDateTime();
            expect(result).toContain('-');
            expect(result).toContain(':');
        });

        runner.it('extractNumberê°€ ìˆ«ìë¥¼ ì¶”ì¶œí•´ì•¼ í•¨', () => {
            expect(extractNumber('í˜ 46')).toBe('46');
            expect(extractNumber('123abc')).toBe('123');
        });

        runner.it('calculateNumDiffê°€ ì°¨ì´ë¥¼ ê³„ì‚°í•´ì•¼ í•¨', () => {
            expect(calculateNumDiff('10', '15')).toContain('+5');
            expect(calculateNumDiff('20', '15')).toContain('-5');
            expect(calculateNumDiff('10', '10')).toBe('-');
        });

        runner.it('calculateReinforceDiffê°€ ê°•í™” ì°¨ì´ë¥¼ ê³„ì‚°í•´ì•¼ í•¨', () => {
            expect(calculateReinforceDiff('ë¬´ê¸°', '10', '12')).toContain('+2');
            expect(calculateReinforceDiff('ë¬´ê¸°', '12', '10')).toContain('-2');
        });

        runner.it('ì¹­í˜¸ëŠ” ê°•í™” ì°¨ì´ë¥¼ ê³„ì‚°í•˜ì§€ ì•Šì•„ì•¼ í•¨', () => {
            expect(calculateReinforceDiff('ì¹­í˜¸', '10', '12')).toBe('');
        });
    });

    // ============================================
    // 9. ì „ì—­ ë³„ì¹­ í…ŒìŠ¤íŠ¸ (í•˜ìœ„ í˜¸í™˜ì„±)
    // ============================================
    runner.describe('Global Aliases - ì „ì—­ ë³„ì¹­ (í•˜ìœ„ í˜¸í™˜ì„±)', () => {
        runner.it('slots ë³„ì¹­ì´ AppConstants.SLOTSë¥¼ ê°€ë¦¬ì¼œì•¼ í•¨', () => {
            expect(slots).toEqual(AppConstants.SLOTS);
        });

        runner.it('itemOptions ë³„ì¹­ì´ GameData.itemOptionsë¥¼ ê°€ë¦¬ì¼œì•¼ í•¨', () => {
            expect(itemOptions).toEqual(GameData.itemOptions);
        });

        runner.it('armorSets ë³„ì¹­ì´ GameData.armorSetsë¥¼ ê°€ë¦¬ì¼œì•¼ í•¨', () => {
            expect(armorSets).toEqual(GameData.armorSets);
        });

        runner.it('accSets ë³„ì¹­ì´ GameData.accSetsë¥¼ ê°€ë¦¬ì¼œì•¼ í•¨', () => {
            expect(accSets).toEqual(GameData.accSets);
        });
    });

    // ì „ì—­ í•¨ìˆ˜
    function runAllTests() {
        runner.runAll();
    }

    function clearResults() {
        document.getElementById('testResults').innerHTML = '';
        document.getElementById('summary').style.display = 'none';
    }

    console.log('âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
    console.log('ğŸ“ "ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”');
</script>
</body>
</html>