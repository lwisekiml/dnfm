<!DOCTYPE html>
<!--
  ============================================================
  test_runner.html â€” DNF Mobile ì¥ë¹„ ê´€ë¦¬ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ
  ============================================================

  ì‚¬ìš©ë²•:
    ì´ íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê³  "â–¶ í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¨.
    Node.js, ì„œë²„, ë³„ë„ íŒŒì¼ ëª¨ë‘ ë¶ˆí•„ìš”. ì´ íŒŒì¼ í•˜ë‚˜ë¡œ ì™„ê²°.

  íŒŒì¼ êµ¬ì¡° (script íƒœê·¸ ì•ˆ):
    â‘  logic.js ì½”ë“œ (ì¸ë¼ì¸)      â† í…ŒìŠ¤íŠ¸ ëŒ€ìƒ í•¨ìˆ˜ë“¤
    â‘¡ ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬       â† describe/test/assert ì§ì ‘ êµ¬í˜„
    â‘¢ logic.test.js í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤  â† ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œ
    â‘£ runAll() ì‹¤í–‰ ë° UI ë Œë”ë§   â† ê²°ê³¼ë¥¼ DOM ì— ê·¸ë¦¬ëŠ” í•¨ìˆ˜

  ì™œ ì¸ë¼ì¸ìœ¼ë¡œ í•©ì³¤ë‚˜?
    ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ íŒŒì¼(.html)ì„ ì—´ë©´ CORS ì •ì±… ë•Œë¬¸ì—
    <script src="./logic.js"> ë°©ì‹ìœ¼ë¡œ ë‹¤ë¥¸ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•¨.
    ê·¸ë˜ì„œ ëª¨ë“  ì½”ë“œë¥¼ ì´ íŒŒì¼ ì•ˆì— ì§ì ‘ ë¶™ì—¬ë„£ì€ ê²ƒ.
  ============================================================
-->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DNF Mobile â€” ìœ ë‹› í…ŒìŠ¤íŠ¸</title>
    <style>
        /*
         * ìŠ¤íƒ€ì¼ ì„¤ëª…:
         *   .suite       : í…ŒìŠ¤íŠ¸ ê·¸ë£¹ í•˜ë‚˜ (describe ë¸”ë¡ì— ëŒ€ì‘)
         *   .suite-header: ê·¸ë£¹ ì œëª© ë°” (í´ë¦­í•˜ë©´ í¼ì¹˜ê¸°/ì ‘ê¸°)
         *   .suite-body  : ê·¸ë£¹ ì•ˆì˜ ê°œë³„ í…ŒìŠ¤íŠ¸ ëª©ë¡
         *   .test-row    : í…ŒìŠ¤íŠ¸ í•œ ì¤„ (pass/fail ì— ë”°ë¼ ìƒ‰ìƒ ë‹¤ë¦„)
         *   .err-msg     : ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­
         */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Courier New', monospace; background: #0f1222; color: #e6e9ff; padding: 20px; }
        h1 { font-size: 1.4em; color: #ffd700; margin-bottom: 6px; }
        .subtitle { color: #888; font-size: 0.85em; margin-bottom: 20px; }
        #summary { display: flex; gap: 16px; align-items: center; padding: 14px 18px;
            border-radius: 8px; background: #181c33; border: 1px solid #2a3158;
            margin-bottom: 20px; flex-wrap: wrap; }
        .stat { font-size: 1.1em; font-weight: bold; }
        .stat.pass { color: #25c2a0; }
        .stat.fail { color: #e74c3c; }
        .stat.total { color: #e6e9ff; }
        .progress-bar { flex: 1; height: 10px; background: #2a3158; border-radius: 5px;
            min-width: 200px; overflow: hidden; }
        .progress-fill { height: 100%; background: #25c2a0; border-radius: 5px;
            transition: width 0.4s; width: 0%; }
        .progress-fill.has-fail { background: linear-gradient(90deg, #25c2a0, #e74c3c); }
        .run-btn { padding: 8px 20px; background: #4a33cc; color: #fff; border: none;
            border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.95em; }
        .run-btn:hover { background: #5a43dc; }
        .suite { margin-bottom: 14px; border: 1px solid #2a3158; border-radius: 8px;
            background: #181c33; overflow: hidden; }
        .suite-header { padding: 10px 16px; display: flex; align-items: center; gap: 10px;
            cursor: pointer; user-select: none; background: #1e2340; }
        .suite-header:hover { background: #252b4a; }
        .suite-name { font-weight: bold; font-size: 1em; color: #ffd700; flex: 1; }
        .suite-stat { font-size: 0.85em; color: #888; }
        .suite-stat.all-pass { color: #25c2a0; }
        .suite-stat.has-fail { color: #e74c3c; }
        .suite-badge { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
        .suite-badge.pass { background: #25c2a0; }
        .suite-badge.fail { background: #e74c3c; }
        .suite-body { display: none; padding: 8px 0; }
        .suite-body.open { display: block; }
        .test-row { display: flex; align-items: flex-start; gap: 10px; padding: 6px 16px;
            font-size: 0.88em; border-bottom: 1px solid #1a1f38; }
        .test-row:last-child { border-bottom: none; }
        .test-row.pass .icon { color: #25c2a0; }
        .test-row.fail .icon { color: #e74c3c; }
        .icon { width: 16px; flex-shrink: 0; margin-top: 1px; }
        .test-name { flex: 1; color: #ccc; }
        .test-row.fail .test-name { color: #e6e9ff; }
        .err-msg { font-size: 0.82em; color: #e74c3c; margin-top: 3px; white-space: pre-wrap;
            background: #1a0808; padding: 4px 8px; border-radius: 4px; border-left: 3px solid #e74c3c; }
        .chevron { color: #555; transition: transform 0.2s; font-size: 0.8em; }
        .suite-header.open .chevron { transform: rotate(90deg); }
        #idle-msg { color: #555; font-style: italic; padding: 20px 0; text-align: center; }
    </style>
</head>
<body>

<h1>ğŸ§ª DNF Mobile ì¥ë¹„ ê´€ë¦¬ â€” ìœ ë‹› í…ŒìŠ¤íŠ¸</h1>
<p class="subtitle">Node.js ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì‹¤í–‰ | ë‹¨ì¼ HTML íŒŒì¼</p>

<!-- ìš”ì•½ ë°”: ì´/í†µê³¼/ì‹¤íŒ¨ ì¹´ìš´íŠ¸ + ì§„í–‰ë¥  ë°” + ì‹¤í–‰ ë²„íŠ¼ -->
<div id="summary">
    <span class="stat total" id="stat-total">ì´ â€” ê°œ</span>
    <span class="stat pass"  id="stat-pass" >âœ“ 0</span>
    <span class="stat fail"  id="stat-fail" >âœ— 0</span>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <button class="run-btn" onclick="runAll()">â–¶ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
</div>

<!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë Œë”ë§ë¨ -->
<div id="results"><div id="idle-msg">â–¶ ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”</div></div>

<script>
    /* ============================================================
       â‘  logic.js ì¸ë¼ì¸
       ------------------------------------------------------------
       ì›ë³¸ logic.js ì—ì„œ export ë¸”ë¡ë§Œ ì œê±°í•œ ì½”ë“œ.
       ë¸Œë¼ìš°ì €ì—ì„œëŠ” <script> ì•ˆì˜ ë³€ìˆ˜/í•¨ìˆ˜ê°€ ì „ì—­ ìŠ¤ì½”í”„ì— ë“±ë¡ë˜ë¯€ë¡œ
       export/import ì—†ì´ë„ ì•„ë˜ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ë°”ë¡œ ì ‘ê·¼ ê°€ëŠ¥.
       ============================================================ */
    /**
     * ============================================================
     * logic.js â€” DNF Mobile ì¥ë¹„ ê´€ë¦¬ ìˆœìˆ˜ ë¡œì§ ëª¨ë“ˆ
     * ============================================================
     *
     * ì—­í• :
     *   ì›ë³¸ index_legacy_prefix.html ì˜ <script> ë¸”ë¡ì—ì„œ
     *   DOM(í™”ë©´ ì¡°ì‘)ì„ ê±´ë“œë¦¬ì§€ ì•ŠëŠ” ìˆœìˆ˜ ê³„ì‚° ë¡œì§ë§Œ ë½‘ì•„ë‚¸ íŒŒì¼.
     *
     * ì™œ ë”°ë¡œ ë¹¼ëƒ?
     *   ì›ë³¸ HTML ì•ˆì˜ í•¨ìˆ˜ë“¤ì€ document.getElementById() ê°™ì€
     *   ë¸Œë¼ìš°ì € ì „ìš© APIë¥¼ ì¨ì„œ Node.js í™˜ê²½ì—ì„œ ì§ì ‘ import í•˜ë©´
     *   ì—ëŸ¬ê°€ ë‚œë‹¤. ê·¸ë˜ì„œ DOM ì—†ì´ë„ ëŒì•„ê°€ëŠ” í•¨ìˆ˜ë“¤ë§Œ ì´ íŒŒì¼ì—
     *   ëª¨ì•„ë‘ê³ , í…ŒìŠ¤íŠ¸ëŠ” ì´ íŒŒì¼ë§Œ ëŒ€ìƒìœ¼ë¡œ í•œë‹¤.
     *
     * ì‚¬ìš©ë²•:
     *   import { makePrefixKey, calcTotalDistinctParts } from './logic.js';
     *
     * ì£¼ì˜:
     *   package.json ì— "type": "module" ì´ ìˆì–´ì•¼ import/export ë¬¸ë²•ì´
     *   Node.js ì—ì„œ ë™ì‘í•œë‹¤.
     * ============================================================
     */


// ============================================================
// 1. ì„¸íŠ¸ ë°ì´í„° ìƒìˆ˜
//    ì¥ë¹„ ì„¸íŠ¸ ì´ë¦„ â†’ ìŠ¬ë¡¯ ëª©ë¡ ë§¤í•‘
//    ì˜ˆ: "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ" â†’ ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"]
// ============================================================

// ë°©ì–´êµ¬ ì„¸íŠ¸: ìƒì˜/í•˜ì˜/ì–´ê¹¨/ë²¨íŠ¸/ì‹ ë°œ 5ìŠ¬ë¡¯
    const ARMOR_SETS = {
        "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ":  ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë”":    ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì•„ì´ì–¸":  ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì":  ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ":         ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ìŠ¤í‹±í‚¤ ì• ì‹œë“œ ì›¨í€":      ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ì„¬ëœ©í•œ ê°•ì²  ìš©":          ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ìµìŠ¤í”Œë¡œì‹œë¸Œ ë²„ë‹ ìŠ¤í†¤":  ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ë¹›ì˜ í—Œì‹ ì":             ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ì":  ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€":         ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ê·¸ë€í…Œ ì „íˆ¬ê¸°ê°‘ íŒŒì¸ ":   ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        // ë ˆê±°ì‹œ ë°©ì–´êµ¬ ì„¸íŠ¸ â€” ìŠ¬ë¡¯ êµ¬ì„±ì€ ë™ì¼í•˜ì§€ë§Œ ì ‘ë‘ì–´/í‚¤ ì²˜ë¦¬ê°€ ë‹¤ë¦„
        "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´": ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
        "ë ˆê±°ì‹œ: ìì—°ì˜ ìˆ˜í˜¸ì":   ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"],
    };

    // ë°©ì–´êµ¬ ì ‘ë‘ì–´: ì„¸íŠ¸ëª… â†’ ê°€ëŠ¥í•œ ì ‘ë‘ì–´ ëª©ë¡
    // ì¼ë°˜ ì„¸íŠ¸ëŠ” ["ì „ê²©","í—ˆìƒ"] ê°™ì€ 2ê°€ì§€, ë ˆê±°ì‹œëŠ” ["ë ˆê±°ì‹œ"] 1ê°€ì§€ë§Œ ìˆìŒ
    const ARMOR_PREFIX = {
        "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ":  ["ì „ê²©","í—ˆìƒ"],
        "í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë”":    ["ì‘ì—´","ì¹¨ì‹"],
        "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì•„ì´ì–¸":  ["ìˆ˜í˜¸","ì™œê³¡"],
        "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì":  ["ììƒ","ë§¹ë…"],
        "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ":         ["í—ˆìƒ","ë³´í˜¸"],
        "ìŠ¤í‹±í‚¤ ì• ì‹œë“œ ì›¨í€":      ["ë§¹ë…","ì™œê³¡"],
        "ì„¬ëœ©í•œ ê°•ì²  ìš©":          ["ì‡„ë„","ì¹¨ì‹"],
        "ìµìŠ¤í”Œë¡œì‹œë¸Œ ë²„ë‹ ìŠ¤í†¤":  ["ì‹ ì†","ì—°ê²©"],
        "ë¹›ì˜ í—Œì‹ ì":             ["ìˆ˜í˜¸","ì—°ê²©"],
        "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ì":  ["ììƒ","ì‡„ë„"],
        "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€":         ["ì‘ì—´","ë³´í˜¸"],
        "ê·¸ë€í…Œ ì „íˆ¬ê¸°ê°‘ íŒŒì¸ ":   ["ì‹ ì†","ì „ê²©"],
        // ë ˆê±°ì‹œ ì„¸íŠ¸: ì ‘ë‘ì–´ê°€ "ë ˆê±°ì‹œ" í•˜ë‚˜ë¿
        "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´": ["ë ˆê±°ì‹œ"],
        "ë ˆê±°ì‹œ: ìì—°ì˜ ìˆ˜í˜¸ì":   ["ë ˆê±°ì‹œ"],
    };

    // ë ˆê±°ì‹œ ë¦¬íŒ©í„°ë§ ì´ì „ì— ì‚¬ìš©í•˜ë˜ "ìµì‹œë“œ ì „ìš© ì„¸íŠ¸" ëª©ë¡.
    // í˜„ì¬ëŠ” ë ˆê±°ì‹œ ì„¸íŠ¸ê°€ ì ‘ë‘ì–´ ë°©ì‹ìœ¼ë¡œ ë°”ë€Œì–´ì„œ ë¹ˆ ë°°ì—´.
    // ë¹ˆ ë°°ì—´ì¸ì§€ í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦í•´ì„œ ë¦¬íŒ©í„°ë§ì´ ì •ìƒ ì ìš©ëìŒì„ í™•ì¸í•œë‹¤.
    const ARMOR_EXCEED_ONLY = [];

    // ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸: íŒ”ì°Œ/ëª©ê±¸ì´/ë°˜ì§€ 3ìŠ¬ë¡¯
    const ACCESSORY_SETS = {
        "ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ":       ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        "ì„¬ëœ©í•œ ë¹›ì˜ ê´€ë¦¬ì":         ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        "ë¶€ì‹ëœ ë©”íƒˆê¸°ì–´":            ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        "í™”ë ¥ ê°œì¡° íƒ„ë ":             ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        "ì‹ ë¹„ë¡œìš´ ë¹›ì˜ ì†Œìš©ëŒì´":     ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ ì—°ì‚°ì¥ì¹˜":     ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        // ë ˆê±°ì‹œ ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸
        "ë ˆê±°ì‹œ: ì—í…Œë¦¬ì–¼ ë¦¬ë² ë„ŒíŠ¸":  ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
        "ë ˆê±°ì‹œ: ì§€ë‚˜ì˜¨ ì˜ê´‘ì˜ ì‹œëŒ€": ["íŒ”ì°Œ","ëª©ê±¸ì´","ë°˜ì§€"],
    };

    const ACCESSORY_PREFIX = {
        "ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ":       ["ê²¬ê³ ","í˜ˆë…"],
        "ì„¬ëœ©í•œ ë¹›ì˜ ê´€ë¦¬ì":         ["ì´ˆì„","ê°ì˜¤"],
        "ë¶€ì‹ëœ ë©”íƒˆê¸°ì–´":            ["ê°ì˜¤","ê°€ì†"],
        "í™”ë ¥ ê°œì¡° íƒ„ë ":             ["í˜ˆë…","ê²¬ê³ "],
        "ì‹ ë¹„ë¡œìš´ ë¹›ì˜ ì†Œìš©ëŒì´":     ["ì¡°í™”","ì´ˆì„"],
        "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ ì—°ì‚°ì¥ì¹˜":     ["ê°€ì†","ì¡°í™”"],
        "ë ˆê±°ì‹œ: ì—í…Œë¦¬ì–¼ ë¦¬ë² ë„ŒíŠ¸":  ["ë ˆê±°ì‹œ"],
        "ë ˆê±°ì‹œ: ì§€ë‚˜ì˜¨ ì˜ê´‘ì˜ ì‹œëŒ€": ["ë ˆê±°ì‹œ"],
    };

    const ACCESSORY_EXCEED_ONLY = []; // ARMOR_EXCEED_ONLY ì™€ ë™ì¼í•œ ì´ìœ ë¡œ ë¹ˆ ë°°ì—´

    // íŠ¹ìˆ˜ì¥ë¹„ ì„¸íŠ¸: ê·€ê±¸ì´/ë§ˆë²•ì„/ë³´ì¥ 3ìŠ¬ë¡¯
    const SPECIAL_SETS = {
        "ê°œêµ¬ìŸì´ í˜¸ë¬¸ì¿¨ë£¨ìŠ¤":        ["ê·€ê±¸ì´","ë§ˆë²•ì„","ë³´ì¥"],
        "ë¼ì´íŠ¸ë‹ ì—ë„ˆì§€ ì½”ì–´":       ["ê·€ê±¸ì´","ë§ˆë²•ì„","ë³´ì¥"],
        "ì² ê°‘ì„ ë‘ë¥¸ íƒ‘ì˜ ìˆ˜í˜¸ê¾¼":   ["ê·€ê±¸ì´","ë§ˆë²•ì„","ë³´ì¥"],
        "ê¹Šì€ ë¶ˆêµ¬ë©ì´ì˜ ì„¬ë©¸ì":    ["ê·€ê±¸ì´","ë§ˆë²•ì„","ë³´ì¥"],
        "í—ˆì˜ ì† ì–´ë‘ ì˜ í”¼ì¡°ë¬¼":     ["ê·€ê±¸ì´","ë§ˆë²•ì„","ë³´ì¥"],
        "ë¶€ì •í•œ ë¹›ì˜ ìš°ìƒ":           ["ê·€ê±¸ì´","ë§ˆë²•ì„","ë³´ì¥"],
    };

    const SPECIAL_PREFIX = {
        "ê°œêµ¬ìŸì´ í˜¸ë¬¸ì¿¨ë£¨ìŠ¤":        ["ë¶ˆêµ´","ìˆ™ë ¨"],
        "ë¼ì´íŠ¸ë‹ ì—ë„ˆì§€ ì½”ì–´":       ["ìˆ™ë ¨","ê²°ì˜"],
        "ì² ê°‘ì„ ë‘ë¥¸ íƒ‘ì˜ ìˆ˜í˜¸ê¾¼":   ["ê²©ë³€","ì´‰ì§„"],
        "ê¹Šì€ ë¶ˆêµ¬ë©ì´ì˜ ì„¬ë©¸ì":    ["ë¶ˆêµ´","ì´‰ì§„"],
        "í—ˆì˜ ì† ì–´ë‘ ì˜ í”¼ì¡°ë¬¼":     ["ì§ˆì£¼","ê²°ì˜"],
        "ë¶€ì •í•œ ë¹›ì˜ ìš°ìƒ":           ["ì§ˆì£¼","ê²©ë³€"],
    };

    // ì„¸ ì¹´í…Œê³ ë¦¬ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹œ í¸ì˜ìš© ìƒìˆ˜.
    // ìŠ¤í”„ë ˆë“œ ì—°ì‚°ì(...)ë¡œ ê°ì²´ í‚¤ë¥¼ ëª¨ë‘ í•©ì¹¨.
    // í•¨ìˆ˜ì—ì„œ ì¹´í…Œê³ ë¦¬ êµ¬ë¶„ ì—†ì´ ì„¸íŠ¸ ê²€ìƒ‰í•  ë•Œ ì‚¬ìš©.
    const ALL_SETS    = { ...ARMOR_SETS,   ...ACCESSORY_SETS,   ...SPECIAL_SETS };
    const ALL_PREFIX  = { ...ARMOR_PREFIX, ...ACCESSORY_PREFIX, ...SPECIAL_PREFIX };


    // ============================================================
    // 2. ë ˆê±°ì‹œ & ìµì‹œë“œ ê´€ë ¨ ìƒìˆ˜
    // ============================================================

    /**
     * ë ˆê±°ì‹œ ì„¸íŠ¸ ì´ë¦„ ëª©ë¡.
     *
     * ì™œ í•„ìš”í•œê°€?
     *   ì¼ë°˜ ì„¸íŠ¸ì˜ ì ‘ë‘ì–´ í‚¤ëŠ” "ì ‘ë‘ì–´: ì„¸íŠ¸ëª…" í˜•íƒœë¡œ ë§Œë“ ë‹¤.
     *   ì˜ˆ) makePrefixKey("ì „ê²©", "ë§ê´„ëŸ‰ì´") â†’ "ì „ê²©: ë§ê´„ëŸ‰ì´"
     *
     *   ê·¸ëŸ°ë° ë ˆê±°ì‹œ ì„¸íŠ¸ëŠ” ì„¸íŠ¸ëª… ìì²´ê°€ ì´ë¯¸ "ë ˆê±°ì‹œ: XXX" í˜•íƒœë¼ì„œ
     *   ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ë©´ "ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: XXX" ê°€ ë˜ì–´ë²„ë¦°ë‹¤. (ë²„ê·¸)
     *
     *   ê·¸ë˜ì„œ ì´ ëª©ë¡ì— ìˆëŠ” ì„¸íŠ¸ëŠ” í‚¤ ìƒì„± ì‹œ ì„¸íŠ¸ëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤.
     */
    const LEGACY_PREFIX_SETS = [
        "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´",
        "ë ˆê±°ì‹œ: ìì—°ì˜ ìˆ˜í˜¸ì",
        "ë ˆê±°ì‹œ: ì—í…Œë¦¬ì–¼ ë¦¬ë² ë„ŒíŠ¸",
        "ë ˆê±°ì‹œ: ì§€ë‚˜ì˜¨ ì˜ê´‘ì˜ ì‹œëŒ€",
    ];

    // ìµì‹œë“œ íƒœê·¸ ì¢…ë¥˜: ì•„ì´í…œëª… ì•ì— "[ì„ ë´‰]", "[ì˜ì§€]", "[ì´ìƒ]" í˜•íƒœë¡œ ë¶™ìŒ
    const EXCEED_TAGS  = ["ì„ ë´‰", "ì˜ì§€", "ì´ìƒ"];

    // ìµì‹œë“œ ì•„ì´í…œì´ ì¡´ì¬í•˜ëŠ” ìŠ¬ë¡¯.
    // ë°©ì–´êµ¬ëŠ” ìƒì˜, ì•…ì„¸ëŠ” íŒ”ì°Œ, íŠ¹ìˆ˜ëŠ” ê·€ê±¸ì´ë§Œ ìµì‹œë“œ ë²„ì „ì´ ìˆìŒ.
    // ë‚˜ë¨¸ì§€ ìŠ¬ë¡¯(ì˜ˆ: í•˜ì˜, ëª©ê±¸ì´)ì—ëŠ” ìµì‹œë“œê°€ ì—†ìœ¼ë¯€ë¡œ ì¹´ìš´íŠ¸ì—ì„œ ì œì™¸í•´ì•¼ í•¨.
    const EXCEED_SLOTS = { ARMOR: ["ìƒì˜"], ACCESSORY: ["íŒ”ì°Œ"], SPECIAL: ["ê·€ê±¸ì´"] };


    // ============================================================
    // 3. ìˆœìˆ˜ ë¡œì§ í•¨ìˆ˜ë“¤
    // ============================================================

    /**
     * ì ‘ë‘ì–´ í‚¤ ìƒì„±
     *
     * ì•„ì´í…œì„ ì €ì¥í•  ë•Œ ì“°ëŠ” í‚¤(ë¬¸ìì—´)ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜.
     *
     * ì¼ë°˜ ì„¸íŠ¸:  "ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜" ì²˜ëŸ¼
     *             "ì ‘ë‘ì–´: ì„¸íŠ¸ëª… ìŠ¬ë¡¯" í˜•íƒœë¡œ ì €ì¥ë¨.
     *             ì´ í•¨ìˆ˜ëŠ” "ì ‘ë‘ì–´: ì„¸íŠ¸ëª…" ë¶€ë¶„(ìŠ¬ë¡¯ ì œì™¸)ì„ ë§Œë“ ë‹¤.
     *
     * ë ˆê±°ì‹œ ì„¸íŠ¸: ì„¸íŠ¸ëª…ì´ ì´ë¯¸ "ë ˆê±°ì‹œ: XXX" í˜•íƒœì´ë¯€ë¡œ
     *             ì•ì— "ë ˆê±°ì‹œ: "ë¥¼ ë˜ ë¶™ì´ë©´ "ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: XXX" ê°€ ë¨.
     *             ê·¸ë˜ì„œ ë ˆê±°ì‹œ ì„¸íŠ¸ëŠ” ì„¸íŠ¸ëª… ìì²´ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜.
     *
     * @param {string} pref    - ì ‘ë‘ì–´ ì´ë¦„ (ì˜ˆ: "ì „ê²©", "ë ˆê±°ì‹œ")
     * @param {string} setName - ì„¸íŠ¸ ì´ë¦„ (ì˜ˆ: "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ")
     * @returns {string} í‚¤ ë¬¸ìì—´
     *
     * ì˜ˆì‹œ:
     *   makePrefixKey("ì „ê²©", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ")   â†’ "ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ"
     *   makePrefixKey("ë ˆê±°ì‹œ", "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´") â†’ "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´"  (ì¤‘ë³µ ë°©ì§€)
     */
    function makePrefixKey(pref, setName) {
        // ë ˆê±°ì‹œ ì„¸íŠ¸ë©´ setName ìì²´ê°€ ì´ë¯¸ ì˜¬ë°”ë¥¸ í‚¤ â†’ ê·¸ëŒ€ë¡œ ë°˜í™˜
        if (LEGACY_PREFIX_SETS.includes(setName)) return setName;
        // ì¼ë°˜ ì„¸íŠ¸: "ì ‘ë‘ì–´: ì„¸íŠ¸ëª…" í˜•íƒœë¡œ ì¡°í•©
        return `${pref}: ${setName}`;
    }

    /**
     * ìµì‹œë“œ ì•„ì´í…œ ì—¬ë¶€ íŒë³„
     *
     * ì•„ì´í…œ í‚¤ ë¬¸ìì—´ì´ ìµì‹œë“œ í˜•íƒœ("[ì„ ë´‰] ...", "[ì˜ì§€] ...", "[ì´ìƒ] ...")ì¸ì§€ ê²€ì‚¬.
     * ì •ê·œì‹ìœ¼ë¡œ ë¬¸ìì—´ ì‹œì‘ ë¶€ë¶„ì„ ê²€ì‚¬í•œë‹¤.
     *
     * @param {string} name - ì•„ì´í…œ í‚¤ ë¬¸ìì—´
     * @returns {boolean}
     *
     * ì˜ˆì‹œ:
     *   isExceedName("[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜") â†’ true
     *   isExceedName("ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜")        â†’ false
     *   isExceedName("[ì„ ë´‰]ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜")  â†’ false  (ê´„í˜¸ ë’¤ ê³µë°± í•„ìˆ˜)
     */
    function isExceedName(name) {
        // ^ : ë¬¸ìì—´ ì‹œì‘
        // \[ : ì—¬ëŠ” ê´„í˜¸ (íŠ¹ìˆ˜ë¬¸ìë¼ ë°±ìŠ¬ë˜ì‹œ í•„ìš”)
        // (ì„ ë´‰|ì˜ì§€|ì´ìƒ) : ì„¸ íƒœê·¸ ì¤‘ í•˜ë‚˜
        // \] : ë‹«ëŠ” ê´„í˜¸
        // \s : ê³µë°± í•œ ì¹¸ (ê³µë°± ì—†ìœ¼ë©´ ë¶ˆì¼ì¹˜)
        return /^\[(ì„ ë´‰|ì˜ì§€|ì´ìƒ)\]\s/.test(name);
    }

    /**
     * ìµì‹œë“œ íƒœê·¸ ì œê±° â†’ ë² ì´ìŠ¤ í‚¤ ë°˜í™˜
     *
     * "[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜" ì—ì„œ "[ì„ ë´‰] " ë¶€ë¶„ì„ ì œê±°í•´
     * "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜" ë¥¼ ëŒë ¤ì¤€ë‹¤.
     * ìµì‹œë“œê°€ ì•„ë‹Œ ë¬¸ìì—´ì€ ê·¸ëŒ€ë¡œ ë°˜í™˜.
     *
     * @param {string} name - ì•„ì´í…œ í‚¤ ë¬¸ìì—´
     * @returns {string}
     */
    function getGroupKey(name) {
        // /^\[.*?\]\s*/ : ë¬¸ìì—´ ì‹œì‘ì˜ "[...]" ê³¼ ë’¤ë”°ë¥´ëŠ” ê³µë°±ì„ ë¹ˆ ë¬¸ìì—´ë¡œ ì¹˜í™˜
        // .*? : ìµœì†Œ ì¼ì¹˜ (íƒìš•ì ì´ì§€ ì•ŠìŒ, ì²« ë²ˆì§¸ ']' ì—ì„œ ë©ˆì¶¤)
        return name.replace(/^\[.*?\]\s*/, "");
    }

    /**
     * ì„¸íŠ¸ íƒ€ì… íŒë³„ (ARMOR / ACCESSORY / SPECIAL)
     *
     * ì„¸íŠ¸ ì´ë¦„ì„ ë°›ì•„ì„œ ì–´ëŠ ì¹´í…Œê³ ë¦¬ì¸ì§€ ë°˜í™˜.
     * íŒë³„ ìˆœì„œ:
     *   1. ì„¸íŠ¸ëª…ìœ¼ë¡œ ì§ì ‘ ARMOR_SETS / ACCESSORY_SETS / SPECIAL_SETS ê²€ìƒ‰
     *   2. ì—†ìœ¼ë©´ "ì ‘ë‘ì–´: ì„¸íŠ¸ëª…" ì—ì„œ ì„¸íŠ¸ëª… ë¶€ë¶„ë§Œ ì¶”ì¶œí•´ ì¬ê²€ìƒ‰
     *   3. ê·¸ë˜ë„ ì—†ìœ¼ë©´ LEGACY_PREFIX_SETS ìˆœíšŒë¡œ ê²€ìƒ‰
     *   4. ìµœí›„ì—ë„ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ "ARMOR" ë°˜í™˜
     *
     * @param {string} setName
     * @returns {"ARMOR"|"ACCESSORY"|"SPECIAL"}
     */
    function getSetType(setName) {
        // 1ë‹¨ê³„: ì„¸íŠ¸ëª… ì§ì ‘ ê²€ìƒ‰
        if (ARMOR_SETS[setName])     return "ARMOR";
        if (ACCESSORY_SETS[setName]) return "ACCESSORY";
        if (SPECIAL_SETS[setName])   return "SPECIAL";

        // 2ë‹¨ê³„: "ì „ê²©: ë§ê´„ëŸ‰ì´" í˜•íƒœë©´ ":" ë’¤ë¥¼ ì˜ë¼ì„œ ì¬ê²€ìƒ‰
        const baseName = setName.includes(':') ? setName.split(':').pop().trim() : setName;
        if (ARMOR_SETS[baseName])     return "ARMOR";
        if (ACCESSORY_SETS[baseName]) return "ACCESSORY";
        if (SPECIAL_SETS[baseName])   return "SPECIAL";

        // 3ë‹¨ê³„: ë ˆê±°ì‹œ ì„¸íŠ¸ ìˆœíšŒ
        for (const legacyName of LEGACY_PREFIX_SETS) {
            if (setName === legacyName || setName.endsWith(legacyName)) {
                if (ARMOR_SETS[legacyName])     return "ARMOR";
                if (ACCESSORY_SETS[legacyName]) return "ACCESSORY";
            }
        }

        return "ARMOR"; // ê¸°ë³¸ê°’ (ì•Œ ìˆ˜ ì—†ëŠ” ì„¸íŠ¸)
    }

    /**
     * ìºë¦­í„°ê°€ ë³´ìœ í•œ ì„¸íŠ¸ì˜ ê³ ìœ  íŒŒì¸  ìˆ˜ ê³„ì‚°
     *
     * "ê³ ìœ  íŒŒì¸ "ë€: ê°™ì€ ìŠ¬ë¡¯(ì˜ˆ: ìƒì˜)ì´ë©´ ì¼ë°˜/ì ‘ë‘ì–´/ìµì‹œë“œ ì¤‘
     * ì–´ë–¤ ì¢…ë¥˜ë¥¼ ë³´ìœ í–ˆë“  ë”± 1ê°œë¡œ ì¹´ìš´íŠ¸í•œë‹¤.
     * ì¦‰ ìƒì˜ë¥¼ ì¼ë°˜+ì „ê²© 2ê°œ ë³´ìœ í•´ë„ ìƒì˜ ìŠ¬ë¡¯ì€ 1ê°œ.
     *
     * ë¡œì§:
     *   1. ì„¸íŠ¸ì˜ ìŠ¬ë¡¯ ëª©ë¡ì„ ê°€ì ¸ì˜´ (ì˜ˆ: ["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"])
     *   2. ê²€ìƒ‰í•  ì´ë¦„ ëª©ë¡ ìƒì„±:
     *      - ì¼ë°˜ ì„¸íŠ¸: ì„¸íŠ¸ëª… ìì²´ ì¶”ê°€
     *      - ë ˆê±°ì‹œ ì„¸íŠ¸: ì¼ë°˜ í–‰ì´ ì—†ìœ¼ë¯€ë¡œ ì„¸íŠ¸ëª…ì€ ì¶”ê°€ ì•ˆ í•¨
     *      - ì ‘ë‘ì–´ë³„ë¡œ makePrefixKey ë¡œ í‚¤ ìƒì„± í›„ ì¶”ê°€
     *      - ê° ì ‘ë‘ì–´ í‚¤ì— ìµì‹œë“œ íƒœê·¸ ì¡°í•©í•´ì„œë„ ì¶”ê°€
     *   3. ìŠ¬ë¡¯ë³„ë¡œ ìœ„ ì´ë¦„ ëª©ë¡ ì¤‘ í•˜ë‚˜ë¼ë„ count > 0 ì´ë©´ í•´ë‹¹ ìŠ¬ë¡¯ ë³´ìœ ë¡œ íŒì •
     *   4. ë³´ìœ  ìŠ¬ë¡¯ ìˆ˜ í•©ì‚°í•´ì„œ ë°˜í™˜
     *
     * @param {object} char        - ìºë¦­í„° ê°ì²´ { armorCounts: { "í‚¤": ìˆ«ì, ... } }
     * @param {string} baseSetName - ì„¸íŠ¸ ê¸°ë³¸ ì´ë¦„
     * @returns {number} ë³´ìœ  ì¤‘ì¸ ê³ ìœ  ìŠ¬ë¡¯ ìˆ˜
     */
    function calcTotalDistinctParts(char, baseSetName) {
        const slots       = ALL_SETS[baseSetName]   || []; // ì´ ì„¸íŠ¸ì˜ ìŠ¬ë¡¯ ëª©ë¡
        const prefixes    = ALL_PREFIX[baseSetName] || []; // ì´ ì„¸íŠ¸ì˜ ì ‘ë‘ì–´ ëª©ë¡
        const setType     = getSetType(baseSetName);
        const exceedSlots = EXCEED_SLOTS[setType]   || []; // ìµì‹œë“œê°€ ì¡´ì¬í•˜ëŠ” ìŠ¬ë¡¯

        // ê²€ìƒ‰í•  ì´ë¦„(í‚¤ ì•ë¶€ë¶„) ëª©ë¡ êµ¬ì„±
        const namesToSearch = [];

        // ë ˆê±°ì‹œ ì„¸íŠ¸ëŠ” ì¼ë°˜ í–‰ì´ ì—†ìŒ â†’ ì„¸íŠ¸ëª…ì„ ëª©ë¡ì— ë„£ì§€ ì•ŠìŒ
        // ì¼ë°˜ ì„¸íŠ¸ëŠ” ì„¸íŠ¸ëª… ìì²´ê°€ í•˜ë‚˜ì˜ í‚¤ prefix ê°€ ë¨
        if (!LEGACY_PREFIX_SETS.includes(baseSetName)) {
            namesToSearch.push(baseSetName);
        }

        // ì ‘ë‘ì–´ë³„ í‚¤ ì¶”ê°€ (ì˜ˆ: "ì „ê²©: ë§ê´„ëŸ‰ì´", "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´")
        prefixes.forEach(p => {
            const prefKey = makePrefixKey(p, baseSetName);
            namesToSearch.push(prefKey);

            // ê° ì ‘ë‘ì–´ í‚¤ì˜ ìµì‹œë“œ ë²„ì „ë„ ì¶”ê°€ (ì˜ˆ: "[ì„ ë´‰] ì „ê²©: ë§ê´„ëŸ‰ì´")
            EXCEED_TAGS.forEach(ex => namesToSearch.push(`[${ex}] ${prefKey}`));
        });

        let totalDistinct = 0;

        // ìŠ¬ë¡¯ë³„ë¡œ ë³´ìœ  ì—¬ë¶€ ì²´í¬
        slots.forEach(slot => {
            let hasPartInSlot = false;

            namesToSearch.forEach(nameComponent => {
                const isExceedKey = nameComponent.startsWith('[');

                // ìµì‹œë“œ í‚¤ì¸ë° ì´ ìŠ¬ë¡¯ì´ ìµì‹œë“œ ìŠ¬ë¡¯ì´ ì•„ë‹ˆë©´ â†’ ìŠ¤í‚µ
                // ì˜ˆ: "[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ í•˜ì˜" â€” í•˜ì˜ëŠ” ìµì‹œë“œ ìŠ¬ë¡¯ ì•„ë‹˜
                if (isExceedKey && !exceedSlots.includes(slot)) return;

                // ì‹¤ì œ ì €ì¥ í‚¤: "ì´ë¦„ ìŠ¬ë¡¯" (ì˜ˆ: "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜")
                const fullKey = `${nameComponent} ${slot}`;
                if ((char.armorCounts[fullKey] || 0) > 0) {
                    hasPartInSlot = true;
                }
            });

            if (hasPartInSlot) totalDistinct++;
        });

        return totalDistinct;
    }

    /**
     * ì•„ì´í…œ ì¹´ìš´íŠ¸ ì¦ê°€
     * ì›ë³¸ì˜ increment() ì—ì„œ DOM ì¡°ì‘(saveLocalData, showSetButtons ë“±)ì„ ì œê±°í•œ ìˆœìˆ˜ ë²„ì „.
     *
     * @param {object} char - ìºë¦­í„° ê°ì²´
     * @param {string} key  - ì•„ì´í…œ í‚¤ (ì˜ˆ: "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜")
     */
    function incrementCount(char, key) {
        // í‚¤ê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì‹œì‘í•´ì„œ +1
        char.armorCounts[key] = (char.armorCounts[key] || 0) + 1;
    }

    /**
     * ì•„ì´í…œ ì¹´ìš´íŠ¸ ê°ì†Œ (0 ë¯¸ë§Œ ë°©ì§€)
     *
     * @param {object} char - ìºë¦­í„° ê°ì²´
     * @param {string} key  - ì•„ì´í…œ í‚¤
     */
    function decrementCount(char, key) {
        const cur = char.armorCounts[key] || 0;
        // Math.max(0, ...) ë¡œ ìŒìˆ˜ ë°©ì§€
        char.armorCounts[key] = Math.max(0, cur - 1);
    }

    /**
     * ìºë¦­í„° ì´ë¦„ìˆœ ì •ë ¬
     * ì›ë³¸ ë°°ì—´ì„ ë³€ê²½í•˜ì§€ ì•Šê³  ìƒˆ ë°°ì—´ì„ ë°˜í™˜í•œë‹¤. ([...characters] ë¡œ ë³µì‚¬)
     * localeCompare('ko-KR') ë¡œ í•œêµ­ì–´ ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬.
     *
     * @param {Array} characters - ìºë¦­í„° ë°°ì—´
     * @returns {Array} ì •ë ¬ëœ ìƒˆ ë°°ì—´
     */
    function sortByName(characters) {
        return [...characters].sort((a, b) => a.name.localeCompare(b.name, 'ko-KR'));
    }

    /**
     * ìºë¦­í„° ì§ì—…ìˆœ ì •ë ¬ (ê°™ì€ ì§ì—… ë‚´ì—ì„œëŠ” ì´ë¦„ìˆœ)
     *
     * @param {Array} characters
     * @returns {Array} ì •ë ¬ëœ ìƒˆ ë°°ì—´
     */
    function sortByJob(characters) {
        return [...characters].sort((a, b) => {
            const jobCompare = a.job.localeCompare(b.job, 'ko-KR');
            if (jobCompare !== 0) return jobCompare; // ì§ì—…ì´ ë‹¤ë¥´ë©´ ì§ì—…ìˆœ
            return a.name.localeCompare(b.name, 'ko-KR'); // ì§ì—… ê°™ìœ¼ë©´ ì´ë¦„ìˆœ
        });
    }

    /**
     * ì„¸íŠ¸ ì™„ì„±ë„ íŒë³„ (3ì…‹ / 5ì…‹)
     *
     * ë³´ìœ  íŒŒì¸  ìˆ˜ê°€ ì „ì²´ ìŠ¬ë¡¯ì˜ 60% ì´ìƒì´ë©´ 3ì…‹, 100%ë©´ 5ì…‹ìœ¼ë¡œ íŒì •.
     * ë°©ì–´êµ¬(5ìŠ¬ë¡¯): 3ê°œ ì´ìƒ â†’ 3ì…‹, 5ê°œ â†’ 5ì…‹
     * ì•…ì„¸/íŠ¹ìˆ˜(3ìŠ¬ë¡¯): 2ê°œ ì´ìƒ â†’ 3ì…‹, 3ê°œ â†’ 5ì…‹
     *
     * @param {number} count   - ë³´ìœ  íŒŒì¸  ìˆ˜
     * @param {string} setName - ì„¸íŠ¸ ì´ë¦„
     * @returns {3|5|null} ì™„ì„±ë„ ë“±ê¸‰, ë¯¸ë‹¬ì´ë©´ null
     */
    function getSetType3or5(count, setName) {
        const slots = ALL_SETS[setName] || [];
        const total = slots.length;
        if (total === 0) return null; // ì•Œ ìˆ˜ ì—†ëŠ” ì„¸íŠ¸

        const ratio = count / total;
        if (ratio >= 1.0) return 5; // 100% â†’ 5ì…‹
        if (ratio >= 0.6) return 3; // 60% ì´ìƒ â†’ 3ì…‹
        return null;
    }



    /* ============================================================
       â‘¡ ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
       ------------------------------------------------------------
       Node.js ì˜ node:test + assert ëª¨ë“ˆì„ ë¸Œë¼ìš°ì €ì—ì„œ ì“¸ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ
       ê°™ì€ ì¸í„°í˜ì´ìŠ¤(describe/test/assert)ë¥¼ ì§ì ‘ êµ¬í˜„í•¨.
       ë•ë¶„ì— logic.test.js ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ import ì¤„ë§Œ ì œê±°í•˜ê³ 
       ê·¸ëŒ€ë¡œ ê°€ì ¸ë‹¤ ì“¸ ìˆ˜ ìˆë‹¤.
       ============================================================ */

    // í…ŒìŠ¤íŠ¸ ë“±ë¡ ì €ì¥ì†Œ
    // describe() ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ ì—¬ê¸°ì— ìŒ“ì„
    const _suites = [];
    let _currentSuite = null; // í˜„ì¬ ë“±ë¡ ì¤‘ì¸ suite (describe ë¸”ë¡)

    /**
     * í…ŒìŠ¤íŠ¸ ê·¸ë£¹ ë“±ë¡ í•¨ìˆ˜.
     * Node.js ì˜ describe() ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤.
     *
     * ë™ì‘ ìˆœì„œ:
     *   1. ìƒˆ suite ê°ì²´ ìƒì„± í›„ _suites ë°°ì—´ì— ì¶”ê°€
     *   2. fn() ì¦‰ì‹œ ì‹¤í–‰ â†’ fn ì•ˆì˜ test() ë“¤ì´ suite.tests ì— ë“±ë¡ë¨
     *   3. ë“±ë¡ ì™„ë£Œ í›„ _currentSuite ë¥¼ null ë¡œ ì´ˆê¸°í™”
     *
     * ì£¼ì˜: fn() ì‹¤í–‰ ì‹œì ì— í…ŒìŠ¤íŠ¸ê°€ "ì‹¤í–‰"ë˜ëŠ” ê²Œ ì•„ë‹ˆë¼ "ë“±ë¡"ë§Œ ë¨.
     *       ì‹¤ì œ ì‹¤í–‰ì€ runAll() ì—ì„œ í•œë‹¤.
     */
    function describe(name, fn) {
        _currentSuite = { name, tests: [] };
        _suites.push(_currentSuite);
        fn(); // ì´ ì•ˆì—ì„œ test() ë“¤ì´ _currentSuite.tests ì— push ë¨
        _currentSuite = null;
    }

    /**
     * ê°œë³„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë“±ë¡ í•¨ìˆ˜.
     * Node.js ì˜ test() ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤.
     *
     * fn ì„ ì¦‰ì‹œ ì‹¤í–‰í•˜ì§€ ì•Šê³  ì €ì¥ë§Œ í•´ë‘ .
     * ì‹¤í–‰ì€ runAll() â†’ suite.tests.forEach ì—ì„œ fn() ì´ í˜¸ì¶œë  ë•Œ.
     */
    function test(name, fn) {
        if (!_currentSuite) throw new Error('test()ëŠ” describe() ì•ˆì—ì„œë§Œ ì‚¬ìš©í•˜ì„¸ìš”');
        _currentSuite.tests.push({ name, fn });
    }

    /**
     * assert í˜¸í™˜ ë ˆì´ì–´.
     * Node.js ì˜ assert/strict ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤.
     *
     * ê°’ì´ ê¸°ëŒ€ì™€ ë‹¤ë¥´ë©´ Error ë¥¼ throw í•œë‹¤.
     * throw ëœ ì—ëŸ¬ëŠ” runAll() ì˜ try/catch ê°€ ì¡ì•„ì„œ ì‹¤íŒ¨ë¡œ ê¸°ë¡.
     */
    const assert = {
        /**
         * ë‘ ê°’ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ (=== ì—„ê²© ë¹„êµ)
         * ì˜ˆ: assert.equal(ì‹¤ì œê°’, ê¸°ëŒ“ê°’)
         */
        equal(a, b, msg) {
            if (a !== b) throw new Error(
                msg || `Expected ${JSON.stringify(b)}, got ${JSON.stringify(a)}`
            );
        },
        /**
         * ë‘ ê°’ì˜ ë‚´ìš©ì´ ê°™ì€ì§€ í™•ì¸ (ë°°ì—´/ê°ì²´ìš©)
         * JSON.stringify ë¡œ ì§ë ¬í™”í•´ì„œ ë¬¸ìì—´ ë¹„êµ.
         * ì˜ˆ: assert.deepEqual([1,2], [1,2]) â†’ í†µê³¼
         */
        deepEqual(a, b, msg) {
            const sa = JSON.stringify(a), sb = JSON.stringify(b);
            if (sa !== sb) throw new Error(msg || `Expected ${sb}, got ${sa}`);
        },
        /**
         * ê°’ì´ truthy ì¸ì§€ í™•ì¸
         * ì˜ˆ: assert.ok(true) â†’ í†µê³¼, assert.ok(false) â†’ ì‹¤íŒ¨
         *     assert.ok(!isExceedName("ì¼ë°˜")) â†’ ê²°ê³¼ê°€ false ì—¬ì•¼ í†µê³¼
         */
        ok(val, msg) {
            if (!val) throw new Error(
                msg || `Expected truthy, got ${JSON.stringify(val)}`
            );
        },
    };

    /* ============================================================
       â‘¢ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë“±ë¡
       ------------------------------------------------------------
       logic.test.js ì—ì„œ import ì¤„ì„ ì œê±°í•œ ë‚˜ë¨¸ì§€ ì½”ë“œ ê·¸ëŒ€ë¡œ.
       ìœ„ì—ì„œ ì •ì˜í•œ describe/test/assert ë¥¼ ì‚¬ìš©í•´
       _suites ë°°ì—´ì— í…ŒìŠ¤íŠ¸ë“¤ì´ ë“±ë¡ëœë‹¤.
       (ì´ ì‹œì ì—” ì‹¤í–‰ ì•ˆ ë¨ â€” ë“±ë¡ë§Œ)
       ============================================================ */
    function makeChar(armorCounts = {}) {
        return { id: 'c1', name: 'í…ŒìŠ¤íŠ¸', job: 'ê·€ê²€ì‚¬', armorCounts, updateTimes: {} };
    }


    // ============================================================
    // 1. makePrefixKey í…ŒìŠ¤íŠ¸
    //    ì ‘ë‘ì–´ í‚¤ë¥¼ ì˜¬ë°”ë¥´ê²Œ ìƒì„±í•˜ëŠ”ì§€ ê²€ì¦.
    //    íŠ¹íˆ ë ˆê±°ì‹œ ì„¸íŠ¸ì—ì„œ "ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: XXX" ê°€ ë˜ì§€ ì•ŠëŠ”ì§€ê°€ í•µì‹¬.
    // ============================================================
    describe('makePrefixKey', () => {

        test('ì¼ë°˜ ì„¸íŠ¸ â†’ "ì ‘ë‘ì–´: ì„¸íŠ¸ëª…" í˜•ì‹ ë°˜í™˜', () => {
            // ì¼ë°˜ ì„¸íŠ¸ëŠ” "ì „ê²©: ë§ê´„ëŸ‰ì´" í˜•íƒœê°€ ë˜ì–´ì•¼ í•¨
            assert.equal(
                makePrefixKey('ì „ê²©', 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'),
                'ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'
            );
        });

        test('ì¼ë°˜ ì„¸íŠ¸ â€” ë‹¤ë¥¸ ì ‘ë‘ì–´ë„ ë™ì¼ íŒ¨í„´', () => {
            assert.equal(
                makePrefixKey('ì‘ì—´', 'í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë”'),
                'ì‘ì—´: í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë”'
            );
        });

        test('ë ˆê±°ì‹œ ë°©ì–´êµ¬ ì„¸íŠ¸ â†’ setName ê·¸ëŒ€ë¡œ ë°˜í™˜ (ì¤‘ë³µ ì ‘ë‘ì–´ ë°©ì§€)', () => {
            // âŒ ì˜ëª»ëœ ê²°ê³¼: "ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´"
            // âœ… ì˜¬ë°”ë¥¸ ê²°ê³¼: "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´"  (ì„¸íŠ¸ëª… ê·¸ëŒ€ë¡œ)
            assert.equal(
                makePrefixKey('ë ˆê±°ì‹œ', 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'),
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'
            );
        });

        test('ë ˆê±°ì‹œ ë°©ì–´êµ¬ ë‘ ë²ˆì§¸ ì„¸íŠ¸ë„ ë™ì¼', () => {
            assert.equal(
                makePrefixKey('ë ˆê±°ì‹œ', 'ë ˆê±°ì‹œ: ìì—°ì˜ ìˆ˜í˜¸ì'),
                'ë ˆê±°ì‹œ: ìì—°ì˜ ìˆ˜í˜¸ì'
            );
        });

        test('ë ˆê±°ì‹œ ì•…ì„¸ ì²« ë²ˆì§¸ ì„¸íŠ¸', () => {
            assert.equal(
                makePrefixKey('ë ˆê±°ì‹œ', 'ë ˆê±°ì‹œ: ì—í…Œë¦¬ì–¼ ë¦¬ë² ë„ŒíŠ¸'),
                'ë ˆê±°ì‹œ: ì—í…Œë¦¬ì–¼ ë¦¬ë² ë„ŒíŠ¸'
            );
        });

        test('ë ˆê±°ì‹œ ì•…ì„¸ ë‘ ë²ˆì§¸ ì„¸íŠ¸', () => {
            assert.equal(
                makePrefixKey('ë ˆê±°ì‹œ', 'ë ˆê±°ì‹œ: ì§€ë‚˜ì˜¨ ì˜ê´‘ì˜ ì‹œëŒ€'),
                'ë ˆê±°ì‹œ: ì§€ë‚˜ì˜¨ ì˜ê´‘ì˜ ì‹œëŒ€'
            );
        });

        test('ëª¨ë“  LEGACY_PREFIX_SETS í•­ëª©ì— ëŒ€í•´ ì¤‘ë³µ ì ‘ë‘ì–´ ì—†ìŒ', () => {
            // 4ê°œ ë ˆê±°ì‹œ ì„¸íŠ¸ ì „ì²´ë¥¼ í•œ ë²ˆì— ìˆœíšŒí•´ì„œ ê²€ì¦
            for (const setName of LEGACY_PREFIX_SETS) {
                const key = makePrefixKey('ë ˆê±°ì‹œ', setName);
                // ë°˜í™˜ê°’ì´ ì„¸íŠ¸ëª… ìì²´ì™€ ê°™ì•„ì•¼ í•¨
                assert.equal(key, setName, `${setName} í‚¤ ì¤‘ë³µ ë°œìƒ`);
                // í˜¹ì‹œë¼ë„ "ë ˆê±°ì‹œ: ë ˆê±°ì‹œ:" ë¡œ ì‹œì‘í•˜ë©´ ë²„ê·¸
                assert.ok(!key.startsWith('ë ˆê±°ì‹œ: ë ˆê±°ì‹œ:'), `ì¤‘ë³µ ì ‘ë‘ì–´ ë°œìƒ: ${key}`);
            }
        });
    });


    // ============================================================
    // 2. isExceedName í…ŒìŠ¤íŠ¸
    //    ì•„ì´í…œ í‚¤ê°€ "[ì„ ë´‰/ì˜ì§€/ì´ìƒ] ..." í˜•íƒœì¸ì§€ íŒë³„í•˜ëŠ” ì •ê·œì‹ ê²€ì¦.
    // ============================================================
    describe('isExceedName', () => {

        // --- true ê°€ ë‚˜ì™€ì•¼ í•˜ëŠ” ì¼€ì´ìŠ¤ ---

        test('[ì„ ë´‰] ì ‘ë‘ì–´ â†’ true', () => {
            // assert.ok(ê°’) : ê°’ì´ truthy ë©´ í†µê³¼
            assert.ok(isExceedName('[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜'));
        });

        test('[ì˜ì§€] ì ‘ë‘ì–´ â†’ true', () => {
            assert.ok(isExceedName('[ì˜ì§€] ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜'));
        });

        test('[ì´ìƒ] ì ‘ë‘ì–´ â†’ true', () => {
            assert.ok(isExceedName('[ì´ìƒ] í¬ì´ì¦ˆë‹ í€¸ ìŠ¤íŒŒì´ë” ìƒì˜'));
        });

        // --- false ê°€ ë‚˜ì™€ì•¼ í•˜ëŠ” ì¼€ì´ìŠ¤ ---

        test('ì¼ë°˜ ì•„ì´í…œëª… â†’ false', () => {
            // assert.ok(!ê°’) : ê°’ì´ falsy ë©´ í†µê³¼
            assert.ok(!isExceedName('ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜'));
        });

        test('ì ‘ë‘ì–´ ì•„ì´í…œëª… â†’ false', () => {
            assert.ok(!isExceedName('ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜'));
        });

        test('ë ˆê±°ì‹œ ì ‘ë‘ì–´ ì•„ì´í…œëª… â†’ false', () => {
            // "ë ˆê±°ì‹œ: ..." ëŠ” ìµì‹œë“œê°€ ì•„ë‹ˆë¼ ì ‘ë‘ì–´ ì•„ì´í…œ
            assert.ok(!isExceedName('ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜'));
        });

        test('ë¹ˆ ë¬¸ìì—´ â†’ false', () => {
            assert.ok(!isExceedName(''));
        });

        test('ê³µë°±ì´ ì—†ëŠ” ê´„í˜¸ í˜•ì‹ì€ false (íŒ¨í„´ ë¶ˆì¼ì¹˜)', () => {
            // ì •ê·œì‹ì´ "[íƒœê·¸] " (ê³µë°± í¬í•¨) ë¥¼ ìš”êµ¬í•˜ë¯€ë¡œ ê³µë°± ì—†ìœ¼ë©´ false
            // "[ì„ ë´‰]ë ˆê±°ì‹œ..." ì²˜ëŸ¼ ê³µë°± ì—†ëŠ” ê²½ìš°ëŠ” ì˜ëª»ëœ ë°ì´í„°ì´ë¯€ë¡œ false ê°€ ë§ìŒ
            assert.ok(!isExceedName('[ì„ ë´‰]ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜'));
        });

        test('EXCEED_TAGS ì „ì²´ ê²€ì¦ (ì„ ë´‰/ì˜ì§€/ì´ìƒ ëª¨ë‘ ì¸ì‹)', () => {
            // EXCEED_TAGS ë°°ì—´ì„ ìˆœíšŒí•´ì„œ ì„¸ íƒœê·¸ ëª¨ë‘ ì •ìƒ ì¸ì‹ë˜ëŠ”ì§€ í™•ì¸
            for (const tag of EXCEED_TAGS) {
                assert.ok(isExceedName(`[${tag}] ì–´ëŠ ì„¸íŠ¸ëª… ìƒì˜`), `íƒœê·¸ [${tag}] ì¸ì‹ ì‹¤íŒ¨`);
            }
        });
    });


    // ============================================================
    // 3. getGroupKey í…ŒìŠ¤íŠ¸
    //    "[ì„ ë´‰] XXX" ì—ì„œ "[ì„ ë´‰] " ë¶€ë¶„ì„ ì œê±°í•˜ê³  "XXX" ë§Œ ë°˜í™˜í•˜ëŠ”ì§€ ê²€ì¦.
    // ============================================================
    describe('getGroupKey', () => {

        test('ìµì‹œë“œ ì ‘ë‘ì–´ ì œê±° â†’ ë² ì´ìŠ¤ í‚¤ ë°˜í™˜', () => {
            assert.equal(
                getGroupKey('[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜'),
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜'  // "[ì„ ë´‰] " ì´ ì œê±°ë¨
            );
        });

        test('[ì˜ì§€] ì œê±°', () => {
            assert.equal(
                getGroupKey('[ì˜ì§€] ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'),
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'
            );
        });

        test('ê´„í˜¸ ì—†ëŠ” ë¬¸ìì—´ì€ ê·¸ëŒ€ë¡œ ë°˜í™˜', () => {
            // ì¼ë°˜ ì•„ì´í…œì€ ë³€ê²½ ì—†ì´ ê·¸ëŒ€ë¡œ
            assert.equal(
                getGroupKey('ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜'),
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜'
            );
        });

        test('ì ‘ë‘ì–´ í‚¤ â†’ ë³€ê²½ ì—†ì´ ë°˜í™˜', () => {
            // "ì „ê²©: ..." ì€ ìµì‹œë“œ íƒœê·¸ê°€ ì•„ë‹ˆë¼ ì ‘ë‘ì–´ í‚¤ì´ë¯€ë¡œ ë³€ê²½ ì—†ìŒ
            assert.equal(
                getGroupKey('ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'),
                'ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'
            );
        });
    });


    // ============================================================
    // 4. getSetType í…ŒìŠ¤íŠ¸
    //    ì„¸íŠ¸ ì´ë¦„ìœ¼ë¡œ ARMOR / ACCESSORY / SPECIAL ì„ ì˜¬ë°”ë¥´ê²Œ íŒë³„í•˜ëŠ”ì§€ ê²€ì¦.
    // ============================================================
    describe('getSetType', () => {

        test('ë°©ì–´êµ¬ ì„¸íŠ¸ â†’ ARMOR', () => {
            // í•˜ë‚˜ì˜ test() ì•ˆì— ì—¬ëŸ¬ assert ë¥¼ ë„£ì„ ìˆ˜ ìˆìŒ
            assert.equal(getSetType('ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'), 'ARMOR');
            assert.equal(getSetType('ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€'), 'ARMOR');
        });

        test('ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸ â†’ ACCESSORY', () => {
            assert.equal(getSetType('ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ'), 'ACCESSORY');
            assert.equal(getSetType('ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ ì—°ì‚°ì¥ì¹˜'), 'ACCESSORY');
        });

        test('íŠ¹ìˆ˜ì¥ë¹„ ì„¸íŠ¸ â†’ SPECIAL', () => {
            assert.equal(getSetType('ê°œêµ¬ìŸì´ í˜¸ë¬¸ì¿¨ë£¨ìŠ¤'), 'SPECIAL');
            assert.equal(getSetType('ë¶€ì •í•œ ë¹›ì˜ ìš°ìƒ'), 'SPECIAL');
        });

        test('ë ˆê±°ì‹œ ë°©ì–´êµ¬ ì„¸íŠ¸ â†’ ARMOR', () => {
            // ë ˆê±°ì‹œ ì„¸íŠ¸ë„ ì¹´í…Œê³ ë¦¬ íŒë³„ì´ ì •í™•í•´ì•¼ í•¨
            assert.equal(getSetType('ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 'ARMOR');
            assert.equal(getSetType('ë ˆê±°ì‹œ: ìì—°ì˜ ìˆ˜í˜¸ì'), 'ARMOR');
        });

        test('ë ˆê±°ì‹œ ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸ â†’ ACCESSORY', () => {
            assert.equal(getSetType('ë ˆê±°ì‹œ: ì—í…Œë¦¬ì–¼ ë¦¬ë² ë„ŒíŠ¸'), 'ACCESSORY');
            assert.equal(getSetType('ë ˆê±°ì‹œ: ì§€ë‚˜ì˜¨ ì˜ê´‘ì˜ ì‹œëŒ€'), 'ACCESSORY');
        });
    });


    // ============================================================
    // 5. calcTotalDistinctParts í…ŒìŠ¤íŠ¸
    //    ì´ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§.
    //    "ê°™ì€ ìŠ¬ë¡¯ì´ë©´ ì¢…ë¥˜ ë¬´ê´€ 1ê°œ" ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦.
    // ============================================================
    describe('calcTotalDistinctParts', () => {

        // â”€â”€ ì¼ë°˜ ì„¸íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        test('ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ 0', () => {
            const char = makeChar({}); // ë¹ˆ ìºë¦­í„°
            assert.equal(calcTotalDistinctParts(char, 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'), 0);
        });

        test('ì¼ë°˜ ìƒì˜ 1ê°œ ë³´ìœ  â†’ 1', () => {
            // armorCounts ì— "ì„¸íŠ¸ëª… ìŠ¬ë¡¯" í˜•íƒœì˜ í‚¤ë¡œ ì €ì¥ë¨
            const char = makeChar({ 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜': 1 });
            assert.equal(calcTotalDistinctParts(char, 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'), 1);
        });

        test('ì¼ë°˜ ìƒì˜+í•˜ì˜ ë³´ìœ  â†’ 2', () => {
            const char = makeChar({
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜': 1,
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ í•˜ì˜': 1,
            });
            assert.equal(calcTotalDistinctParts(char, 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'), 2);
        });

        test('ê°™ì€ ìŠ¬ë¡¯ì„ ì¼ë°˜+ì ‘ë‘ì–´ë¡œ ë³´ìœ í•´ë„ 1ë¡œë§Œ ì¹´ìš´íŠ¸', () => {
            // ìƒì˜ë¥¼ "ì¼ë°˜ ìƒì˜" ì™€ "ì „ê²© ì ‘ë‘ì–´ ìƒì˜" ë‘ ì¢…ë¥˜ ë³´ìœ í•´ë„
            // ìƒì˜ ìŠ¬ë¡¯ì€ 1ê°œë¡œë§Œ ì¹´ìš´íŠ¸ë¨ (ê³ ìœ  ìŠ¬ë¡¯ ê¸°ì¤€)
            const char = makeChar({
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜': 1,
                'ì „ê²©: ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜': 1,
            });
            assert.equal(calcTotalDistinctParts(char, 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'), 1);
        });

        test('5ê°œ ìŠ¬ë¡¯ ì „ë¶€ ë³´ìœ  â†’ 5', () => {
            const char = makeChar({
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜': 1,
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ í•˜ì˜': 1,
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ì–´ê¹¨': 1,
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ë²¨íŠ¸': 1,
                'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ì‹ ë°œ': 1,
            });
            assert.equal(calcTotalDistinctParts(char, 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'), 5);
        });

        // â”€â”€ ë ˆê±°ì‹œ ì„¸íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ë ˆê±°ì‹œ ì„¸íŠ¸ëŠ” ì¼ë°˜ í–‰ì´ ì—†ê³  ì ‘ë‘ì–´(ë ˆê±°ì‹œ)ë¡œë§Œ ì¡´ì¬í•¨.
        // í‚¤ í˜•ì‹: "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜" (ì¤‘ë³µ ì ‘ë‘ì–´ ì—†ì´)

        test('ë ˆê±°ì‹œ ì„¸íŠ¸ â€” ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ 0', () => {
            const char = makeChar({});
            assert.equal(calcTotalDistinctParts(char, 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 0);
        });

        test('ë ˆê±°ì‹œ ì„¸íŠ¸ â€” ì˜¬ë°”ë¥¸ í‚¤("ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜")ë¡œ ì¹´ìš´íŠ¸ë¨', () => {
            // ë ˆê±°ì‹œ ì„¸íŠ¸ì˜ ì €ì¥ í‚¤ëŠ” "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜" í˜•íƒœ
            const char = makeChar({ 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜': 1 });
            assert.equal(calcTotalDistinctParts(char, 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 1);
        });

        test('ë ˆê±°ì‹œ ì„¸íŠ¸ â€” ì˜ëª»ëœ í‚¤("ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: ...")ëŠ” ì¹´ìš´íŠ¸ ì•ˆ ë¨ (ë²„ê·¸ ë°©ì§€)', () => {
            // ë¦¬íŒ©í„°ë§ ì „ì˜ ë²„ê·¸ í‚¤: "ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜"
            // ì´ í‚¤ëŠ” í•¨ìˆ˜ê°€ ì¸ì‹í•˜ì§€ ëª»í•´ì•¼ í•¨ â†’ ê²°ê³¼ 0
            const wrongKey = 'ë ˆê±°ì‹œ: ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜';
            const char = makeChar({ [wrongKey]: 5 }); // 5ê°œë‚˜ ìˆì–´ë„
            assert.equal(calcTotalDistinctParts(char, 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 0);
        });

        test('ë ˆê±°ì‹œ ì„¸íŠ¸ â€” ìµì‹œë“œ í‚¤("[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜") ì¹´ìš´íŠ¸ë¨', () => {
            // ìƒì˜ëŠ” ARMOR ì˜ ìµì‹œë“œ ìŠ¬ë¡¯ì´ë¯€ë¡œ ì¸ì‹ë¨
            const char = makeChar({ '[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜': 1 });
            assert.equal(calcTotalDistinctParts(char, 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 1);
        });

        test('ë ˆê±°ì‹œ ì„¸íŠ¸ â€” ìµì‹œë“œ í‚¤ê°€ í•˜ì˜ì— ìˆìœ¼ë©´ ì¹´ìš´íŠ¸ ì•ˆ ë¨', () => {
            // í•˜ì˜ëŠ” ìµì‹œë“œ ìŠ¬ë¡¯ì´ ì•„ë‹˜ (ARMOR ìµì‹œë“œëŠ” ìƒì˜ë§Œ)
            // "[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ í•˜ì˜" ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í‚¤ì´ë¯€ë¡œ 0
            const char = makeChar({ '[ì„ ë´‰] ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ í•˜ì˜': 1 });
            assert.equal(calcTotalDistinctParts(char, 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 0);
        });

        test('ë ˆê±°ì‹œ ì„¸íŠ¸ â€” 5ìŠ¬ë¡¯ ì „ë¶€ ì ‘ë‘ì–´ë¡œ ë³´ìœ  â†’ 5', () => {
            const char = makeChar({
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ìƒì˜': 1,
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ í•˜ì˜': 1,
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ì–´ê¹¨': 1,
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ë²¨íŠ¸': 1,
                'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´ ì‹ ë°œ': 1,
            });
            assert.equal(calcTotalDistinctParts(char, 'ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ ì†Œìš©ëŒì´'), 5);
        });

        // â”€â”€ ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        test('ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸ â€” íŒ”ì°Œ ë³´ìœ  â†’ 1', () => {
            const char = makeChar({ 'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ íŒ”ì°Œ': 1 });
            assert.equal(calcTotalDistinctParts(char, 'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ'), 1);
        });

        test('ì•…ì„¸ì„œë¦¬ ì„¸íŠ¸ â€” 3ìŠ¬ë¡¯ ì „ë¶€ â†’ 3', () => {
            const char = makeChar({
                'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ íŒ”ì°Œ': 1,
                'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ ëª©ê±¸ì´': 1,
                'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ ë°˜ì§€': 1,
            });
            assert.equal(calcTotalDistinctParts(char, 'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ'), 3);
        });
    });


    // ============================================================
    // 6. incrementCount / decrementCount í…ŒìŠ¤íŠ¸
    //    ì¹´ìš´íŠ¸ ì¦ê°ì˜ ê²½ê³„ê°’(ìŒìˆ˜ ë°©ì§€, ì—†ëŠ” í‚¤ ì²˜ë¦¬ ë“±) ê²€ì¦.
    // ============================================================
    describe('incrementCount / decrementCount', () => {

        // describe ì•ˆì—ì„œ ê³µí†µìœ¼ë¡œ ì“¸ ìƒìˆ˜ ì„ ì–¸
        const KEY = 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ ìƒì˜';

        test('ì—†ëŠ” í‚¤ë¥¼ increment â†’ 1', () => {
            const char = makeChar({}); // ì•„ë¬´ê²ƒë„ ì—†ëŠ” ìºë¦­í„°
            incrementCount(char, KEY);
            // (undefined || 0) + 1 = 1 ì´ ë˜ì–´ì•¼ í•¨
            assert.equal(char.armorCounts[KEY], 1);
        });

        test('ì—°ì† increment â†’ ëˆ„ì ', () => {
            const char = makeChar({});
            incrementCount(char, KEY); // 1
            incrementCount(char, KEY); // 2
            incrementCount(char, KEY); // 3
            assert.equal(char.armorCounts[KEY], 3);
        });

        test('decrement â†’ 1 ê°ì†Œ', () => {
            const char = makeChar({ [KEY]: 3 }); // 3ê°œì—ì„œ ì‹œì‘
            decrementCount(char, KEY);
            assert.equal(char.armorCounts[KEY], 2); // 2ê°€ ë¨
        });

        test('decrement â€” 0 ë¯¸ë§Œìœ¼ë¡œ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ', () => {
            // ì´ë¯¸ 0ì¸ ìƒíƒœì—ì„œ ê°ì†Œí•´ë„ 0 ìœ ì§€
            const char = makeChar({ [KEY]: 0 });
            decrementCount(char, KEY);
            assert.equal(char.armorCounts[KEY], 0); // -1 ì´ ë˜ë©´ ì•ˆ ë¨
        });

        test('decrement â€” ì—†ëŠ” í‚¤ë„ 0 ìœ ì§€', () => {
            // í‚¤ ìì²´ê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ê°ì†Œ â†’ Math.max(0, -1) = 0
            const char = makeChar({});
            decrementCount(char, KEY);
            assert.equal(char.armorCounts[KEY], 0);
        });

        test('increment í›„ decrement â†’ ì›ë³µ', () => {
            const char = makeChar({ [KEY]: 2 });
            incrementCount(char, KEY); // 2 â†’ 3
            decrementCount(char, KEY); // 3 â†’ 2
            assert.equal(char.armorCounts[KEY], 2); // ì›ë˜ëŒ€ë¡œ
        });
    });


    // ============================================================
    // 7. sortByName / sortByJob í…ŒìŠ¤íŠ¸
    //    ì •ë ¬ ê²°ê³¼ì™€ ì›ë³¸ ë¶ˆë³€ì„± ê²€ì¦.
    // ============================================================
    describe('sortByName', () => {

        // describe ì•ˆì—ì„œ ê³µí†µìœ¼ë¡œ ì“¸ ì…ë ¥ ë°°ì—´
        // ì¼ë¶€ëŸ¬ ê°€ë‚˜ë‹¤ ì—­ìˆœìœ¼ë¡œ ë°°ì¹˜
        const chars = [
            { name: 'ë‹¤ëŒì¥', job: 'ë§ˆë²•ì‚¬' },
            { name: 'ê°€ë‚˜ë‹¤', job: 'ê·€ê²€ì‚¬' },
            { name: 'ë‚˜ë¹„',   job: 'ê±°ë„ˆ'   },
        ];

        test('ì´ë¦„ ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬', () => {
            const sorted = sortByName(chars);
            // ì •ë ¬ ê²°ê³¼ í™•ì¸
            assert.equal(sorted[0].name, 'ê°€ë‚˜ë‹¤');
            assert.equal(sorted[1].name, 'ë‚˜ë¹„');
            assert.equal(sorted[2].name, 'ë‹¤ëŒì¥');
        });

        test('ì›ë³¸ ë°°ì—´ ë³€ê²½ ì—†ìŒ (ë¶ˆë³€)', () => {
            // sortByName ì€ [...characters] ë¡œ ë³µì‚¬ í›„ ì •ë ¬í•˜ë¯€ë¡œ ì›ë³¸ì´ ë°”ë€Œë©´ ì•ˆ ë¨
            sortByName(chars);
            assert.equal(chars[0].name, 'ë‹¤ëŒì¥'); // ì›ë³¸ ì²« ë²ˆì§¸ëŠ” ê·¸ëŒ€ë¡œ 'ë‹¤ëŒì¥'
        });

        test('ë¹ˆ ë°°ì—´ â†’ ë¹ˆ ë°°ì—´', () => {
            // assert.deepEqual: ë°°ì—´/ê°ì²´ ë‚´ìš©ì„ ê¹Šì´ ë¹„êµ
            assert.deepEqual(sortByName([]), []);
        });

        test('1ê°œì§œë¦¬ ë°°ì—´ â†’ ê·¸ëŒ€ë¡œ', () => {
            const result = sortByName([{ name: 'í˜¼ì', job: 'ë„ì ' }]);
            assert.equal(result[0].name, 'í˜¼ì');
        });
    });

    describe('sortByJob', () => {

        const chars = [
            { name: 'ë‚˜ì „ì‚¬',   job: 'ì›Œë¦¬ì–´' },
            { name: 'ê°€ê¶ìˆ˜',   job: 'ê±°ë„ˆ'   },
            { name: 'ë‹¤ë§ˆë²•',   job: 'ë§ˆë²•ì‚¬' },
            { name: 'ë¼ê±°ë„ˆ2',  job: 'ê±°ë„ˆ'   }, // ê°€ê¶ìˆ˜ì™€ ê°™ì€ ì§ì—…
        ];

        test('ì§ì—… ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬', () => {
            const sorted = sortByJob(chars);
            // ê±°ë„ˆ(ê°€) < ë§ˆë²•ì‚¬(ë§ˆ) < ì›Œë¦¬ì–´(ì›Œ) ìˆœì„œ
            assert.equal(sorted[0].job, 'ê±°ë„ˆ');
            assert.equal(sorted[2].job, 'ë§ˆë²•ì‚¬');
            assert.equal(sorted[3].job, 'ì›Œë¦¬ì–´');
        });

        test('ê°™ì€ ì§ì—… ë‚´ì—ì„œ ì´ë¦„ìˆœ ì •ë ¬', () => {
            const sorted = sortByJob(chars);
            // ê±°ë„ˆ 2ëª…: "ê°€ê¶ìˆ˜" ì™€ "ë¼ê±°ë„ˆ2" â†’ ì´ë¦„ ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ê°€ê¶ìˆ˜ê°€ ë¨¼ì €
            const gunners = sorted.filter(c => c.job === 'ê±°ë„ˆ');
            assert.equal(gunners[0].name, 'ê°€ê¶ìˆ˜');
            assert.equal(gunners[1].name, 'ë¼ê±°ë„ˆ2');
        });

        test('ì›ë³¸ ë¶ˆë³€', () => {
            sortByJob(chars);
            assert.equal(chars[0].name, 'ë‚˜ì „ì‚¬'); // ì›ë³¸ ì²« ë²ˆì§¸ ê·¸ëŒ€ë¡œ
        });
    });


    // ============================================================
    // 8. getSetType3or5 í…ŒìŠ¤íŠ¸
    //    ì™„ì„±ë„ ë¹„ìœ¨(60%, 100%)ì— ë”°ë¥¸ 3ì…‹/5ì…‹ íŒë³„ ê²½ê³„ê°’ ê²€ì¦.
    // ============================================================
    describe('getSetType3or5', () => {

        const SET = 'ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íƒì‚¬ë³µ'; // 5ìŠ¬ë¡¯ì§œë¦¬ ì„¸íŠ¸

        test('0/5 â†’ null (ë¯¸ì™„ì„±)', () => {
            assert.equal(getSetType3or5(0, SET), null);
        });

        test('2/5 (40%) â†’ null (3ì…‹ ë¯¸ë‹¬)', () => {
            // 60% ë¯¸ë§Œì´ë¯€ë¡œ null
            assert.equal(getSetType3or5(2, SET), null);
        });

        test('3/5 (60%) â†’ 3 (3ì…‹ ë‹¬ì„±)', () => {
            // ì •í™•íˆ 60% = ê²½ê³„ê°’ â†’ 3ì…‹
            assert.equal(getSetType3or5(3, SET), 3);
        });

        test('4/5 (80%) â†’ 3 (5ì…‹ ë¯¸ë‹¬, 3ì…‹ ìœ ì§€)', () => {
            assert.equal(getSetType3or5(4, SET), 3);
        });

        test('5/5 (100%) â†’ 5 (5ì…‹ ë‹¬ì„±)', () => {
            assert.equal(getSetType3or5(5, SET), 5);
        });

        test('ì•…ì„¸ì„œë¦¬ 3ìŠ¬ë¡¯ ì„¸íŠ¸ â€” 2/3(66%) â†’ 3', () => {
            // 3ìŠ¬ë¡¯ ì„¸íŠ¸ì—ì„œ 2ê°œ ë³´ìœ : 66% â†’ 3ì…‹
            const ASET = 'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ';
            assert.equal(getSetType3or5(2, ASET), 3);
        });

        test('ì•…ì„¸ì„œë¦¬ 3ìŠ¬ë¡¯ ì„¸íŠ¸ â€” 3/3(100%) â†’ 5', () => {
            const ASET = 'ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼ì˜ ê¸°ì–µ';
            assert.equal(getSetType3or5(3, ASET), 5);
        });

        test('ì•Œ ìˆ˜ ì—†ëŠ” ì„¸íŠ¸ëª… â†’ null', () => {
            // ALL_SETS ì— ì—†ëŠ” ì„¸íŠ¸ëª…ì€ ìŠ¬ë¡¯ì´ 0 â†’ null ë°˜í™˜
            assert.equal(getSetType3or5(3, 'ì¡´ì¬í•˜ì§€ì•ŠëŠ”ì„¸íŠ¸'), null);
        });
    });


    // ============================================================
    // 9. ìƒìˆ˜ ë¬´ê²°ì„± ê²€ì¦
    //    ë°ì´í„° ìƒìˆ˜ë“¤ì´ ì˜¬ë°”ë¥¸ êµ¬ì¡°ë¥¼ ê°–ì¶”ê³  ìˆëŠ”ì§€ ê²€ì¦.
    //    ë¦¬íŒ©í„°ë§ í›„ì—ë„ ë°ì´í„°ê°€ ê¹¨ì§€ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš©ë„.
    // ============================================================
    describe('ìƒìˆ˜ ë¬´ê²°ì„±', () => {

        test('LEGACY_PREFIX_SETS 4ê°œ ì •í™•íˆ ì¡´ì¬', () => {
            // ë ˆê±°ì‹œ ì„¸íŠ¸ëŠ” ë°©ì–´êµ¬ 2ê°œ + ì•…ì„¸ 2ê°œ = ì´ 4ê°œ
            assert.equal(LEGACY_PREFIX_SETS.length, 4);
        });

        test('LEGACY_PREFIX_SETS í•­ëª©ì´ ALL_SETSì— ì¡´ì¬', () => {
            // ë ˆê±°ì‹œ ì„¸íŠ¸ê°€ ì„¸íŠ¸ ëª©ë¡ì— ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            // assert.ok(ê°’) : ê°’ì´ truthy(ì¡´ì¬) ë©´ í†µê³¼
            for (const name of LEGACY_PREFIX_SETS) {
                assert.ok(ALL_SETS[name], `${name} ì´ ALL_SETSì— ì—†ìŒ`);
            }
        });

        test('LEGACY_PREFIX_SETS í•­ëª©ì´ ALL_PREFIXì— ìˆê³  ì ‘ë‘ì–´ê°€ ["ë ˆê±°ì‹œ"]', () => {
            for (const name of LEGACY_PREFIX_SETS) {
                assert.ok(ALL_PREFIX[name], `${name} ì´ ALL_PREFIXì— ì—†ìŒ`);
                // ë ˆê±°ì‹œ ì„¸íŠ¸ì˜ ì ‘ë‘ì–´ëŠ” ì •í™•íˆ ["ë ˆê±°ì‹œ"] í•˜ë‚˜ì—¬ì•¼ í•¨
                assert.deepEqual(ALL_PREFIX[name], ['ë ˆê±°ì‹œ'], `${name} ì˜ ì ‘ë‘ì–´ê°€ ë ˆê±°ì‹œê°€ ì•„ë‹˜`);
            }
        });

        test('ARMOR_EXCEED_ONLY ì™€ ACCESSORY_EXCEED_ONLY ê°€ ë¹ˆ ë°°ì—´', () => {
            // ë ˆê±°ì‹œ ë¦¬íŒ©í„°ë§ì˜ í•µì‹¬ ë³€ê²½: ì´ì „ì—ëŠ” ë ˆê±°ì‹œ ì„¸íŠ¸ê°€ ì—¬ê¸° ìˆì—ˆì§€ë§Œ
            // ì ‘ë‘ì–´ ë°©ì‹ìœ¼ë¡œ ë°”ë€Œë©´ì„œ ì´ ë°°ì—´ë“¤ì´ ë¹„ì›Œì¡Œì–´ì•¼ í•¨
            assert.deepEqual(ARMOR_EXCEED_ONLY, []);
            assert.deepEqual(ACCESSORY_EXCEED_ONLY, []);
        });

        test('EXCEED_TAGS ê°€ ["ì„ ë´‰","ì˜ì§€","ì´ìƒ"] 3ê°œ', () => {
            assert.deepEqual(EXCEED_TAGS, ['ì„ ë´‰', 'ì˜ì§€', 'ì´ìƒ']);
        });

        test('EXCEED_SLOTS ê° íƒ€ì… ìŠ¬ë¡¯ ì •í™•', () => {
            // ë°©ì–´êµ¬-ìƒì˜, ì•…ì„¸-íŒ”ì°Œ, íŠ¹ìˆ˜-ê·€ê±¸ì´ë§Œ ìµì‹œë“œ ìŠ¬ë¡¯
            assert.deepEqual(EXCEED_SLOTS.ARMOR,     ['ìƒì˜']);
            assert.deepEqual(EXCEED_SLOTS.ACCESSORY, ['íŒ”ì°Œ']);
            assert.deepEqual(EXCEED_SLOTS.SPECIAL,   ['ê·€ê±¸ì´']);
        });

        test('ëª¨ë“  ARMOR_SETS í•­ëª©ì€ 5ìŠ¬ë¡¯', () => {
            // ë°©ì–´êµ¬ëŠ” ìƒì˜/í•˜ì˜/ì–´ê¹¨/ë²¨íŠ¸/ì‹ ë°œ ì •í™•íˆ 5ê°œì—¬ì•¼ í•¨
            for (const [name, slots] of Object.entries(ARMOR_SETS)) {
                assert.equal(slots.length, 5, `${name}: ìŠ¬ë¡¯ ìˆ˜ê°€ 5ê°€ ì•„ë‹˜ (${slots.length})`);
            }
        });

        test('ëª¨ë“  ACCESSORY_SETS í•­ëª©ì€ 3ìŠ¬ë¡¯', () => {
            // ì•…ì„¸ì„œë¦¬ëŠ” íŒ”ì°Œ/ëª©ê±¸ì´/ë°˜ì§€ ì •í™•íˆ 3ê°œì—¬ì•¼ í•¨
            for (const [name, slots] of Object.entries(ACCESSORY_SETS)) {
                assert.equal(slots.length, 3, `${name}: ìŠ¬ë¡¯ ìˆ˜ê°€ 3ì´ ì•„ë‹˜ (${slots.length})`);
            }
        });
    });


    /* ============================================================
       â‘£ runAll() â€” í…ŒìŠ¤íŠ¸ ì‹¤í–‰ & UI ë Œë”ë§
       ------------------------------------------------------------
       ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë¨.

       ì‹¤í–‰ íë¦„:
         1. _suites ë°°ì—´ ìˆœíšŒ
         2. ê° suite ì˜ tests ë°°ì—´ ìˆœíšŒ
         3. test.fn() ì„ try/catch ë¡œ ì‹¤í–‰
            â†’ ì„±ê³µ: pass ì¹´ìš´íŠ¸ ì¦ê°€
            â†’ ì‹¤íŒ¨: fail ì¹´ìš´íŠ¸ ì¦ê°€, ì—ëŸ¬ ë©”ì‹œì§€ ì €ì¥
         4. suite ê²°ê³¼ë¥¼ DOM ì— ë Œë”ë§
            â†’ ì‹¤íŒ¨í•œ suite ëŠ” ìë™ìœ¼ë¡œ í¼ì³ì§
         5. ìš”ì•½ ë°”(ì¹´ìš´íŠ¸, ì§„í–‰ë¥ ) ì—…ë°ì´íŠ¸
       ============================================================ */
    function runAll() {
        const container = document.getElementById('results');
        container.innerHTML = ''; // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”

        let totalPass = 0, totalFail = 0;

        for (const suite of _suites) {
            let suitePass = 0, suiteFail = 0;
            const rows = []; // ì´ suite ì˜ ê° í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥ìš©

            // í…ŒìŠ¤íŠ¸ í•˜ë‚˜ì”© ì‹¤í–‰
            for (const t of suite.tests) {
                let err = null;
                try {
                    t.fn(); // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‹¤í–‰. assert ê°€ throw í•˜ë©´ catch ë¡œ ê°.
                } catch (e) {
                    err = e; // ì‹¤íŒ¨: ì—ëŸ¬ ê°ì²´ ì €ì¥
                }

                if (err) { suiteFail++; totalFail++; }
                else      { suitePass++; totalPass++; }
                rows.push({ name: t.name, err });
            }

            // â”€â”€ DOM êµ¬ì„±: suite ì¹´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            const suiteEl = document.createElement('div');
            suiteEl.className = 'suite';

            // í—¤ë”: [ìƒ‰ìƒ ë±ƒì§€] [suite ì´ë¦„] [í†µê³¼ ìˆ˜] [í¼ì¹˜ê¸° í™”ì‚´í‘œ]
            const header = document.createElement('div');
            header.className = 'suite-header';

            const badge = document.createElement('span');
            badge.className = 'suite-badge ' + (suiteFail ? 'fail' : 'pass');
            // ì‹¤íŒ¨ê°€ ìˆìœ¼ë©´ ë¹¨ê°„ ì , ì—†ìœ¼ë©´ ì´ˆë¡ ì 

            const sname = document.createElement('span');
            sname.className = 'suite-name';
            sname.textContent = suite.name;

            const sstat = document.createElement('span');
            sstat.className = 'suite-stat ' + (suiteFail ? 'has-fail' : 'all-pass');
            sstat.textContent = `${suitePass}/${suitePass + suiteFail} í†µê³¼`;

            const chev = document.createElement('span');
            chev.className = 'chevron';
            chev.textContent = 'â–¶';

            header.append(badge, sname, sstat, chev);

            // ë°”ë””: ê°œë³„ í…ŒìŠ¤íŠ¸ í–‰ë“¤
            const body = document.createElement('div');
            // ì‹¤íŒ¨í•œ suite ëŠ” ê¸°ë³¸ìœ¼ë¡œ í¼ì³ì„œ ì—ëŸ¬ë¥¼ ë°”ë¡œ ë³´ì—¬ì¤Œ
            body.className = 'suite-body' + (suiteFail ? ' open' : '');
            if (suiteFail) {
                header.classList.add('open');
                chev.style.transform = 'rotate(90deg)';
            }

            // í—¤ë” í´ë¦­ìœ¼ë¡œ í¼ì¹˜ê¸°/ì ‘ê¸° í† ê¸€
            header.addEventListener('click', () => {
                const isOpen = body.classList.toggle('open');
                header.classList.toggle('open', isOpen);
                chev.style.transform = isOpen ? 'rotate(90deg)' : '';
            });

            // ê° í…ŒìŠ¤íŠ¸ ê²°ê³¼ í–‰ ë Œë”ë§
            for (const r of rows) {
                const row = document.createElement('div');
                row.className = 'test-row ' + (r.err ? 'fail' : 'pass');

                const icon = document.createElement('span');
                icon.className = 'icon';
                icon.textContent = r.err ? 'âœ—' : 'âœ“'; // ì‹¤íŒ¨/ì„±ê³µ ì•„ì´ì½˜

                const nameEl = document.createElement('div');
                nameEl.style.flex = '1';

                const nameText = document.createElement('div');
                nameText.className = 'test-name';
                nameText.textContent = r.name;
                nameEl.appendChild(nameText);

                // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (assert ê°€ throw í•œ ë©”ì‹œì§€)
                if (r.err) {
                    const errEl = document.createElement('div');
                    errEl.className = 'err-msg';
                    errEl.textContent = r.err.message;
                    nameEl.appendChild(errEl);
                }

                row.append(icon, nameEl);
                body.appendChild(row);
            }

            suiteEl.append(header, body);
            container.appendChild(suiteEl);
        }

        // â”€â”€ ìš”ì•½ ë°” ì—…ë°ì´íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const total = totalPass + totalFail;
        document.getElementById('stat-total').textContent = `ì´ ${total}ê°œ`;
        document.getElementById('stat-pass').textContent  = `âœ“ ${totalPass}`;
        document.getElementById('stat-fail').textContent  = `âœ— ${totalFail}`;

        // ì§„í–‰ë¥  ë°”: í†µê³¼ ë¹„ìœ¨ë§Œí¼ ì±„ì›€
        const fill = document.getElementById('progress-fill');
        fill.style.width = total ? (totalPass / total * 100) + '%' : '0%';
        // ì‹¤íŒ¨ê°€ ìˆìœ¼ë©´ ì´ˆë¡â†’ë¹¨ê°• ê·¸ë¼ë””ì–¸íŠ¸, ì „ë¶€ í†µê³¼ë©´ ìˆœìˆ˜ ì´ˆë¡
        fill.className = 'progress-fill' + (totalFail ? ' has-fail' : '');
    }
</script>
</body>
</html>