<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG í†µí•© ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        :root {
            --bg: #0f0f12;
            --table-bg: #1a1a1f;
            --border: #444; 
            --border-heavy: #c5a678; 
            --gold: #c5a678;
            --text: #ddd;
            --input-bg: #000;
            --fs: 11px;
            --txt-epic: #fcc419;   --txt-unique: #ff80ab; --txt-rare: #b197fc;   --txt-uncom: #4dabf7; --txt-common: #888;
            --ex-sunbong: #ff5252; --ex-uiji: #448aff;
            --ex-isang: #40c057; 
            --emb-red: #4a1212; --emb-yellow: #4a3f12; --emb-blue: #121d4a; --emb-green: #124a1d; --emb-gray: #2d2d2d;
            --gakin-2: #fff5f5bb; 
			--ex-itemname-light: #85EFAD; /* â† ì—°í•œ ì´ˆë¡ (ì›í•˜ë©´ ê°’ë§Œ ì¡°ì ˆ) */
        }

        body { background-color: var(--bg); color: var(--text); font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 10px; }
        h2 { color: var(--gold); border-bottom: 2px solid var(--gold); padding-bottom: 5px; margin: 0 0 10px 0; font-size: 1.1rem; }

        .control-bar { margin-bottom: 10px; display: flex; gap: 10px; align-items: center; position: sticky; top: 0; background: var(--bg); z-index: 1000; padding: 5px 0; }
        .btn-action { background: #1d4ed8; color: white; border: none; padding: 5px 15px; cursor: pointer; border-radius: 3px; font-weight: bold; font-size: 11px;}
        .btn-add { background: #7c3aed; }
        .status-msg { font-size: 12px; color: var(--gold); }

        .char-section { margin-bottom: 30px; }
        .table-container { overflow-x: auto; }
        
        table { 
            border-collapse: collapse; 
            background-color: var(--table-bg); 
            width: max-content; 
            font-size: var(--fs); 
            border: 2px solid var(--gold); 
        }
        
        th, td { border: 1px solid var(--border) !important; padding: 1px 2px; text-align: center; height: 26px; color: #ccc; }
        th { background-color: #2a2a32; color: var(--gold); font-weight: bold; white-space: nowrap; }
        
        .v-border-heavy { border-left: 2px solid var(--border-heavy) !important; }
        .group-header { border-bottom: 2px solid var(--gold) !important; }
        
        .col-char-info { width: 120px !important; }
        .col-slot { width: 45px !important; font-weight: bold; color: var(--gold) !important; }
        .col-rarity { width: 42px !important; }
        .col-exceed { width: 45px !important; }
        .col-prefix { width: 38px !important; }
        .col-val-short { width: 35px !important; }
        .col-emblem { width: 40px !important; }
        .col-enchant { width: 55px !important; min-width: 55px; } 

        input { 
            background: var(--input-bg); 
            color: #fff; 
            border: 1px solid #444; 
            padding: 1px 2px; 
            width: 100%; 
            font-size: var(--fs); 
            box-sizing: border-box; 
            height: 22px; 
            outline: none; 
            text-align: center; 
        }

        select { 
            background: linear-gradient(to bottom, #2a2a32 0%, #000000 100%); 
            color: #fff; 
            border: 1px solid #555; 
            padding: 1px 0px; 
            width: 100%; 
            font-size: var(--fs); 
            box-sizing: border-box; 
            height: 22px; 
            outline: none; 
            text-align: center; 
            -webkit-appearance: none; 
            -moz-appearance: none; 
            appearance: none; 
            cursor: pointer;
            pointer-events: auto !important; 
            touch-action: auto !important;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
        }

        select option { background-color: #1a1a1f; color: #fff; }
        select:hover { border-color: var(--gold); }

        input:disabled, select:disabled { 
            cursor: not-allowed; 
            opacity: 1; 
            -webkit-text-fill-color: inherit; 
            pointer-events: none !important;
        }

        .rare-ì—í”½, .bg-ì—í”½ { color: var(--txt-epic) !important; font-weight: bold; }
        .rare-ìœ ë‹ˆí¬, .bg-ìœ ë‹ˆí¬ { color: var(--txt-unique) !important; font-weight: bold; }
        .rare-ë ˆì–´, .bg-ë ˆì–´ { color: var(--txt-rare) !important; font-weight: bold; }
        .rare-ì–¸ì»¤ë¨¼, .bg-ì–¸ì»¤ë¨¼ { color: var(--txt-uncom) !important; font-weight: bold; }
        .rare-ì»¤ë¨¼, .bg-ì»¤ë¨¼ { color: var(--txt-common) !important; font-weight: bold; }
        .rare-í‹°ì–´ { color: #ffffff !important; font-weight: bold; }
        
        .ex-ì´ìƒ { color: var(--ex-isang) !important; font-weight: bold; }
        .ex-ì„ ë´‰ { color: var(--ex-sunbong) !important; font-weight: bold; }
        .ex-ì˜ì§€ { color: var(--ex-uiji) !important; font-weight: bold; }
		.ex-itemname-light {
			color: var(--ex-itemname-light) !important;
			font-weight: bold;
		}
        .prefix-selected { color: var(--txt-epic) !important; font-weight: bold; }
        .prefix-tier { color: #ffffff !important; font-weight: bold; }
        
        .emb-bg-red { background: linear-gradient(to bottom, #6a1a1a 0%, var(--emb-red) 100%) !important; color: #fff !important; }
        .emb-bg-yellow { background: linear-gradient(to bottom, #6a5a1a 0%, var(--emb-yellow) 100%) !important; color: #fff !important; }
        .emb-bg-blue { background: linear-gradient(to bottom, #1a2a6a 0%, var(--emb-blue) 100%) !important; color: #fff !important; }
        .emb-bg-green { background: linear-gradient(to bottom, #1a6a2a 0%, var(--emb-green) 100%) !important; color: #fff !important; }
        .emb-bg-gray { background: linear-gradient(to bottom, #444 0%, var(--emb-gray) 100%) !important; color: #fff !important; }

        .artifact-main-wrapper { display: flex; gap: 8px; justify-content: start; align-items: center; padding: 2px 5px; }
        .art-group { display: flex; flex-direction: column; gap: 2px; border: 1px solid #444; padding: 3px; background: #000; }
        .art-item { display: flex; align-items: center; gap: 2px; }

        #skillRunemodal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1f; border: 2px solid var(--gold); padding: 15px; z-index: 2000; width: 310px; max-height: 85vh; overflow-y: auto;}
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1999; }
        .v-line { border-left: 1px solid #555; height: 12px; margin: 0 8px; display: inline-block; vertical-align: middle; }
        
        .btn-char-lock { background: #2563eb; color: white; padding: 4px; cursor: pointer; font-size: 11px; border:none; margin-bottom: 2px;}
        .btn-char-unlock { background: #444; color: white; padding: 4px; cursor: pointer; font-size: 11px; border:none; }
        .btn-active { border: 2px solid white !important; }

        .m-rune-name { width: 68px !important; } 
        .m-rune-lv { width: 48px !important; }    
        .m-rune-skillLv { width: 50px !important; } 
        .col-m-num { width: 30px; }

        .gakin-section { margin-top: 10px; border-top: 2px solid var(--gold); padding-top: 10px; }
        .gakin-title { color: var(--gold); font-weight: bold; font-size: 12px; margin-bottom: 5px; text-align: center; }
        .gakin-container { display: flex; gap: 5px; width: 100%; }
        .m-gakin-input-box { flex: 1; }
		
		.itemname-color-sync {
			font-weight: bold;
		}

        /* ì—í”½ ë“±ê¸‰ê³¼ ë™ì¼í•œ ê°•ì¡° ìƒ‰ìƒ */
        .highlight-yellow {
            color: #fcc419 !important; /* ì—í”½ ë“±ê¸‰ íŠ¹ìœ ì˜ ë°ì€ ë…¸ë€ìƒ‰ */
            font-weight: bold;
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.8); /* ê°€ë…ì„±ì„ ìœ„í•œ ê·¸ë¦¼ì */
        }
		
		/* ì ‘ë‘ì–´ ì „ìš© ìƒ‰ìƒ */
		.p-blue { color: #3b82f6 !important; }   /* ê´‘ì±„: íŒŒë‘ */
		.p-red { color: #ef4444 !important; }    /* ë¶„ì‡„: ë¹¨ê°• */
		.p-green { color: #22c55e !important; }  /* ì„ ëª…: ì´ˆë¡ */
		.p-yellow { color: #facc15 !important; } /* ê°•íƒ€: ë…¸ë‘ */
		
		/* select ë°•ìŠ¤ ë‚´ì˜ ê¸€ììƒ‰ ìœ ì§€ë¥¼ ìœ„í•´ */
		select.prefix-selected.p-blue { color: #3b82f6; }
		select.prefix-selected.p-red { color: #ef4444; }
		select.prefix-selected.p-green { color: #22c55e; }
		select.prefix-selected.p-yellow { color: #facc15; }

    </style>
</head>
<body>

<h2>ğŸ›¡ï¸ RPG í†µí•© ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>

<div class="control-bar">
    <button class="btn-action" onclick="exportToJSON()">ğŸ“¤ JSON íŒŒì¼ ì €ì¥</button>
    <button class="btn-action" onclick="document.getElementById('fileInput').click()">ğŸ“¥ JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button class="btn-action btn-add" onclick="createCharacterTable()">â• ìºë¦­í„° ì¶”ê°€</button>
	<button onclick="lockAllCharacters()" class="btn-all-lock" style="background-color: #4b5563; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 4px; font-weight: bold; margin-left: 8px;">ì „ì²´ ì ê¸ˆ</button>
	<button class="btn-action" style="background:#0ea5e9;" onclick="openHistoryModal()">ğŸ“œ ê¸°ë¡</button>
    <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importFromJSON(this)">
    <span id="statusMsg" class="status-msg"></span>
</div>

<div id="characterContainer"></div>

<div class="modal-overlay" id="modalOverlay" onclick="closeRuneModal()"></div>
<div id="skillRunemodal">
    <h3 style="color:var(--gold); margin-top:0;">ğŸ’ ìŠ¤í‚¬ë£¬ & ê°ì¸ ì„¤ì •</h3>
	
	<div style="display:flex; gap:5px; margin-bottom:5px;">
        <select id="m-batch-rune-name" style="flex:1; background:#222; color:#fff; border:1px solid var(--gold); height:30px;"></select>
        <button class="btn-action" style="background:#7c3aed; flex:1.2;" onclick="setAllRunesBatch()">ë£¬ ì„¤ì •</button>
    </div>

    <div style="display:flex; gap:5px; margin-bottom:5px;">
        <select id="m-batch-rune-lv" style="flex:1; background:#222; color:#fff; border:1px solid var(--gold); height:30px;"></select>
        <button class="btn-action" style="background:#059669; flex:1.2;" onclick="setAllRuneLevels()">ë ˆë²¨ ì„¤ì •</button>
    </div>

    <div style="display:flex; gap:5px; margin-bottom:10px;">
        <select id="m-batch-skill-lv" style="flex:1; background:#222; color:#fff; border:1px solid var(--gold); height:30px;"></select>
        <button class="btn-action" style="background:#2563eb; flex:1.2;" onclick="setAllSkillLevels()">ë ˆë²¨ë¡œ ì„¤ì •</button>
    </div>
	
    <table style="width:100%; border-collapse: collapse; font-size:12px; border:1px solid #444;">
        <thead>
            <tr style="color:var(--gold);">
                <th class="col-m-num">ë²ˆí˜¸</th><th style="width:68px;">ìŠ¤í‚¬ë£¬ ì´ë¦„</th><th style="width:48px;">ë£¬ ë ˆë²¨</th><th style="width:50px;">ìŠ¤í‚¬ ë ˆë²¨</th>
            </tr>
        </thead>
        <tbody id="runeModalBody"></tbody>
    </table>
    <div class="gakin-section">
        <div class="gakin-title">ê°ì¸ ì„¤ì •</div>
        <div class="gakin-container">
            <div class="m-gakin-input-box"><input type="text" id="m-gakin1" placeholder="ë©”ì¸ ë¯¸í‘œì‹œ (50%)"></div>
            <div class="m-gakin-input-box"><input type="text" id="m-gakin2" placeholder="ë©”ì¸ í‘œì‹œ (50%)"></div>
        </div>
    </div>
    <div style="margin-top:15px; display:flex; gap:10px; justify-content:center; padding-bottom: 5px;">
        <button class="btn-action" style="background:#059669;" onclick="saveRuneData()">ì €ì¥</button>
        <button class="btn-action" style="background:#4b5563;" onclick="closeRuneModal()">ì·¨ì†Œ</button>
    </div>
</div>

<div id="historyModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1f; border: 2px solid var(--gold); padding: 15px; z-index: 2000; width: 450px; max-height: 80vh; overflow-y: auto;">
    <h3 style="color:var(--gold); margin-top:0;">ğŸ“ ìµœê·¼ ë³€ê²½ ê¸°ë¡ (ìµœê·¼ 10ê°œ)</h3>
    <div id="historyList" style="font-size: 11px; color: #ccc; line-height: 1.6;"></div>
    <div style="margin-top:15px; text-align:center;">
        <button class="btn-action" style="background:#4b5563;" onclick="closeHistoryModal()">ë‹«ê¸°</button>
    </div>
</div>

<script>
const STORAGE_KEY = 'dnfm_character_equipment_data';
    const slots = ["ë¬´ê¸°", "ìƒì˜", "ì–´ê¹¨", "í•˜ì˜", "ì‹ ë°œ", "ë²¨íŠ¸", "ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€", "ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„", "ì¹­í˜¸", "ì™¸í˜•ì¹­í˜¸", "ì˜¤ë¼", "ì•„ë°”íƒ€", "ìŠ¤í‚¬ë£¬", "í¬ë¦¬ì³"];
    const heavyBorderSlots = ["ë¬´ê¸°", "ë²¨íŠ¸", "ë°˜ì§€", "ë§ˆë²•ì„", "ì•„ë°”íƒ€", "ìŠ¤í‚¬ë£¬", "í¬ë¦¬ì³"];
    const prefixes = ["", "ì „ê²©", "í—ˆìƒ", "ì‘ì—´", "ì¹¨ì‹", "ìˆ˜í˜¸", "ì™œê³¡", "ììƒ", "ë§¹ë…", "ë³´í˜¸", "ì‡„ë„", "ì‹ ì†", "ì—°ê²©"];
    const tierPrefixes = ["", "T1", "T2", "T3", "T4", "T5", "T6", "T7"];
    const runeNames = ["", "ê°ì„±", "ê°€í˜¸", "ì™œê³¡", "ì§€í˜œ", "ìˆ˜í˜¸", "ë³´í˜¸", "ê°€ì†", "ê²í™”", "í˜¹í•œ", "ì„¬ê´‘", "ì•”ê²©", "ìˆ™ë ¨", "íšŒë³µ", "ëª…ìƒ", "íŒŒë©¸", "í—ˆìƒ", "ë§ˆë ¥", "ë¶ˆêµ´", "ì¬ë¬¼", "ê¸°êµ", "ê·€ë°±", "í˜¼ë°±", "ê²¬ê³ ", "ìƒì¡´", "ì‘ì—´", "ë§¹ë…", "ììƒ", "ì „ê²©", "ëª¨ë…", "ê¸°ë§Œ", "ê²½í™”", "ì†ë°•", "ë‚˜íƒœ", "ì¹ í‘", "ëª½í™˜", "ì¶©ê²©", "ê²°ë¹™", "ë¯¸ì§€"];
    const runeLevels = ["", "I", "II", "III", "IV"];
    const runeSkillLevels = ["", "0", "15", "20", "25", "30", "35", "40", "45", "50", "55", "60", "65"];
    const noSkillLvRunes = ["ê°€í˜¸", "ì™œê³¡", "ìˆ˜í˜¸", "ë³´í˜¸", "ê·€ë°±", "í˜¼ë°±"];
    const elementEmbList = ["", "ëª¨ì†ê°•", "í™”ì†ê°•", "ìˆ˜ì†ê°•", "ëª…ì†ê°•", "ì•”ì†ê°•", "í˜", "ì§€ëŠ¥"];

    const artOptions = {
        red: ["í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥", "ì ì¤‘", "íšŒí”¼"],
        blue: ["HP MAX", "MP MAX", "ë¬¼ë¦¬ ê³µê²©ë ¥", "ë§ˆë²• ê³µê²©ë ¥", "ë¬¼ë¦¬ ë°©ì–´ë ¥", "ë§ˆë²• ë°©ì–´ë ¥"],
        green: ["ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬", "ë§ˆë²• í¬ë¦¬í‹°ì»¬", "ê³µê²©ì†ë„", "ìºìŠ¤íŒ…ì†ë„", "ì´ë™ì†ë„", "í™”ì†ê°•", "ìˆ˜ì†ê°•", "ëª…ì†ê°•", "ì•”ì†ê°•", "ëª¨ì†ê°•"]
    };

    const mData = {
        weapon: { n1: ["", "ë°ë¯¸ì§€ ì¦ê°€", "ì¶”ê°€ ë°ë¯¸ì§€", "ëª¨ë“  ì§ì—… 50ë ˆë²¨ìŠ¤í‚¬", "í™”ì†ê°•", "ìˆ˜ì†ê°•", "ëª…ì†ê°•", "ì•”ì†ê°•", "í˜", "ì§€ëŠ¥", "ë¬¼ë¦¬ ê³µê²©ë ¥", "ë§ˆë²• ê³µê²©ë ¥"], n2: ["", "ë¬¼ë¦¬ ê³µê²©ë ¥", "ë§ˆë²• ê³µê²©ë ¥", "í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥", "ê³µê²©ì†ë„", "ìºìŠ¤íŒ…ì†ë„", "ì´ë™ì†ë„", "ìµœëŒ€ HP ì¦ê°€", "ìµœëŒ€ MP ì¦ê°€", "ë¬¼ë¦¬ ë°©ì–´ë ¥", "ë§ˆë²• ë°©ì–´ë ¥", "ì ì¤‘", "íšŒí”¼"] },
        armor: { n1: ["", "í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥", "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬", "ë§ˆë²• í¬ë¦¬í‹°ì»¬"], n2: ["", "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬", "ë§ˆë²• í¬ë¦¬í‹°ì»¬", "í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥", "ê³µê²©ì†ë„", "ìºìŠ¤íŒ…ì†ë„", "ì´ë™ì†ë„", "ìµœëŒ€ HP ì¦ê°€", "ìµœëŒ€ MP ì¦ê°€", "ë¬¼ë¦¬ ë°©ì–´ë ¥", "ë§ˆë²• ë°©ì–´ë ¥", "ì ì¤‘", "íšŒí”¼"] },
        accessory: { n1: ["", "í™”ì†ê°•", "ìˆ˜ì†ê°•", "ëª…ì†ê°•", "ì•”ì†ê°•", "í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥"], n2: ["", "í™”ì†ê°•", "ìˆ˜ì†ê°•", "ëª…ì†ê°•", "ì•”ì†ê°•", "í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥", "ê³µê²©ì†ë„", "ìºìŠ¤íŒ…ì†ë„", "ì´ë™ì†ë„", "ìµœëŒ€ HP ì¦ê°€", "ìµœëŒ€ MP ì¦ê°€", "ë¬¼ë¦¬ ë°©ì–´ë ¥", "ë§ˆë²• ë°©ì–´ë ¥", "í™”ì†ì„± ì €í•­", "ìˆ˜ì†ì„± ì €í•­", "ëª…ì†ì„± ì €í•­", "ì•”ì†ì„± ì €í•­", "ì ì¤‘", "íšŒí”¼"] },
        special: { n1: ["", "ë¬¼ë¦¬ ê³µê²©ë ¥", "ë§ˆë²• ê³µê²©ë ¥", "í˜", "ì§€ëŠ¥", "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬", "ë§ˆë²• í¬ë¦¬í‹°ì»¬", "ì ì¤‘", "íšŒí”¼"], n2: ["", "ë¬¼ë¦¬ ê³µê²©ë ¥", "ë§ˆë²• ê³µê²©ë ¥", "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬", "ë§ˆë²• í¬ë¦¬í‹°ì»¬", "í˜", "ì§€ëŠ¥", "ì²´ë ¥", "ì •ì‹ ë ¥", "ê³µê²©ì†ë„", "ìºìŠ¤íŒ…ì†ë„", "ì´ë™ì†ë„", "ìµœëŒ€ HP ì¦ê°€", "ìµœëŒ€ MP ì¦ê°€", "ë¬¼ë¦¬ ë°©ì–´ë ¥", "ë§ˆë²• ë°©ì–´ë ¥", "ì ì¤‘", "íšŒí”¼"] }
    };
	
	const itemOptions = {
    "ìƒì˜": ["ëª»ë§ë¦¬ëŠ” ë§ê´„ëŸ‰ì´ì˜ ê°€ì£½", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ê°€ì£½ ìì¼“", "", "ì— í”„ë¦¬ìŠ¤ ìŠ¤íŒŒì´ë” ìƒì˜", "í€¸ ìŠ¤íŒŒì´ë” ìƒì˜", "", "ê±°ì‹ ì˜ ìŠ¤í™ì¿¨ë£¸ ìƒì˜", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ìƒì˜", "", "ë°¤ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ìƒì˜", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ìƒì˜", "", "ìˆ˜í˜¸êµ°ì£¼ì˜ ì´ˆí•©ê¸ˆ ìƒì˜", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ìƒì˜", "", "ë„¤íŠ¸ ìŠ¤íŒŒì´ë” ìƒì˜", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ ìƒì˜", "", "ê°•ì²  ìš©ì˜ ìŠ¤ì¼€ì¼ ì¬í‚·", "ê°•ì²  ìš©ì˜ ê°€ì£½ ì¬í‚·", "", "ë¸”ë ˆì´ì§• ê¸°ì–´ í”Œë ˆì´íŠ¸ ë©”ì¼", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ë©”ì¼", "", "ë¹›ì˜ ìˆ˜í˜¸ìì˜ ìƒì˜", "ë¹›ì˜ í—Œì‹ ìì˜ ìƒì˜", "", "ì—¬ëª…ì„ ë°íŒ ìì˜ ìƒì˜", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ìƒì˜", "", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ì•„ë¨¸Mk2", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ì•„ë¨¸", "", "ê·¸ëŸ°ë° ë§ˆëˆ„ìŠ¤ ì „íˆ¬ê¸°ê°‘ ìƒì˜", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ ìƒì˜", "", "ë ˆê±°ì‹œ: íœ˜ëª°ì•„ì¹˜ëŠ” ë§ˆë ¥ì˜ íƒœí’", "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ í­í’ìš°", "", "ë ˆê±°ì‹œ: ë£¨ë¯¸ë„ˆìŠ¤ ì˜¤í†  ìƒì˜", "ë ˆê±°ì‹œ: ë¼ì´íŠ¸ë‹ˆìŠ¤ ì˜¤í†  ìƒì˜"],
    "í•˜ì˜": ["ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ë²„ë¸” ë°˜ë°”ì§€", "í€¸ ìŠ¤íŒŒì´ë” í•˜ì˜", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ í•˜ì˜", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ í•˜ì˜", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ í•˜ì˜", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ í•˜ì˜", "ê°•ì²  ìš©ì˜ ê°€ì£½ ê·¸ë¦¬ë¸Œ", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ë ˆê¹…ìŠ¤", "ë¹›ì˜ í—Œì‹ ìì˜ í•˜ì˜", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ë°”ì§€", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ê°ë°˜", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ í•˜ì˜", "ë ˆê±°ì‹œ: ì˜ë ¥ì˜ íšŒì˜¤ë¦¬", "ë ˆê±°ì‹œ: íŒŒì´ì–´ë‹ˆìŠ¤ ì˜¤í†  í•˜ì˜"],
    "ì–´ê¹¨": ["ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íŠ¹ìˆ˜ ê³ ê¸€", "í€¸ ìŠ¤íŒŒì´ë” ë¨¸ë¦¬", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì–´ê¹¨ ì¥ì‹", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ì–´ê¹¨ ë§ëŒ", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ì–´ê¹¨", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ ì–´ê¹¨", "ê°•ì²  ìš©ì˜ ë¿” ì¥ì‹", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ í–‡", "ë¹›ì˜ í—Œì‹ ìì˜ ëª¨ì", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ì–´ê¹¨ ë§ëŒ", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ìƒˆë¡œìš´ ì†", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ í—¤ë“œê¸°ì–´", "ë ˆê±°ì‹œ: ë§ˆë²•ì˜ ëŒ€ê²©ë³€", "ë ˆê±°ì‹œ: ë¸”ë™ë‹ˆìŠ¤ ì˜¤í†  ì–´ê¹¨"],
    "ë²¨íŠ¸": ["ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ë²¨íŠ¸", "í€¸ ìŠ¤íŒŒì´ë” ë²¨íŠ¸ ì¥ì‹", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ í—ˆë¦¬ë ", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ í—ˆë¦¬ë ", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ë²¨íŠ¸", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ í—ˆë¦¬", "ê°•ì²  ìš©ì˜ íœ´ëŒ€ìš© ë²¨íŠ¸", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ì½”ì¼", "ë¹›ì˜ í—Œì‹ ìì˜ í—ˆë¦¬ì¥ì‹", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ í—ˆë¦¬ë ", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ì½”ì¼", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ í—ˆë¦¬", "ë ˆê±°ì‹œ: ë§ˆë‚˜ì˜ ì†Œìš©ëŒì´", "ë ˆê±°ì‹œ: ì•„ì´ë‹ˆìŠ¤ ì˜¤í†  ë²¨íŠ¸"],
    "ì‹ ë°œ": ["ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ì‹ ë°œ", "í€¸ ìŠ¤íŒŒì´ë” ì‹ ë°œ", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì‹ ë°œ", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ì‹ ë°œ", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ì‹ ë°œ", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ ì‹ ë°œ", "ê°•ì²  ìš©ì˜ ê°€ì£½ ì‹ ë°œ", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ì‚¬ë°”í†¤", "ë¹›ì˜ í—Œì‹ ìì˜ ì‹ ë°œ", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ì‹ ë°œ", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ê·¸ë¦¬ë¸Œ", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ ì‹ ë°œ", "ë ˆê±°ì‹œ: ì •ìˆ˜ì˜ íƒœí’", "ë ˆê±°ì‹œ: ìœˆë“œë‹ˆìŠ¤ ì˜¤í†  ì‹ ë°œ"],
    "íŒ”ì°Œ": ["ì„ ëª…í•œ ê¸°ì–µì˜ íŒ”ì°Œ", "ë¬»íŒ ì‹œê°„ì˜ íŒ”ì°Œ", "", "ì´ì‹¬ì „ì‹¬", "ë¬´ì–¸ì˜ ì—°ê²°", "", "ê¸°ê³„ì˜ ì‹¬ë°•", "ê¸°ê³„ì˜ ë§¥ë°•", "", "ë©€í‹°í”Œ íˆ´ì¦ˆ", "íŠ¸ë¦¬í”Œ íˆ´ì¦ˆ", "", "ì‹œë¦° ë‹¬ë¹›", "í‘¸ë¥¸ ë‹¬ë¹›", "", "ê¸°ê³„ì˜ ì£¼ì‹œ", "ê¸°ê³„ì˜ ì‹œì„ ", "", "ë ˆê±°ì‹œ: ì•„ì´ì–¸ ì— ë²¨ë¦¬ì‹œë“œ ë°´ë“œ", "ë ˆê±°ì‹œ: ê°•ì²  ë¦¬ìŠ¤íŠ¸ ê°€ë“œ", "", "ë ˆê±°ì‹œ: ì„¸ì´íŠ¸ ë£¨ë©˜ì•„ì´íŠ¸ ë ë¦­", "ë ˆê±°ì‹œ: í™€ë¦¬ ë¯¸ìŠ¤ë¦´ ë ë¦­"],
    "ëª©ê±¸ì´": ["íë¦¿í•œ ê³¼ê±°ì˜ ëª©ê±¸ì´", "ìˆ¨ê²¨ì§„ ë§¥ë½", "ì‚¬ë¼ì§„ ë™ë ¥", "í”¼ì–´ì‹± ë“œë¦´ ë„¤í´ë ˆìŠ¤", "ì€ìƒ‰ì˜ ë³„ë¹›", "ì—ë„ˆì§€ì˜ ëˆˆ", "ë ˆê±°ì‹œ: ì˜í˜¼ ì¶”ì ì¥ì¹˜", "ë ˆê±°ì‹œ: í  ë¡œìŠ¤ ê¸€ë¡œë¦¬"],
    "ë°˜ì§€": ["ë®ì–´ë‘” ê¸°ì–µì˜ ë°˜ì§€", "ê°ì¶°ì§„ ê²°", "ì •ì§€ëœ íë¦„", "ì˜¤í† ë§¤í‹± ì‹¤ë¦°ë”", "ë¶‰ì€ í–‡ë¹›", "ì‘ì‹œì˜ í”ì ", "ë ˆê±°ì‹œ: í• ê¸°ì˜ ë³¸ë§", "ë ˆê±°ì‹œ: ì—ì´ì…˜íŠ¸ ì—˜ë¸ ë§"],
    "ë³´ì¡°ì¥ë¹„": ["ë² í‚¤ì˜ ì¥ê°‘", "ê±°ì¸ì˜ ê±´ë“¤ë¦¿", "ë©”íƒˆê¸°ì–´ì˜ ì¡°ì‘ë¶€", "ê°•ì²  ìš©ì˜ ì¹¼ë‚  ì™¸ê³¨ê²©", "ê³¨ë“œ í¬ë¼ìš´ì˜ ì—ë„ˆì§€ ë°©ì¶œê¸°", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ ì—ë„ˆì§€ ì½”ì–´"],
    "ê·€ê±¸ì´": ["ë§ê´„ëŸ‰ì´ì˜ ë¬¸ì–‘ ê·€ê±¸ì´", "ë² í‚¤ì˜ ë¬¸ì–‘ ê·€ê±¸ì´", "", "ê±°ì‹ ì˜ ìŠ¤í™ì¿¨ë£¸ ì´ì–´ë§", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì´ì–´ë§", "", "ë©”íƒˆê¸°ì–´ì˜ ì´ˆí•©ê¸ˆ íƒœì—½", "ë©”íƒˆê¸°ì–´ì˜ íƒœì—½ ê·€ê±¸ì´", "", "ê°•ì²  ìš©ì˜ ê¸°ê´€ì´ ì´ì–´ë§", "ê°•ì²  ìš©ì˜ ê¸°ì´ ì´ì–´ë§", "", "ê³¨ë“œ í¬ë¼ìš´ì˜ ì„œì»¤ìŠ¤ ì¥ì‹", "ê³¨ë“œ í¬ë¼ìš´ì˜ ë¨¸ë¦¬ ì¥ì‹", "", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ ê¸°ì–µ", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ íƒœì—½ ì¥ì‹"],
    "ë§ˆë²•ì„": ["ë² í‚¤ì˜ ìƒˆì´", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì½”ì–´", "ë©”íƒˆê¸°ì–´ì˜ ë‘ë‡Œ", "ê°•ì²  ìš©ì˜ ì²œê³µê¸°", "ê³¨ë“œ í¬ë¼ìš´ì˜ í•µì‹¬ ë¶€í’ˆ", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ ë‘ë‡Œ"]
};
	
	
	const armorSets = {
    "ì–´ëŠ ë§ê´„ëŸ‰ì´": ["ëª»ë§ë¦¬ëŠ” ë§ê´„ëŸ‰ì´ì˜ ê°€ì£½", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ê°€ì£½ ìì¼“", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ë²„ë¸” ë°˜ë°”ì§€", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ íŠ¹ìˆ˜ ê³ ê¸€", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ë²¨íŠ¸", "ì–´ëŠ ë§ê´„ëŸ‰ì´ì˜ ì‹ ë°œ"],
    "í€¸ ìŠ¤íŒŒì´ë”": ["ì— í”„ë¦¬ìŠ¤ ìŠ¤íŒŒì´ë” ìƒì˜", "í€¸ ìŠ¤íŒŒì´ë” ìƒì˜", "í€¸ ìŠ¤íŒŒì´ë” í•˜ì˜", "í€¸ ìŠ¤íŒŒì´ë” ë¨¸ë¦¬", "í€¸ ìŠ¤íŒŒì´ë” ë²¨íŠ¸ ì¥ì‹", "í€¸ ìŠ¤íŒŒì´ë” ì‹ ë°œ"],
    "ìŠ¤í™ì¿¨ë£¸": ["ê±°ì‹ ì˜ ìŠ¤í™ì¿¨ë£¸ ìƒì˜", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ìƒì˜", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ í•˜ì˜", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì–´ê¹¨ ì¥ì‹", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ í—ˆë¦¬ë ", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì‹ ë°œ"],
    "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ì": ["ë°¤ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ìƒì˜", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ìƒì˜", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ í•˜ì˜", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ì–´ê¹¨ ë§ëŒ", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ í—ˆë¦¬ë ", "ì–´ë‘ ì„ ì˜ì•„ ë‚´ë¦¬ëŠ” ìì˜ ì‹ ë°œ"],
    "ìˆ˜í˜¸ì": ["ìˆ˜í˜¸êµ°ì£¼ì˜ ì´ˆí•©ê¸ˆ ìƒì˜", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ìƒì˜", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ í•˜ì˜", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ì–´ê¹¨", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ë²¨íŠ¸", "ìˆ˜í˜¸ìì˜ ì´ˆí•©ê¸ˆ ì‹ ë°œ"],
    "ì›¹ ìŠ¤íŒŒì´ë”": ["ë„¤íŠ¸ ìŠ¤íŒŒì´ë” ìƒì˜", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ ìƒì˜", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ í•˜ì˜", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ ì–´ê¹¨", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ í—ˆë¦¬", "ì›¹ ìŠ¤íŒŒì´ë”ì˜ ì‹ ë°œ"],
    "ê°•ì²  ìš©": ["ê°•ì²  ìš©ì˜ ìŠ¤ì¼€ì¼ ì¬í‚·", "ê°•ì²  ìš©ì˜ ê°€ì£½ ì¬í‚·", "ê°•ì²  ìš©ì˜ ê°€ì£½ ê·¸ë¦¬ë¸Œ", "ê°•ì²  ìš©ì˜ ë¿” ì¥ì‹", "ê°•ì²  ìš©ì˜ íœ´ëŒ€ìš© ë²¨íŠ¸", "ê°•ì²  ìš©ì˜ ê°€ì£½ ì‹ ë°œ"],
    "ë²„ë‹ ê¸°ì–´": ["ë¸”ë ˆì´ì§• ê¸°ì–´ í”Œë ˆì´íŠ¸ ë©”ì¼", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ë©”ì¼", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ë ˆê¹…ìŠ¤", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ í–‡", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ì½”ì¼", "ë²„ë‹ ê¸°ì–´ í”Œë ˆì´íŠ¸ ì‚¬ë°”í†¤"],
    "ë¹›ì˜ í—Œì‹ ì": ["ë¹›ì˜ ìˆ˜í˜¸ìì˜ ìƒì˜", "ë¹›ì˜ í—Œì‹ ìì˜ ìƒì˜", "ë¹›ì˜ í—Œì‹ ìì˜ í•˜ì˜", "ë¹›ì˜ í—Œì‹ ìì˜ ëª¨ì", "ë¹›ì˜ í—Œì‹ ìì˜ í—ˆë¦¬ì¥ì‹", "ë¹›ì˜ í—Œì‹ ìì˜ ì‹ ë°œ"],
    "ì—¬ëª…": ["ì—¬ëª…ì„ ë°íŒ ìì˜ ìƒì˜", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ìƒì˜", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ë°”ì§€", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ì–´ê¹¨ ë§ëŒ", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ í—ˆë¦¬ë ", "ì—¬ëª…ì„ ì˜ì•„ ì˜¬ë¦¬ëŠ” ìì˜ ì‹ ë°œ"],
    "ì¹´ì‹œí…Œì›€": ["ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ì•„ë¨¸Mk2", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ì•„ë¨¸", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ê°ë°˜", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ìƒˆë¡œìš´ ì†", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ì½”ì¼", "ì½°íŠ¸ë¡œ ì¹´ì‹œí…Œì›€ ê·¸ë¦¬ë¸Œ"],
    "ì „íˆ¬ê¸°ê°‘": ["ê·¸ëŸ°ë° ë§ˆëˆ„ìŠ¤ ì „íˆ¬ê¸°ê°‘ ìƒì˜", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ ìƒì˜", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ í•˜ì˜", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ í—¤ë“œê¸°ì–´", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ í—ˆë¦¬", "ê·¸ë€ë° ì „íˆ¬ê¸°ê°‘ ì‹ ë°œ"],
    "ë§ˆë ¥ì˜ ì†Œìš©ëŒì´": ["ë ˆê±°ì‹œ: íœ˜ëª°ì•„ì¹˜ëŠ” ë§ˆë ¥ì˜ íƒœí’", "ë ˆê±°ì‹œ: ë§ˆë ¥ì˜ í­í’ìš°", "ë ˆê±°ì‹œ: ì˜ë ¥ì˜ íšŒì˜¤ë¦¬", "ë ˆê±°ì‹œ: ë§ˆë²•ì˜ ëŒ€ê²©ë³€", "ë ˆê±°ì‹œ: ë§ˆë‚˜ì˜ ì†Œìš©ëŒì´", "ë ˆê±°ì‹œ: ì •ìˆ˜ì˜ íƒœí’"],
    "ìì—°ì˜ ìˆ˜í˜¸ì": ["ë ˆê±°ì‹œ: ë£¨ë¯¸ë„ˆìŠ¤ ì˜¤í†  ìƒì˜", "ë ˆê±°ì‹œ: ë¼ì´íŠ¸ë‹ˆìŠ¤ ì˜¤í†  ìƒì˜", "ë ˆê±°ì‹œ: íŒŒì´ì–´ë‹ˆìŠ¤ ì˜¤í†  í•˜ì˜", "ë ˆê±°ì‹œ: ë¸”ë™ë‹ˆìŠ¤ ì˜¤í†  ì–´ê¹¨", "ë ˆê±°ì‹œ: ì•„ì´ë‹ˆìŠ¤ ì˜¤í†  ë²¨íŠ¸", "ë ˆê±°ì‹œ: ìœˆë“œë‹ˆìŠ¤ ì˜¤í†  ì‹ ë°œ"]
};

const accSets = {
    "ì—˜íŒ… ë©”ëª¨ë¦¬ì–¼": ["ì„ ëª…í•œ ê¸°ì–µì˜ íŒ”ì°Œ", "ë¬»íŒ ì‹œê°„ì˜ íŒ”ì°Œ", "íë¦¿í•œ ê³¼ê±°ì˜ ëª©ê±¸ì´", "ë®ì–´ë‘” ê¸°ì–µì˜ ë°˜ì§€"],
    "ì„¬ëœ©í•œ ë¹›": ["ì´ì‹¬ì „ì‹¬", "ë¬´ì–¸ì˜ ì—°ê²°", "ìˆ¨ê²¨ì§„ ë§¥ë½", "ê°ì¶°ì§„ ê²°"],
    "ë¶€ì‹ëœ ë©”íƒˆê¸°ì–´": ["ê¸°ê³„ì˜ ì‹¬ë°•", "ê¸°ê³„ì˜ ë§¥ë°•", "ì‚¬ë¼ì§„ ë™ë ¥", "ì •ì§€ëœ íë¦„"],
    "í™”ë ¥ ê°œì¡°": ["ë©€í‹°í”Œ íˆ´ì¦ˆ", "íŠ¸ë¦¬í”Œ íˆ´ì¦ˆ", "í”¼ì–´ì‹± ë“œë¦´ ë„¤í´ë ˆìŠ¤", "ì˜¤í† ë§¤í‹± ì‹¤ë¦°ë”"],
    "ë¹›ì˜ ì†Œìš©ëŒì´": ["ì‹œë¦° ë‹¬ë¹›", "í‘¸ë¥¸ ë‹¬ë¹›", "ì€ìƒ‰ì˜ ë³„ë¹›", "ë¶‰ì€ í–‡ë¹›"],
    "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤": ["ê¸°ê³„ì˜ ì£¼ì‹œ", "ê¸°ê³„ì˜ ì‹œì„ ", "ì—ë„ˆì§€ì˜ ëˆˆ", "ì‘ì‹œì˜ í”ì "],
    "ì—í…Œë¦¬ì–¼": ["ë ˆê±°ì‹œ: ì•„ì´ì–¸ ì— ë²¨ë¦¬ì‹œë“œ ë°´ë“œ", "ë ˆê±°ì‹œ: ê°•ì²  ë¦¬ìŠ¤íŠ¸ ê°€ë“œ", "ë ˆê±°ì‹œ: ì˜í˜¼ ì¶”ì ì¥ì¹˜", "ë ˆê±°ì‹œ: í• ê¸°ì˜ ë³¸ë§"],
    "ì˜ê´‘ì˜ ì‹œëŒ€": ["ë ˆê±°ì‹œ: ì„¸ì´íŠ¸ ë£¨ë©˜ì•„ì´íŠ¸ ë ë¦­", "ë ˆê±°ì‹œ: í™€ë¦¬ ë¯¸ìŠ¤ë¦´ ë ë¦­", "ë ˆê±°ì‹œ: í  ë¡œìŠ¤ ê¸€ë¡œë¦¬", "ë ˆê±°ì‹œ: ì—ì´ì…˜íŠ¸ ì—˜ë¸ ë§"]
};

const specialSets = {
    "ê°œêµ¬ìŸì´ í˜¸ë¬¸ì¿¨ë£¨ìŠ¤": ["ë§ê´„ëŸ‰ì´ì˜ ë¬¸ì–‘ ê·€ê±¸ì´", "ë² í‚¤ì˜ ë¬¸ì–‘ ê·€ê±¸ì´", "ë² í‚¤ì˜ ìƒˆì´", "ë² í‚¤ì˜ ì¥ê°‘"],
    "ë¼ì´íŠ¸ë‹ ì—ë„ˆì§€ ì½”ì–´": ["ê±°ì‹ ì˜ ìŠ¤í™ì¿¨ë£¸ ì´ì–´ë§", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì´ì–´ë§", "ê±°ì¸ì˜ ìŠ¤í™ì¿¨ë£¸ ì½”ì–´", "ê±°ì¸ì˜ ê±´ë“¤ë¦¿"],
    "ì² ê°‘ì„ ë‘ë¥¸ íƒ‘": ["ë©”íƒˆê¸°ì–´ì˜ ì´ˆí•©ê¸ˆ íƒœì—½", "ë©”íƒˆê¸°ì–´ì˜ íƒœì—½ ê·€ê±¸ì´", "ë©”íƒˆê¸°ì–´ì˜ ë‘ë‡Œ", "ë©”íƒˆê¸°ì–´ì˜ ì¡°ì‘ë¶€"],
    "ë¶ˆêµ¬ë©ì´ì˜ ì„¬ë©¸ì": ["ê°•ì²  ìš©ì˜ ê¸°ê´€ì´ ì´ì–´ë§", "ê°•ì²  ìš©ì˜ ê¸°ì´ ì´ì–´ë§", "ê°•ì²  ìš©ì˜ ì²œê³µê¸°", "ê°•ì²  ìš©ì˜ ì¹¼ë‚  ì™¸ê³¨ê²©"],
    "í—ˆì˜ ì† ì–´ë‘ ": ["ê³¨ë“œ í¬ë¼ìš´ì˜ ì„œì»¤ìŠ¤ ì¥ì‹", "ê³¨ë“œ í¬ë¼ìš´ì˜ ë¨¸ë¦¬ ì¥ì‹", "ê³¨ë“œ í¬ë¼ìš´ì˜ í•µì‹¬ ë¶€í’ˆ", "ê³¨ë“œ í¬ë¼ìš´ì˜ ì—ë„ˆì§€ ë°©ì¶œê¸°"],
    "ë¶€ì •í•œ ë¹›ì˜ ìš°ìƒ": ["ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ ê¸°ì–µ", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ íƒœì—½ ì¥ì‹", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ ë‘ë‡Œ", "ì½°íŠ¸ë¡œ ë§ˆëˆ„ìŠ¤ì˜ ì—ë„ˆì§€ ì½”ì–´"]
};

    let charRuneData = {}; 
    let currentEditingCharId = null;
    // [ìˆ˜ì •] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ë„ë¡ ë³€ê²½
	let changeHistory = JSON.parse(localStorage.getItem(STORAGE_KEY + "_history") || "[]");
	
	// [ì¶”ê°€] ê¸°ë¡ ì €ì¥ ì „ìš© í•¨ìˆ˜ (í•¨ìˆ˜ë“¤ë³´ë‹¤ ìœ„ì— ë‘ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤)
function saveHistory() {
    localStorage.setItem(STORAGE_KEY + "_history", JSON.stringify(changeHistory));
}
	
    let lastSnapshot = localStorage.getItem(STORAGE_KEY) ? JSON.parse(localStorage.getItem(STORAGE_KEY)) : [];

    const rarityColors = {
    // ë“±ê¸‰/ìƒíƒœ
    "ì—í”½": "#fcc419", "ìœ ë‹ˆí¬": "#ff80ab", "ë ˆì–´": "#b197fc", "ì–¸ì»¤ë¨¼": "#4dabf7", "ì»¤ë¨¼": "#888", "í‹°ì–´": "#ffffff",
    "ì„ ë´‰": "#ff5252", "ì˜ì§€": "#448aff", "ì´ìƒ": "#40c057", "ë°ì´í„° ì´ˆê¸°í™”ë¨": "#ff5252", "ìƒˆë¡œìš´ ì„¤ì •ìœ¼ë¡œ ë³€ê²½ë¨": "#40c057",
    
    // ì ‘ë‘ì–´ (ì´ë¦„ì— í¬í•¨ë˜ê±°ë‚˜ ì„ íƒë  ë•Œ ì ìš©ë  ìƒ‰ìƒ)
    "ì „ê²©": "#fcc419", "í—ˆìƒ": "#fcc419", "ì‘ì—´": "#fcc419", "ì¹¨ì‹": "#fcc419", 
    "ìˆ˜í˜¸": "#fcc419", "ì™œê³¡": "#fcc419", "ììƒ": "#fcc419", "ë§¹ë…": "#fcc419", 
    "ë³´í˜¸": "#fcc419", "ì‡„ë„": "#fcc419", "ì‹ ì†": "#fcc419", "ì—°ê²©": "#fcc419",
	"ê²¬ê³ ": "#fcc419", "í˜ˆë…": "#fcc419", "ì´ˆì„": "#fcc419", "ê°ì˜¤": "#fcc419", "ê°€ì†": "#fcc419", "ì¡°í™”": "#fcc419",
	"ë¶ˆêµ´": "#fcc419", "ìˆ™ë ¨": "#fcc419", "ê²°ì˜": "#fcc419", "ê²©ë³€": "#fcc419", "ì´‰ì§„": "#fcc419", "ì§ˆì£¼": "#fcc419"
	
};
const accPrefixes = ["", "ê²¬ê³ ", "í˜ˆë…", "ì´ˆì„", "ê°ì˜¤", "ê°€ì†", "ì¡°í™”"];
const specPrefixes = ["", "ë¶ˆêµ´", "ìˆ™ë ¨", "ê²°ì˜", "ê²©ë³€", "ì´‰ì§„", "ì§ˆì£¼"];

// ë‚ ì§œì™€ ì‹œê°„ì„ "YYYY-MM-DD HH:mm:ss" í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
function getCurrentDateTime() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');

    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
}

function runSetCheck(slot, charId) {
	const armorSlots = ["ìƒì˜", "í•˜ì˜", "ì–´ê¹¨", "ë²¨íŠ¸", "ì‹ ë°œ"];
	const accSlots = ["íŒ”ì°Œ", "ëª©ê±¸ì´", "ë°˜ì§€"];
    const specialSlots = ["ê·€ê±¸ì´", "ë§ˆë²•ì„", "ë³´ì¡°ì¥ë¹„"];

    if (armorSlots.includes(slot)) {
        checkArmorSetColor(charId);
    } else if (accSlots.includes(slot)) {
        checkAccSetColor(charId);
    } else if (specialSlots.includes(slot)) {
        checkSpecialSetColor(charId);
    }
}

function checkArmorSetColor(charId) {
    const section = document.getElementById(charId);
    if (!section) return;

    // 1. ì²´í¬í•  ëŒ€ìƒ ìŠ¬ë¡¯ ì •ì˜ (ë°©ì–´êµ¬ 5ì¢… + ì•…ì„¸ 3ì¢… + íŠ¹ì¥ 3ì¢…)
    const checkSlots = [
        "ìƒì˜", "í•˜ì˜", "ì–´ê¹¨", "ë²¨íŠ¸", "ì‹ ë°œ", 
        "ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€", 
        "ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„"
    ];

    // 2. í˜„ì¬ ìºë¦­í„°ì˜ ì¥ì°© ì•„ì´í…œ ì´ë¦„ ìˆ˜ì§‘ { "ìƒì˜": "ì´ë¦„", ... }
    const currentItems = {};
    checkSlots.forEach(slot => {
        const el = section.querySelector(`[data-key="${slot}_itemname"]`);
        if (el && el.value.trim()) {
            currentItems[slot] = el.value.trim();
        }
    });

    // 3. ì–´ë–¤ ì„¸íŠ¸ê°€ ëª‡ ê°œ ëª¨ì˜€ëŠ”ì§€ ì¹´ìš´íŠ¸ { "ë§ê´„ëŸ‰ì´": 3, "íƒí‹±ì»¬": 1 }
    const setCounts = {};
    // ê° ìŠ¬ë¡¯ì˜ ì•„ì´í…œì´ ì–´ë–¤ ì„¸íŠ¸ì— ì†í•˜ëŠ”ì§€ ë§¤í•‘ { "ìƒì˜": "ë§ê´„ëŸ‰ì´" }
    const slotToSetName = {}; 

    for (const [setName, setList] of Object.entries(armorSets)) {
        setCounts[setName] = 0;
        checkSlots.forEach(slot => {
            const itemName = currentItems[slot];
            // armorSets[ì„¸íŠ¸ëª…] ë°°ì—´ ì•ˆì— í˜„ì¬ ì•„ì´í…œ ì´ë¦„ì´ ì •í™•íˆ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            if (itemName && setList.includes(itemName)) {
                setCounts[setName]++;
                slotToSetName[slot] = setName;
            }
        });
    }

    // 4. UI ë°˜ì˜: 3ì„¸íŠ¸ ì´ìƒì¼ ê²½ìš° ê¸€ììƒ‰ ë³€ê²½
    checkSlots.forEach(slot => {
        const el = section.querySelector(`[data-key="${slot}_itemname"]`);
        if (!el) return;

        const setName = slotToSetName[slot];
        // í•´ë‹¹ ì•„ì´í…œì´ ì†Œì†ëœ ì„¸íŠ¸ê°€ ìˆê³ , ê·¸ ì„¸íŠ¸ì˜ ì „ì²´ ê°œìˆ˜ê°€ 3ê°œ ì´ìƒì´ë©´ ê°•ì¡°
        if (setName && setCounts[setName] >= 3) {
            el.style.setProperty("color", "#71D2E5", "important"); // í˜•ê´‘ ì—°ë‘ìƒ‰ìœ¼ë¡œ ê°•ì œ ì ìš©
            el.style.fontWeight = "bold";
            el.title = `${setName} ì„¸íŠ¸ íš¨ê³¼ í™œì„±í™” (${setCounts[setName]}ì…‹)`; // ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì •ë³´ í‘œì‹œ
        } else {
            // ì„¸íŠ¸ê°€ ì•„ë‹ˆë©´ ê¸°ë³¸ í¬ê·€ë„ ìƒ‰ìƒ(CSS)ì„ ë”°ë¥´ë„ë¡ ìŠ¤íƒ€ì¼ ì œê±°
            el.style.color = "";
            el.style.fontWeight = "";
            el.title = "";
        }
    });
}

function checkAccSetColor(charId) {
    const section = document.getElementById(charId);
    if (!section) return;

    const accSlots = ["íŒ”ì°Œ", "ëª©ê±¸ì´", "ë°˜ì§€"];
    let equippedItems = [];
    let isAllEpic = true;

    accSlots.forEach(slot => {
        const raritySel = section.querySelector(`select[data-key="${slot}_rarity"]`);
        const nameEl = section.querySelector(`[data-key="${slot}_itemname"]`);
        
        const rarity = raritySel ? raritySel.value : "";
        const name = nameEl ? nameEl.value.trim() : "";

        if (rarity !== "ì—í”½") isAllEpic = false;
        if (name) equippedItems.push(name);
    });

    let isSetComplete = false;
    if (isAllEpic && equippedItems.length >= 3) {
        for (const setName in accSets) {
            const setList = accSets[setName];
            const matchCount = equippedItems.filter(item => setList.includes(item)).length;
            if (matchCount >= 3) {
                isSetComplete = true;
                break;
            }
        }
    }

    accSlots.forEach(slot => {
        const nameEl = section.querySelector(`[data-key="${slot}_itemname"]`);
        if (nameEl) {
            if (isSetComplete) {
                nameEl.style.setProperty('color', '#71D2E5', 'important');
            } else {
                nameEl.style.color = ""; 
            }
        }
    });
}

function checkSpecialSetColor(charId) {
    const section = document.getElementById(charId);
    if (!section) return;

    const specialSlots = ["ê·€ê±¸ì´", "ë§ˆë²•ì„", "ë³´ì¡°ì¥ë¹„"];
    let equippedItems = [];
    let isAllEpic = true;

    specialSlots.forEach(slot => {
        const raritySel = section.querySelector(`select[data-key="${slot}_rarity"]`);
        const nameEl = section.querySelector(`[data-key="${slot}_itemname"]`);
        
        const rarity = raritySel ? raritySel.value : "";
        const name = nameEl ? nameEl.value.trim() : "";

        if (rarity !== "ì—í”½") isAllEpic = false;
        if (name) equippedItems.push(name);
    });

    let isSetComplete = false;
    if (isAllEpic && equippedItems.length >= 3) {
        for (const setName in specialSets) {
            const setList = specialSets[setName];
            const matchCount = equippedItems.filter(item => setList.includes(item)).length;
            if (matchCount >= 3) {
                isSetComplete = true;
                break;
            }
        }
    }

    specialSlots.forEach(slot => {
        const nameEl = section.querySelector(`[data-key="${slot}_itemname"]`);
        if (nameEl) {
            if (isSetComplete) {
                nameEl.style.setProperty('color', '#71D2E5', 'important');
            } else {
                nameEl.style.color = ""; 
            }
        }
    });
}




    // ìƒ‰ìƒì„ ì ìš©í•´ì£¼ëŠ” í—¬í¼ í•¨ìˆ˜
function getSpanWithColor(text) {
    // í…ìŠ¤íŠ¸ê°€ ì ‘ë‘ì–´ë¥¼ í¬í•¨í•˜ê±°ë‚˜ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
    let color = "#ddd";
    for (const key in rarityColors) {
        if (text.includes(key)) {
            color = rarityColors[key];
            break;
        }
    }
    return `<span style="color:${color}; font-weight:bold;">${text}</span>`;
}

    // [ì¤‘ìš”] ëˆ„ë½ë˜ì—ˆë˜ ì ê¸ˆ í•¨ìˆ˜ ì¶”ê°€
function toggleEdit(charId, isLock) {
    const section = document.getElementById(charId);
    if (!section) return;

    // 1. ì œì–´í•  ë²„íŠ¼ë“¤
    const lockBtn = section.querySelector('.lock-btn');
    const unlockBtn = section.querySelector('.unlock-btn');
    const actionBtns = section.querySelectorAll('.btn-action'); // ë£¬ ìˆ˜ì •/ì´ˆê¸°í™” ë²„íŠ¼
    const delBtn = section.querySelector('.del-btn'); // ì‚­ì œ ë²„íŠ¼

    // 2. ëª¨ë“  ì…ë ¥ ìš”ì†Œ(input, select, textarea) ì œì–´
    const inputs = section.querySelectorAll('input, select, textarea');

    inputs.forEach(el => {
        if (el === lockBtn || el === unlockBtn) return;

        if (isLock) {
            if (el.tagName === 'SELECT') {
                el.disabled = true;
            } else {
                el.readOnly = true;
            }
            // ì ê¸ˆ ìƒíƒœì¼ ë•ŒëŠ” ëª¨ë‘ ê¸°ë³¸ í™”ì‚´í‘œ ëª¨ì–‘ìœ¼ë¡œ
            el.style.cursor = "default";
        } else {
            el.disabled = false;
            el.readOnly = false;

            // [ìˆ˜ì • í¬ì¸íŠ¸] ìš”ì†Œì˜ ì¢…ë¥˜ì— ë”°ë¼ ì»¤ì„œ ëª¨ì–‘ì„ ë‹¤ë¥´ê²Œ ì„¤ì •
            if (el.tagName === 'SELECT' || el.type === 'button') {
                el.style.cursor = "pointer"; // ì„ íƒì°½ì€ 'ì†ëª¨ì–‘'
            } else {
                el.style.cursor = "text";    // ì…ë ¥ì°½ì€ 'Iì ëª¨ì–‘'
            }
        }
    });

    // 3. ê¸°ëŠ¥ì„± ë²„íŠ¼ ì œì–´ (ë£¬ ìˆ˜ì •, ì‚­ì œ ë“±)
    [...actionBtns, delBtn].forEach(btn => {
        if (btn) {
            btn.disabled = isLock;
            btn.style.opacity = isLock ? "0.5" : "1";
            btn.style.pointerEvents = isLock ? "none" : "auto";
        }
    });

    // 4. UI ìƒíƒœ ë°˜ì˜
    if (isLock) {
        lockBtn?.classList.add('btn-active');
        unlockBtn?.classList.remove('btn-active');
    } else {
        lockBtn?.classList.remove('btn-active');
        unlockBtn?.classList.add('btn-active');
    }

    // â˜… ì¤‘ìš”: ì ê¸ˆ ì‹œì ì— ë°ì´í„°ë¥¼ ë‚ ë¦¬ì§€ ì•Šë„ë¡ autoSaveëŠ” ìƒíƒœ ê°’ë§Œ ì €ì¥í•˜ë„ë¡ ì£¼ì˜
    autoSave();
}

// 3. ë©”ì¸ í…Œì´ë¸” ìƒì„± í•¨ìˆ˜ (ì „ì²´ ë²„ì „)
function createCharacterTable(savedData = null) {
    // 1) ê³ ìœ  ID ìƒì„± ë° ë£¬ ë°ì´í„° ì´ˆê¸°í™”
    const charId = savedData && savedData.id ? savedData.id : "char_" + Date.now() + Math.random().toString(16).slice(2);
    const section = document.createElement('div');
    section.className = 'char-section';
    section.id = charId;

    // ë£¬ ë°ì´í„° ë©”ëª¨ë¦¬ í• ë‹¹
    charRuneData[charId] = (savedData && savedData.runeData) ? savedData.runeData : { 
        runes: Array(20).fill().map(() => ({ name: '', lv: '', skillLv: '' })), 
        gakin: ['', ''] 
    };

    // 2) í…Œì´ë¸” ê¸°ë³¸ êµ¬ì¡°(HTML) ìƒì„±
    section.innerHTML = `
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th rowspan="2" class="col-char-info">ì§ì—…/ì´ë¦„</th>
                        <th rowspan="2" class="col-slot v-border-heavy">ìŠ¬ë¡¯</th>
                        <th rowspan="2" class="col-rarity">í¬ê·€ë„</th>
                        <th rowspan="2" class="col-exceed">ìµì‹œë“œ</th>
                        <th rowspan="2" class="col-prefix">ì ‘ë‘ì–´</th>
                        <th rowspan="2" style="min-width:120px;">ì•„ì´í…œì´ë¦„</th>
                        <th rowspan="2" class="col-val-short">ê°•í™”</th>
                        <th colspan="4" class="group-header">ë§ˆë²•ë´‰ì¸</th>
                        <th colspan="2" class="group-header">ì— ë¸”ë ˜</th>
                        <th colspan="2" class="group-header">ë§ˆë²•ë¶€ì—¬</th>
                        <th rowspan="2" style="min-width:230px;" class="v-border-heavy">ì„¤ëª…</th>
                    </tr>
                    <tr>
                        <th>ê³ ìœ  ì˜µì…˜</th><th class="col-val-short">ìˆ˜ì¹˜</th><th>ì¼ë°˜ ì˜µì…˜</th><th class="col-val-short">ìˆ˜ì¹˜</th>
                        <th class="col-emblem">ì— ë¸”ë ˜</th><th class="col-emblem">ì— ë¸”ë ˜</th>
                        <th class="col-enchant">ë§ˆë²•ë¶€ì—¬</th><th class="col-val-short">ìˆ˜ì¹˜</th>
                    </tr>
                </thead>
                <tbody class="tbody-content"></tbody>
            </table>
        </div>`;

    const tbody = section.querySelector('.tbody-content');

    // 3) ê° ì¥ë¹„ ìŠ¬ë¡¯(20ì—¬ ê°œ) ìƒì„± ë£¨í”„
    slots.forEach((slot, index) => {
        const tr = document.createElement('tr');
        if (heavyBorderSlots.includes(slot)) tr.style.borderBottom = "2px solid var(--border-heavy)";
        
        // ì™¼ìª½ ìºë¦­í„° ì •ë³´ ì¹¸ (ì²« ë²ˆì§¸ í–‰ì—ë§Œ rowspanìœ¼ë¡œ ì¶”ê°€)
        if (index === 0) {
            tr.innerHTML += `
            <td rowspan="${slots.length}" style="background-color: #121216; vertical-align: top;">
                <div style="display:flex; flex-direction:column; gap:4px; padding:5px;">
                    <div style="display:flex; gap:4px;">
                        <select data-key="info_stat_type" onchange="applySealHighlight('${charId}'); autoSave();" style="flex:1; border:1px solid #444; background:#000; color:#fff; font-size:11px; height:22px;">
                            <option value="">(ìŠ¤íƒ¯)</option>
                            <option value="í˜">í˜</option>
                            <option value="ì§€ëŠ¥">ì§€ëŠ¥</option>
                        </select>
                        <select data-key="info_ele_type" onchange="applySealHighlight('${charId}'); autoSave();" style="flex:1; border:1px solid #444; background:#000; color:#fff; font-size:11px; height:22px;">
                            <option value=""></option>
                            <option value="í™”ì†ê°•">í™”ì†ê°•</option>
                            <option value="ìˆ˜ì†ê°•">ìˆ˜ì†ê°•</option>
                            <option value="ëª…ì†ê°•">ëª…ì†ê°•</option>
                            <option value="ì•”ì†ê°•">ì•”ì†ê°•</option>
                        </select>
                    </div>
                    <div style="border-bottom: 2px solid var(--gold); margin: 4px 0;"></div>
                    <input type="text" placeholder="ì§ì—…" data-key="info_job" oninput="autoSave()">
                    <input type="text" placeholder="ì´ë¦„" data-key="info_name" oninput="autoSave()">
					<input type="text" placeholder="í•­ë§ˆë ¥" data-key="info_power" oninput="autoSave()">
                    <div style="border-bottom: 2px solid var(--gold); margin: 8px 0;"></div>
                    <button onclick="toggleEdit('${charId}', true)" class="btn-char-lock lock-btn">ì ê¸ˆ</button>
                    <button onclick="toggleEdit('${charId}', false)" class="btn-char-unlock unlock-btn">í•´ì œ</button>
                    <div style="border-bottom: 2px solid var(--gold); margin: 10px 0;"></div>
					<div style="display:flex; gap:2px; margin-bottom: 4px;">
						<button onclick="moveCharacter('${charId}', 'up')" class="btn-action" style="flex:1; background:#444; padding:2px;">â–²</button>
						<button onclick="moveCharacter('${charId}', 'down')" class="btn-action" style="flex:1; background:#444; padding:2px;">â–¼</button>
					</div>
                    <button onclick="deleteCharacter('${charId}')" class="del-btn" style="background:#ff4d4d; color:white; border:none; padding:4px; cursor:pointer; font-size:11px; border-radius:2px;">ì‚­ì œ</button>
                </div>
            </td>`;
        }

        // 4) ìŠ¬ë¡¯ë³„ íŠ¹ìˆ˜ UI ë¶„ê¸° (ìŠ¤í‚¬ë£¬, í¬ë¦¬ì³, ì¼ë°˜ì¥ë¹„)
        if (slot === "ìŠ¤í‚¬ë£¬") {
            tr.innerHTML += `
                <td class="col-slot v-border-heavy">ìŠ¤í‚¬ë£¬</td>
                <td colspan="3"><button class="btn-action" onclick="openRuneModal('${charId}')" style="background:#059669; padding:2px 8px;">ìˆ˜ì •</button> <button class="btn-action" onclick="resetRuneData('${charId}')" style="background:#444; padding:2px 8px;">ì´ˆê¸°í™”</button></td>
                <td colspan="10" id="${charId}_runeSummary" style="text-align:left; padding-left:10px; color:var(--gold); font-size:11px; font-weight:bold;">ì„¤ì •ëœ ë£¬ ì—†ìŒ</td>
                <td class="v-border-heavy"><input type="text" data-key="${slot}_desc" oninput="autoSave()" style="text-align: left; padding-left: 6px;"></td>`;
        } else if (slot === "í¬ë¦¬ì³") {
            tr.innerHTML += `
        <td class="col-slot v-border-heavy">í¬ë¦¬ì³</td>
        <td class="col-rarity">
            <select data-key="${slot}_rarity" onchange="updateStyle(this, 'rarity')" class="rare-ì—í”½">
                <option>ì—í”½</option><option>ìœ ë‹ˆí¬</option><option>ë ˆì–´</option><option>ì–¸ì»¤ë¨¼</option><option>ì»¤ë¨¼</option>
            </select>
        </td>
        <td colspan="2">
            <input type="text" data-key="${slot}_name" placeholder="í¬ë¦¬ì³ ì´ë¦„" class="rare-ì—í”½" oninput="autoSave()">
        </td>
        <td colspan="10">
            <div class="artifact-main-wrapper">
                ${['red', 'blue', 'green'].map((color) => `
                    <div class="art-group">
                        <div class="art-item custom-top-line" style="margin-bottom: 4px; border-bottom: 1px dashed #444; padding-bottom: 4px;">
                            <select data-key="${slot}_art_${color}_top_rarity"
                                    class="art-color-select bg-ì—í”½"
                                    style="width:65px;"
                                    onchange="updateStyle(this, 'artBg')">
                                <option>ì—í”½</option><option>ìœ ë‹ˆí¬</option><option>ë ˆì–´</option><option>ì–¸ì»¤ë¨¼</option><option>ì»¤ë¨¼</option>
                            </select>
                            <input type="text"
                                   data-key="${slot}_art_${color}_top_text"
                                   class="art-opt-select bg-ì—í”½"
                                   style="width:110px;"
                                   placeholder="ë‚´ìš© ì…ë ¥"
                                   oninput="autoSave()">
                        </div>
                        ${[1, 2].map(num => `
                            <div class="art-item">
                                <select data-key="${slot}_art_${color}_bg_${num}" class="art-color-select bg-ì—í”½" style="width:65px;" onchange="updateStyle(this, 'artBg')"><option>ì—í”½</option><option>ìœ ë‹ˆí¬</option><option>ë ˆì–´</option><option>ì–¸ì»¤ë¨¼</option><option>ì»¤ë¨¼</option></select>
                                <select data-key="${slot}_art_${color}_opt_${num}" class="art-opt-select bg-ì—í”½" style="width:110px;" onchange="autoSave()"><option value="">ì˜µì…˜ ì„ íƒ</option>${artOptions[color].map(o=>`<option>${o}</option>`).join('')}</select>
                            </div>`).join('')}
                    </div>`).join('')}
            </div>
        </td>
        <td class="v-border-heavy"><input type="text" data-key="${slot}_desc" oninput="autoSave()" style="text-align: left; padding-left: 6px;"></td>`;
        } else {
            // ì¼ë°˜ ì¥ë¹„ ìŠ¬ë¡¯ ë¡œì§
            const isEq = index < 12; 
            const isExSlot = ['ìƒì˜', 'íŒ”ì°Œ', 'ê·€ê±¸ì´'].includes(slot);
            const hasEmb = !["ì™¸í˜•ì¹­í˜¸", "ì˜¤ë¼", "ì•„ë°”íƒ€", "í¬ë¦¬ì³"].includes(slot);
            const isElemSlot = ["ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„", "ì¹­í˜¸"].includes(slot);
			
			// [ìˆ˜ì • í¬ì¸íŠ¸] ì‹ ê·œ ì¶”ê°€ ì‹œ ë§ˆë²•ë¶€ì—¬ ê¸°ë³¸ê°’ ì„¤ì • ë¡œì§
			let defaultEnchant = "";
			let defaultEnchantVal = "";
			
			if (!savedData) { // ì‹ ê·œ ìºë¦­í„° ì¶”ê°€ì¼ ë•Œë§Œ ì‹¤í–‰
				if (slot === "ë¬´ê¸°") {
					defaultEnchant = "ë¬¼ë§ˆê³µ"; defaultEnchantVal = "30";
				} else if (["ìƒì˜", "í•˜ì˜"].includes(slot)) {
					defaultEnchant = "í˜ì§€ëŠ¥"; defaultEnchantVal = "68";
				} else if (["ì–´ê¹¨", "ì‹ ë°œ", "ë²¨íŠ¸"].includes(slot)) {
					defaultEnchant = "ë¬¼ë§ˆí¬"; defaultEnchantVal = "50";
				} else if (["ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€"].includes(slot)) {
					defaultEnchant = "ëª¨ì†ê°•"; defaultEnchantVal = "13";
				} else if (slot === "ë³´ì¡°ì¥ë¹„") {
					defaultEnchant = "ë¬¼ë§ˆê³µ/í¬"; defaultEnchantVal = "30/19";
				}
			}
            
            // ë§ˆë²•ë´‰ì¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            let g = { n1: [], n2: [] };
            if(slot === "ë¬´ê¸°") g = mData.weapon;
            else if(index >= 1 && index <= 5) g = mData.armor; 
            else if(index >= 6 && index <= 8) g = mData.accessory; 
            else if(index >= 9 && index <= 11) g = mData.special;

            let embCls = (["ìƒì˜", "í•˜ì˜"].includes(slot)) ? "emb-bg-red" : (["ì–´ê¹¨", "ë²¨íŠ¸"].includes(slot)) ? "emb-bg-yellow" : (["ì‹ ë°œ", "íŒ”ì°Œ"].includes(slot)) ? "emb-bg-blue" : (["ëª©ê±¸ì´", "ë°˜ì§€"].includes(slot)) ? "emb-bg-green" : "emb-bg-gray";
            const tierSlots = ["ë¬´ê¸°", "ìƒì˜", "ì–´ê¹¨", "í•˜ì˜", "ì‹ ë°œ", "ë²¨íŠ¸", "ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€", "ë³´ì¡°ì¥ë¹„"];
            const rarityOptions = tierSlots.includes(slot) ? `<option>ì—í”½</option><option>ìœ ë‹ˆí¬</option><option>ë ˆì–´</option><option>ì–¸ì»¤ë¨¼</option><option>ì»¤ë¨¼</option><option>í‹°ì–´</option>` : `<option>ì—í”½</option><option>ìœ ë‹ˆí¬</option><option>ë ˆì–´</option><option>ì–¸ì»¤ë¨¼</option><option>ì»¤ë¨¼</option>`;

            let itemNameHTML = itemOptions[slot] 
                ? `<select data-key="${slot}_itemname" class="rare-ì—í”½ itemname-color-sync" onchange="${["ìƒì˜","í•˜ì˜","ì–´ê¹¨","ë²¨íŠ¸","ì‹ ë°œ"].includes(slot) ? `checkArmorSetColor('${charId}'); ` : ''}autoSave()"><option value=""></option>${itemOptions[slot].map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select>`
                : `<input type="text" data-key="${slot}_itemname" class="rare-ì—í”½ itemname-color-sync" oninput="autoSave()">`;

            let descTdHTML = (slot === "ì¹­í˜¸") ? `<td rowspan="2" class="v-border-heavy" style="padding: 2px; vertical-align: middle;"><textarea data-key="ì¹­í˜¸_desc" oninput="autoSave()" style="width:calc(100% - 4px); height:calc(100% - 2px); min-height:44px; background:#000; color:#fff; border:1px solid #444; padding:4px 6px; resize:none; font-family: sans-serif; font-size: 11px; box-sizing:border-box; text-align:left; outline:none;"></textarea></td>` : (slot === "ì™¸í˜•ì¹­í˜¸") ? '' : `<td class="v-border-heavy"><input type="text" data-key="${slot}_desc" oninput="autoSave()" style="text-align: left; padding-left: 6px; outline:none;"></td>`;

            const tabAttr = (slot === "ì™¸í˜•ì¹­í˜¸") ? 'tabindex="-1"' : '';

            tr.innerHTML += `
    <td class="col-slot v-border-heavy">${slot}</td>
    <td class="col-rarity"><select ${tabAttr} data-key="${slot}_rarity" data-slot="${slot}" onchange="updateStyle(this, 'rarity')" class="rare-ì—í”½">${rarityOptions}</select></td>
    <td class="col-exceed">${isExSlot ? `<select ${tabAttr} data-key="${slot}_exceed" data-slot="${slot}" onchange="updateStyle(this,'exceed')"><option></option><option>ì´ìƒ</option><option>ì„ ë´‰</option><option>ì˜ì§€</option></select>` : '-'}</td>
    <td class="col-prefix">${isEq ? `<select ${tabAttr} data-key="${slot}_prefix" data-slot="${slot}" onchange="updateStyle(this,'prefix')">${prefixes.map(p=>`<option>${p}</option>`).join('')}</select>` : '-'}</td>
    <td>${itemNameHTML.replace('<select ', '<select ' + tabAttr + ' ').replace('<input ', '<input ' + tabAttr + ' ')}</td>
    <td class="col-val-short">${isEq ? `<input ${tabAttr} type="text" data-key="${slot}_reinforce" oninput="autoSave()">` : '-'}</td>
    <td>${isEq ? `<select ${tabAttr} data-key="${slot}_seal1" data-slot="${slot}" onchange="handleSealChange(this)">${g.n1.map(o=>`<option>${o}</option>`).join('')}</select>` : '-'}</td>
    <td class="col-val-short">${isEq ? `<input ${tabAttr} type="text" data-key="${slot}_seal1_val" oninput="applySealHighlight('${charId}'); autoSave();">` : '-'}</td>
    <td>${isEq ? `<select ${tabAttr} data-key="${slot}_seal2" data-slot="${slot}" onchange="handleSealChange(this)">${g.n2.map(o=>`<option>${o}</option>`).join('')}</select>` : '-'}</td>
    <td class="col-val-short">${isEq ? `<input ${tabAttr} type="text" data-key="${slot}_seal2_val" oninput="applySealHighlight('${charId}'); autoSave();">` : '-'}</td>
    <td class="col-emblem">${hasEmb ? (isElemSlot ? `<select ${tabAttr} data-key="${slot}_emb1" class="${embCls}" onchange="autoSave()">${elementEmbList.map(e=>`<option>${e}</option>`).join('')}</select>` : `<input ${tabAttr} type="text" data-key="${slot}_emb1" class="${embCls}" oninput="autoSave()">`) : '-'}</td>
    <td class="col-emblem">${hasEmb ? `<input ${tabAttr} type="text" data-key="${slot}_emb2" class="${embCls}" oninput="autoSave()">` : '-'}</td>
    <td class="col-enchant">${index < 12 || slot === "ì¹­í˜¸" ? `<input ${tabAttr} type="text" data-key="${slot}_enchant" value="${defaultEnchant}" oninput="autoSave()">` : '-'}</td>
    <td class="col-val-short">${index < 12 || slot === "ì¹­í˜¸" ? `<input ${tabAttr} type="text" data-key="${slot}_enchant_val" value="${defaultEnchantVal}" oninput="autoSave()">` : '-'}</td>
    ${descTdHTML}`;
        }
        tbody.appendChild(tr);
    });

    // 5) ë¬¸ì„œì— í…Œì´ë¸” ì‚½ì… ë° ì´ˆê¸°í™”
document.getElementById('characterContainer').appendChild(section);
updateRuneSummary(charId);

// [ìˆ˜ì • í¬ì¸íŠ¸] ì‹ ê·œ ì¶”ê°€ ì‹œì—ë„ ì ‘ë‘ì–´ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶€ìœ„ì— ë§ê²Œ ì¦‰ì‹œ ê°±ì‹ 
section.querySelectorAll('select[data-key$="_prefix"]').forEach(sel => {
    const slot = sel.getAttribute('data-slot');
    const raritySel = section.querySelector(`select[data-key="${slot}_rarity"]`);
    const rarity = raritySel ? raritySel.value : "ì—í”½"; // ê¸°ë³¸ê°’ ì—í”½ ê¸°ì¤€

    // updateStyleì„ í˜¸ì¶œí•˜ì—¬ ë¶€ìœ„ë³„(ì•…ì„¸/íŠ¹ìˆ˜/í‹°ì–´) ì ‘ë‘ì–´ ëª©ë¡ì„ ì¦‰ì‹œ ìƒì„±
    updateStyle(sel, 'prefix', true); 
    
    // rarityì— ë”°ë¥¸ ëª©ë¡ ë™ê¸°í™”ê°€ í•„ìš”í•˜ë¯€ë¡œ raritySelì„ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ 1íšŒ ì‹¤í–‰
    if (raritySel) {
        updateStyle(raritySel, 'rarity', true);
    }
});

    // 6) ì €ì¥ëœ ë°ì´í„° ë³µêµ¬ ë¡œì§
    if (savedData) {
        // 6-1) í¬ê·€ë„ ë¨¼ì € ì„¤ì • (ì´ì „ê³¼ ë™ì¼)
        const rarityInputs = section.querySelectorAll('select[data-key$="_rarity"]');
        rarityInputs.forEach(el => {
            const key = el.getAttribute('data-key');
            if (savedData.inputs[key]) {
                el.value = savedData.inputs[key].val;
                updateStyle(el, 'rarity', true);
            }
        });

        // 6-2) ëª¨ë“  ë‚˜ë¨¸ì§€ ì…ë ¥ê°’ ë³µêµ¬
        const inputs = section.querySelectorAll('input[data-key], select[data-key], textarea[data-key]');
        inputs.forEach(el => {
            const key = el.getAttribute('data-key');
            if (savedData.inputs && savedData.inputs[key]) {
                const data = savedData.inputs[key];
                if (key.endsWith('_rarity')) return;

                el.value = data.val;

                // [í•µì‹¬ ì¶”ê°€] í¬ë¦¬ì³ ì•„í‹°íŒ©íŠ¸ ë°°ê²½ìƒ‰ ê°•ì œ ë™ê¸°í™”
                if (key.includes('_art_') && key.includes('_bg_')) {
                    // ì´ ë¼ì¸ì´ ì‹¤í–‰ë˜ì–´ì•¼ selectì˜ valueì™€ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ê°€ ì¼ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤.
                    updateStyle(el, 'artBg', true);
                } else if (data.cls) {
                    el.className = data.cls;
                }

                if (key.endsWith('_prefix')) {
                    updateStyle(el, 'prefix', true);
                }
            }
        });

        // 3. [ìµœì¢… í•´ê²°ì±…] ëª¨ë“  ë°ì´í„°ê°€ ë“¤ì–´ê°„ ì§í›„, ë¸Œë¼ìš°ì €ê°€ DOMì„ ì•ˆì •í™”í•  ì‹œê°„ì„ ì•„ì£¼ ì ê¹(0ms) ì£¼ê³  í•¨ìˆ˜ í˜¸ì¶œ
        setTimeout(() => {
            // ë°©ì–´êµ¬ ì„¸íŠ¸ ì²´í¬
            if (typeof checkArmorSetColor === "function") {
                checkArmorSetColor(charId);
            }
            // ì•…ì„¸ì„œë¦¬ ë° íŠ¹ìˆ˜ì¥ë¹„ ì„¸íŠ¸ ì²´í¬
            const setTargetSlots = ["ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€", "ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„"];
            setTargetSlots.forEach(slot => {
                if (typeof runSetCheck === "function") {
                    runSetCheck(slot, charId);
                }
            });
            // í•˜ì´ë¼ì´íŠ¸ ì¬ì ìš©
            applySealHighlight(charId);
        }, 0);

        toggleEdit(charId, !!savedData.locked);
    }

    // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì €ì¥ëœ ìƒíƒœëŒ€ë¡œ, ì—†ìœ¼ë©´ í•´ì œ(false) ìƒíƒœë¡œ ì‹œì‘
    toggleEdit(charId, savedData ? !!savedData.locked : false);
}


    function handleSealChange(el) {
    const key = el.getAttribute('data-key');
    const slot = el.getAttribute('data-slot');
    const row = el.closest('tr');
    const opt = el.value;
    const armors = ["ìƒì˜", "ì–´ê¹¨", "í•˜ì˜", "ì‹ ë°œ", "ë²¨íŠ¸"];
    const accs = ["ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€"];
    const specials = ["ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„"];
    const commonValTable = { "í˜": "46", "ì§€ëŠ¥": "46", "ì²´ë ¥": "46", "ì •ì‹ ë ¥": "46", "ê³µê²©ì†ë„": "1.6", "ìºìŠ¤íŒ…ì†ë„": "2", "ì´ë™ì†ë„": "1.6", "ìµœëŒ€ HP ì¦ê°€": "456", "ìµœëŒ€ MP ì¦ê°€": "270", "ë¬¼ë¦¬ ë°©ì–´ë ¥": "234", "ë§ˆë²• ë°©ì–´ë ¥": "178", "ì ì¤‘": "124", "íšŒí”¼": "70" };

    // ===== 1. ê³ ìœ  ì˜µì…˜ (seal1) ìˆ˜ì¹˜ ìë™ ì…ë ¥ =====
    if (key.includes("_seal1")) {
        const vIn = row.querySelector(`input[data-key="${slot}_seal1_val"]`);
        if (!vIn) return;
        if (slot === "ë¬´ê¸°") {
            const weaponTable = { "ë°ë¯¸ì§€ ì¦ê°€": "8", "ì¶”ê°€ ë°ë¯¸ì§€": "8", "ëª¨ë“  ì§ì—… 50ë ˆë²¨ìŠ¤í‚¬": "1", "í™”ì†ê°•": "10", "ìˆ˜ì†ê°•": "10", "ëª…ì†ê°•": "10", "ì•”ì†ê°•": "10", "í˜": "46", "ì§€ëŠ¥": "46", "ë¬¼ë¦¬ ê³µê²©ë ¥": "19", "ë§ˆë²• ê³µê²©ë ¥": "19" };
            if (weaponTable[opt]) vIn.value = weaponTable[opt];
        } else if (armors.includes(slot)) {
            const armorTable = { "í˜": "46", "ì§€ëŠ¥": "46", "ì²´ë ¥": "46", "ì •ì‹ ë ¥": "46", "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬": "29", "ë§ˆë²• í¬ë¦¬í‹°ì»¬": "29" };
            if (armorTable[opt]) vIn.value = armorTable[opt];
        } else if (accs.includes(slot)) {
            const accTable = { "í™”ì†ê°•": "10", "ìˆ˜ì†ê°•": "10", "ëª…ì†ê°•": "10", "ì•”ì†ê°•": "10", "í˜": "46", "ì§€ëŠ¥": "46", "ì²´ë ¥": "46", "ì •ì‹ ë ¥": "46" };
            if (accTable[opt]) vIn.value = accTable[opt];
        } else if (specials.includes(slot)) {
            const specTable = { "ë¬¼ë¦¬ ê³µê²©ë ¥": "19", "ë§ˆë²• ê³µê²©ë ¥": "19", "í˜": "46", "ì§€ëŠ¥": "46", "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬": "60", "ë§ˆë²• í¬ë¦¬í‹°ì»¬": "60", "ì ì¤‘": "75", "íšŒí”¼": "75" };
            if (specTable[opt]) vIn.value = specTable[opt];
        }
    }

    // ===== 2. ì¼ë°˜ ì˜µì…˜ (seal2) ìˆ˜ì¹˜ ìë™ ì…ë ¥ =====
    if (key.includes("_seal2")) {
        const vIn = row.querySelector(`input[data-key="${slot}_seal2_val"]`);
        if (!vIn) return;
        if (slot === "ë¬´ê¸°") {
            if (opt === "ë¬¼ë¦¬ ê³µê²©ë ¥" || opt === "ë§ˆë²• ê³µê²©ë ¥") vIn.value = "18";
            else if (commonValTable[opt]) vIn.value = commonValTable[opt];
        } else if (armors.includes(slot)) {
            if (opt === "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬" || opt === "ë§ˆë²• í¬ë¦¬í‹°ì»¬") vIn.value = "30";
            else if (commonValTable[opt]) vIn.value = commonValTable[opt];
        } else if (accs.includes(slot)) {
            const resTable = { "í™”ì†ì„± ì €í•­": "8", "ìˆ˜ì†ì„± ì €í•­": "8", "ëª…ì†ì„± ì €í•­": "8", "ì•”ì†ì„± ì €í•­": "8", "í™”ì†ê°•": "8", "ìˆ˜ì†ê°•": "8", "ëª…ì†ê°•": "8", "ì•”ì†ê°•": "8" };
            if (resTable[opt]) vIn.value = resTable[opt];
            else if (commonValTable[opt]) vIn.value = commonValTable[opt];
        } else if (specials.includes(slot)) {
            if (opt === "ë¬¼ë¦¬ ê³µê²©ë ¥" || opt === "ë§ˆë²• ê³µê²©ë ¥") vIn.value = "18";
            else if (opt === "ë¬¼ë¦¬ í¬ë¦¬í‹°ì»¬" || opt === "ë§ˆë²• í¬ë¦¬í‹°ì»¬") vIn.value = "30";
            else if (commonValTable[opt]) vIn.value = commonValTable[opt];
        }
    }

    // ===== 3. [ì¶”ê°€ëœ ë¶€ë¶„] í˜ì§€ëŠ¥/ì†ê°• ì„ íƒì§€ì— ë”°ë¥¸ ë…¸ë€ìƒ‰ ê°•ì¡° ì‹¤í–‰ =====
    const charSection = el.closest('.char-section');
    if (charSection) {
        applySealHighlight(charSection.id);
    }

    autoSave();
}


function updateStyle(el, type, isInitial = false) {
    const row = el.closest('tr');
    let slot = el.getAttribute('data-slot');

    // [ì¶”ê°€] data-slotì´ ì—†ëŠ” í¬ë¦¬ì³ ëŒ€ì‘
    if (!slot) {
        const slotCell = el.closest('tr')?.querySelector('.col-slot');
        if (slotCell) slot = slotCell.innerText.trim();
    }

    const section = el.closest('.char-section');
    const charId = section.id;

    // ê¸°ì¡´ í´ë˜ìŠ¤ ì •ë¦¬ë¥¼ ìœ„í•œ í•„í„°
    el.className = Array.from(el.classList)
        .filter(c =>
            !c.startsWith('rare-') &&
            !c.startsWith('ex-') &&
            !c.startsWith('bg-') &&
            c !== 'prefix-selected' &&
            c !== 'prefix-tier'
        ).join(' ');

    if (el.value) {
        /* =========================
           í¬ê·€ë„ (Rarity) ì²˜ë¦¬
        ========================= */
        if (type === 'rarity') {
            const rarityClass = 'rare-' + el.value;
            el.classList.add(rarityClass);

            // [ìˆ˜ì • í¬ì¸íŠ¸] ì¹­í˜¸, ì™¸í˜•ì¹­í˜¸, ì˜¤ë¼, ì•„ë°”íƒ€ëŠ” ì•„ì´í…œì´ë¦„ ìƒ‰ìƒì„ í¬ê·€ë„ì™€ ì¼ì¹˜ì‹œí‚´
            const colorSyncSlots = ["ì¹­í˜¸", "ì™¸í˜•ì¹­í˜¸", "ì˜¤ë¼", "ì•„ë°”íƒ€"];
            const nameEl = row.querySelector(`[data-key="${slot}_itemname"]`);

            // [í¬ë¦¬ì³ ì „ìš©] ì´ë¦„ ìƒ‰ìƒì„ í¬ê·€ë„ì™€ ë™ê¸°í™”
            if (type === 'rarity' && slot === "í¬ë¦¬ì³") {
                const creatureNameEl = row.querySelector('[data-key="í¬ë¦¬ì³_name"]');
                if (creatureNameEl) {
                    creatureNameEl.className = Array.from(creatureNameEl.classList)
                        .filter(c => !c.startsWith('rare-')).join(' ');
                    creatureNameEl.classList.add('rare-' + el.value);
                }
            }

            if (nameEl) {
                // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ëª¨ë‘ ì œê±°
                nameEl.className = Array.from(nameEl.classList)
                    .filter(c => !c.startsWith('rare-')).join(' ');
                // ìƒˆë¡œìš´ í¬ê·€ë„ í´ë˜ìŠ¤ ì¶”ê°€
                nameEl.classList.add(rarityClass);
                nameEl.classList.add('itemname-color-sync');
            }

            const prefixSel = row.querySelector(`select[data-key="${slot}_prefix"]`);
            if (prefixSel) {
                const savedPrefixValue = prefixSel.getAttribute('data-saved-value') || prefixSel.value;

                const accSlots = ["ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€"];
                const specialSlots = ["ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„"];

                // [ìˆ˜ì • ë¶€ë¶„] ë¬´ê¸°ì´ë©´ì„œ ì—í”½ ë“±ê¸‰ì¼ ë•Œ ì „ìš© ì ‘ë‘ì–´ ì„¤ì •
                let optionsHTML = "";
                if (slot === "ë¬´ê¸°" && el.value === "ì—í”½") {
                    const weaponEpicPrefixes = ["", "ê´‘ì±„", "ë¶„ì‡„", "ì„ ëª…", "ê°•íƒ€"];
                    optionsHTML = weaponEpicPrefixes.map(p => `<option value="${p}">${p}</option>`).join('');
                } else if (el.value === "í‹°ì–´") {
                    optionsHTML = tierPrefixes.map(p => `<option value="${p}">${p}</option>`).join('');
                } else if (accSlots.includes(slot)) {
                    optionsHTML = accPrefixes.map(p => `<option value="${p}">${p}</option>`).join('');
                } else if (specialSlots.includes(slot)) {
                    optionsHTML = specPrefixes.map(p => `<option value="${p}">${p}</option>`).join('');
                } else {
                    optionsHTML = prefixes.map(p => `<option value="${p}">${p}</option>`).join('');
                }

                prefixSel.innerHTML = optionsHTML;
                if (savedPrefixValue) prefixSel.value = savedPrefixValue;

                updateStyle(prefixSel, 'prefix', isInitial);
            }

            // ì—í”½/ì¼ë°˜ í•„ë“œ êµì²´ ë¡œì§ (ìƒ‰ìƒ ìœ ì§€ í¬í•¨)
            if (nameEl && itemOptions[slot]) {
                replaceItemNameField(nameEl.parentElement, slot, el.value, nameEl.value, charId);
            }
            runSetCheck(slot, charId);
        }

        /* =========================
           ìµì‹œë“œ
        ========================= */
        else if (type === 'exceed') {
            // 1. ì„ íƒì§€ ë³¸ì¸ í´ë˜ìŠ¤ ìœ ì§€ (ê¸°ì¡´ ë¡œì§)
            el.classList.remove('ex-ì´ìƒ', 'ex-ì„ ë´‰', 'ex-ì˜ì§€');
            if (el.value) el.classList.add('ex-' + el.value);

            // 2. [ìˆ˜ì •] ì•„ì´í…œ ì´ë¦„ ì¹¸ì— .ex-itemname-light ì…íˆê¸°
            const nameEl = row.querySelector(`[data-key="${slot}_itemname"]`);
            if (nameEl) {
                if (el.value !== "") {
                    nameEl.classList.add('ex-itemname-light'); // ì—°í•œ ë…¹ìƒ‰ ì ìš©
                } else {
                    nameEl.classList.remove('ex-itemname-light'); // ì›ë˜ ìƒ‰ìƒìœ¼ë¡œ
                }
            }

            if (typeof runSetCheck === "function") runSetCheck(slot, charId);
        }

        /* =========================
           ì ‘ë‘ì–´ (Prefix) ì²˜ë¦¬
        ========================= */
        // ì ‘ë‘ì–´ ì„ íƒ ì‹œ ìƒ‰ìƒ í´ë˜ìŠ¤ ë¶€ì—¬ ë¶€ë¶„ ìˆ˜ì •
        else if (type === 'prefix') {
            // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì´ˆê¸°í™”
            el.classList.remove('p-blue', 'p-red', 'p-green', 'p-yellow');

            if (el.value.startsWith('T')) {
                el.classList.add('prefix-tier');
            } else if (el.value !== "") {
                el.classList.add('prefix-selected');

                // [ì¶”ê°€] ë¬´ê¸° ì „ìš© ì ‘ë‘ì–´ ìƒ‰ìƒ í´ë˜ìŠ¤ ë§¤ì¹­
                if (slot === "ë¬´ê¸°") {
                    if (el.value === "ê´‘ì±„") el.classList.add('p-blue');
                    if (el.value === "ë¶„ì‡„") el.classList.add('p-red');
                    if (el.value === "ì„ ëª…") el.classList.add('p-green');
                    if (el.value === "ê°•íƒ€") el.classList.add('p-yellow');
                }
            }
        }

        /* =========================
           í¬ë¦¬ì³ ì•„í‹°íŒ©íŠ¸ ë°°ê²½
        ========================= */
        else if (type === 'artBg') {
            el.classList.add('bg-' + el.value);
            const optSelect = el.parentElement.querySelector('.art-opt-select');
            if (optSelect) optSelect.className = 'art-opt-select bg-' + el.value;
        }

    }

    if (!isInitial) autoSave();
}


	// 1. ëª¨ë‹¬ ì—´ë¦´ ë•Œ ëª¨ë“  ì¼ê´„ ì„¤ì • ì„ íƒì§€ ì±„ìš°ê¸°
    function openRuneModal(charId) {
        currentEditingCharId = charId;
        const body = document.getElementById('runeModalBody');
        body.innerHTML = '';
        const data = charRuneData[charId];

        // 1. ë£¬ ì´ë¦„ ì„ íƒì§€ (ê³µë°± ì˜µì…˜ ì¶”ê°€)
        const batchNameSelect = document.getElementById('m-batch-rune-name');
        if (batchNameSelect) {
            batchNameSelect.innerHTML = '<option value=""></option>' + 
                runeNames.map(n => n ? `<option>${n}</option>` : '').join('');
        }

        // 2. ë£¬ ë ˆë²¨ ì„ íƒì§€ (ê¸°ì¡´ ë™ì¼)
        const batchRuneLvSelect = document.getElementById('m-batch-rune-lv');
        if (batchRuneLvSelect) {
            batchRuneLvSelect.innerHTML = runeLevels.map(lv => `<option>${lv}</option>`).join('');
        }

        // 3. ìŠ¤í‚¬ ë ˆë²¨ ì„ íƒì§€ (ê³µë°± ì˜µì…˜ì´ ì´ë¯¸ ìˆë‹¤ë©´ ìœ ì§€, ì—†ë‹¤ë©´ ëª…ì‹œì  ì¶”ê°€)
        const batchSkillSelect = document.getElementById('m-batch-skill-lv');
        if (batchSkillSelect) {
            batchSkillSelect.innerHTML = '<option value=""></option>' + 
                runeSkillLevels.filter(lv => lv !== "").map(lv => `<option>${lv}</option>`).join('');
        }

        // í•˜ë‹¨ 20ê°œ í–‰ ìƒì„± ë¡œì§ (ê¸°ì¡´ ë™ì¼)
        for(let i=0; i<20; i++) {
            const r = data.runes[i] || { name: '', lv: '', skillLv: '' };
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="col-m-num">${i+1}</td>
                <td><select class="m-rune-name">${runeNames.map(n=>`<option ${r.name===n?'selected':''}>${n}</option>`).join('')}</select></td>
                <td><select class="m-rune-lv">${runeLevels.map(n=>`<option ${r.lv===n?'selected':''}>${n}</option>`).join('')}</select></td>
                <td><select class="m-rune-skillLv">${runeSkillLevels.map(n=>`<option ${r.skillLv===n?'selected':''}>${n}</option>`).join('')}</select></td>`;
            body.appendChild(tr);
        }
        document.getElementById('m-gakin1').value = data.gakin[0];
        document.getElementById('m-gakin2').value = data.gakin[1];
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('skillRunemodal').style.display = 'block';
    }

	function setAllRunesBatch() {
        const selectedName = document.getElementById('m-batch-rune-name').value;
        const body = document.getElementById('runeModalBody');
        const rows = body.querySelectorAll('tr');
        
        rows.forEach(row => {
            const nameSelect = row.querySelector('.m-rune-name');
            
            // ì´ë¦„ë§Œ ì„ íƒí•œ ê²ƒìœ¼ë¡œ ë³€ê²½ (ë£¬ ë ˆë²¨ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
            if (nameSelect) {
                nameSelect.value = selectedName;
            }
        });
    }
	
	// 2. [ì¶”ê°€] ë£¬ ë ˆë²¨(I~V)ë§Œ ì¼ê´„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
    function setAllRuneLevels() {
        const selectedRuneLv = document.getElementById('m-batch-rune-lv').value;
        const body = document.getElementById('runeModalBody');
        const rows = body.querySelectorAll('tr');
        
        rows.forEach(row => {
            const lvSelect = row.querySelector('.m-rune-lv');
            if (lvSelect) lvSelect.value = selectedRuneLv;
        });
    }
	
	// 2. [ì¶”ê°€] ìŠ¤í‚¬ ë ˆë²¨ë§Œ ì¼ê´„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
    function setAllSkillLevels() {
        const selectedSkillLv = document.getElementById('m-batch-skill-lv').value;
        const body = document.getElementById('runeModalBody');
        const rows = body.querySelectorAll('tr');
        
        rows.forEach(row => {
            const skillLvSelect = row.querySelector('.m-rune-skillLv');
            if (skillLvSelect) {
                skillLvSelect.value = selectedSkillLv;
            }
        });
    }
	
    function closeRuneModal() { document.getElementById('modalOverlay').style.display = 'none'; document.getElementById('skillRunemodal').style.display = 'none'; }
    
    function saveRuneData() {
    const body = document.getElementById('runeModalBody');
    const rows = body.querySelectorAll('tr');
    const newRunes = [];
    rows.forEach(row => { 
        newRunes.push({ name: row.querySelector('.m-rune-name').value, lv: row.querySelector('.m-rune-lv').value, skillLv: row.querySelector('.m-rune-skillLv').value }); 
    });
    const section = document.getElementById(currentEditingCharId);
    const charName = section.querySelector('[data-key="info_name"]').value || "ì´ë¦„ì—†ìŒ";
    const now = new Date();
    const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
    
    // ê¸°ë¡ ì¶”ê°€
    changeHistory.unshift({ time: timeStr, charName: charName, slot: "ìŠ¤í‚¬ë£¬", old: "ê¸°ì¡´ ì„¤ì •", new: "ìƒˆë¡œìš´ ì„¤ì •ìœ¼ë¡œ ë³€ê²½ë¨" });
    if (changeHistory.length > 10) changeHistory.pop();
    
    // [ì €ì¥ ì¶”ê°€]
    saveHistory();

    charRuneData[currentEditingCharId] = { runes: newRunes, gakin: [document.getElementById('m-gakin1').value, document.getElementById('m-gakin2').value] };
    updateRuneSummary(currentEditingCharId); 
    closeRuneModal(); 
    autoSave();
}

// updateRuneSummary í•¨ìˆ˜ ë‚´ë¶€ì— ì ìš©
function updateRuneSummary(charId) {
    const summaryEl = document.getElementById(`${charId}_runeSummary`);
    const data = charRuneData[charId];
    const activeRunes = data.runes.filter(r => r.name !== '');

    let runeStr = "ì„¤ì •ëœ ë£¬ ì—†ìŒ";
    if(activeRunes.length > 0) {
        const runeMap = new Map();
        activeRunes.forEach(r => {
            const effectiveSkillLv = noSkillLvRunes.includes(r.name) ? "" : r.skillLv;
            const key = `${r.name}|${r.lv}|${effectiveSkillLv}`;
            if(runeMap.has(key)) runeMap.get(key).count += 1; else runeMap.set(key, { ...r, count: 1 });
        });

        const summaryArray = [];
        runeMap.forEach((val) => {
            const skillLv = (noSkillLvRunes.includes(val.name) || !val.skillLv) ? "" : `[${val.skillLv}]`;

            // --- ê°€ë…ì„± í–¥ìƒ ì ìš© ë¶€ë¶„ ---
            let lvColor = "#ddd"; // ê¸°ë³¸ ìƒ‰ìƒ
            // if (val.lv === 'V') lvColor = "#ffb444"; // 5ë ˆë²¨ì€ ê¸ˆìƒ‰
            // else
            if (val.lv === 'IV') lvColor = "#888"; // 4ë ˆë²¨ì€ ë³´ë¼ìƒ‰

            summaryArray.push(`<span style="color:${lvColor}">${val.name}${val.lv}</span>${skillLv} <span style="color:#888;">${val.count}ê°œ</span>`);
            // ---------------------------
        });
        runeStr = summaryArray.join(' <span style="color:#444; margin:0 4px;">|</span> ');
    }

    let gakinContent = "";
    const g2 = data.gakin[1] || "";
    if (g2) {
        gakinContent = `<span class="v-line"></span> <span style="color:var(--gakin-2);">${g2}</span>`;
    }
    summaryEl.innerHTML = runeStr + gakinContent;
}
    
    function resetRuneData(charId) { 
    if(confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { 
        const section = document.getElementById(charId);
        const charName = section.querySelector('[data-key="info_name"]').value || "ì´ë¦„ì—†ìŒ";

        // [ìˆ˜ì •ëœ ë¶€ë¶„] ë‚ ì§œ í˜•ì‹ ë³€ê²½
        const timeStr = getCurrentDateTime();

        // ê¸°ë¡ ì¶”ê°€
        changeHistory.unshift({ time: timeStr, charName: charName, slot: "ìŠ¤í‚¬ë£¬", old: "ê¸°ì¡´ ì„¤ì •", new: "ë°ì´í„° ì´ˆê¸°í™”ë¨" });
        if (changeHistory.length > 10) changeHistory.pop();
        
        // [ì €ì¥ ì¶”ê°€]
        saveHistory();

        charRuneData[charId] = { runes: Array(20).fill().map(() => ({ name: '', lv: '', skillLv: '' })), gakin: ['', ''] }; 
        updateRuneSummary(charId); 
        autoSave(); 
    } 
}

    function openHistoryModal() {
        const listEl = document.getElementById('historyList');
        if (changeHistory.length === 0) { listEl.innerHTML = "ë³€ê²½ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."; }
        else { listEl.innerHTML = changeHistory.map(h => `<div style="border-bottom:1px solid #333; padding:5px 0;"><span style="color:var(--gold)">[${h.time}]</span> <b>${h.charName}</b> - ${h.slot}: <br>${getSpanWithColor(h.old)} â†’ ${getSpanWithColor(h.new)}</div>`).join(''); }
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('historyModal').style.display = 'block';
    }
    function closeHistoryModal() { document.getElementById('modalOverlay').style.display = 'none'; document.getElementById('historyModal').style.display = 'none'; }

// 1. autoSave í•¨ìˆ˜ ìˆ˜ì •: ìŠ¤ëƒ…ìƒ· ì—…ë°ì´íŠ¸ ë¡œì§ì„ ì œê±°í•˜ê³  'ì €ì¥'ì—ë§Œ ì§‘ì¤‘í•©ë‹ˆë‹¤.
function autoSave() {
    clearTimeout(window.sTime);
    window.sTime = setTimeout(() => {
        const allData = Array.from(document.querySelectorAll('.char-section')).map(sec => {
            const inputsObj = {};
            // [ìˆ˜ì •] textarea[data-key]ë¥¼ ì¶”ê°€í•˜ì—¬ ì„¤ëª… ì¹¸ ë°ì´í„°ë¥¼ í¬í•¨ì‹œí‚µë‹ˆë‹¤.
            sec.querySelectorAll('input[data-key], select[data-key], textarea[data-key]').forEach(el => {
                inputsObj[el.getAttribute('data-key')] = {
                    val: el.value,
                    cls: el.className
                };
            });
            return {
                id: sec.id,
                locked: sec.querySelector('.lock-btn')?.classList.contains('btn-active'),
                inputs: inputsObj,
                runeData: charRuneData[sec.id]
            };
        });

        localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));

        const msg = document.getElementById('statusMsg');
        if (msg) {
            msg.innerText = "ğŸ’¾ ì €ì¥ë¨";
            setTimeout(() => msg.innerText = "", 1000);
        }
    }, 800);
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Tab') {
        const activeEx = document.activeElement;
        const key = activeEx.getAttribute('data-key') || "";
        const section = activeEx.closest('.char-section');
        if (!section) return;

        e.preventDefault(); // ê¸°ë³¸ ê°€ë¡œ ì´ë™ ë°©ì§€ (ì„¸ë¡œ ì´ë™ ìœ ì§€)

        // 1. [ì„¤ëª… ì¹¸ ì „ìš© ë¡œì§] ì¹­í˜¸ textarea í¬í•¨
        if (activeEx.tagName === 'TEXTAREA' || key.endsWith('_desc')) {
            const descFields = Array.from(section.querySelectorAll('input[data-key$="_desc"], textarea[data-key$="_desc"]'));
            const currentIndex = descFields.indexOf(activeEx);

            if (e.shiftKey) { // ìœ„ë¡œ ì´ë™
                if (currentIndex > 0) descFields[currentIndex - 1].focus();
            } else { // ì•„ë˜ë¡œ ì´ë™
                if (currentIndex < descFields.length - 1) descFields[currentIndex + 1].focus();
            }
            return;
        }

        // 2. [ì¼ë°˜ ì¹¸ ì „ìš© ë¡œì§] í¬ê·€ë„, ì•„ì´í…œì´ë¦„, ê°•í™” ë“± ëª¨ë“  ì¼ë°˜ ì¹¸
        const currentSlot = activeEx.getAttribute('data-slot') || key.split('_')[0];
        const suffix = key.replace(currentSlot, '');
        const currentIndex = slots.indexOf(currentSlot);
        
        let nextIndex = e.shiftKey ? currentIndex - 1 : currentIndex + 1;

        if (nextIndex >= 0 && nextIndex < slots.length) {
            const nextSlot = slots[nextIndex];
            const targetInput = section.querySelector(`[data-key="${nextSlot}${suffix}"]`);
            
            // íƒ€ê²Ÿ ì¹¸ì´ ì¡´ì¬í•˜ë©´ ì´ë™ (ì™¸í˜•ì¹­í˜¸ì˜ ì¼ë°˜ ì¹¸ë“¤ë„ ì´ì œ ì •ìƒì ìœ¼ë¡œ í¬í•¨ë¨)
            if (targetInput && !targetInput.disabled) {
                targetInput.focus();
                if (targetInput.select) targetInput.select();
            }
        }
    }
});

// 2. change ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì •: ê¸°ë¡ ì§í›„ ìŠ¤ëƒ…ìƒ·ì„ ì¦‰ì‹œ ê°±ì‹ í•˜ì—¬ ì‹œì°¨ë¥¼ ì—†ì•±ë‹ˆë‹¤.
document.addEventListener('change', function(e) {
    const el = e.target;
    const key = el.getAttribute('data-key');
    if (!key) return;

    const section = el.closest('.char-section');
    if (!section) return; // ì„¹ì…˜ì´ ì—†ìœ¼ë©´ ì¤‘ë‹¨

    // 1. ê¸°ì¡´ ë°ì´í„° ë³€ê²½ ë° íˆìŠ¤í† ë¦¬ ë¡œì§ (ìœ ì§€)
    const charName = section.querySelector('[data-key="info_name"]').value || "ì´ë¦„ì—†ìŒ";
    const slot = key.split('_')[0];
    const prevChar = lastSnapshot.find(c => c.id === section.id);
    const oldVal = (prevChar && prevChar.inputs && prevChar.inputs[key]) ? prevChar.inputs[key].val : "";
    const newVal = el.value;

    if (oldVal !== newVal) {
        // [ìˆ˜ì •ëœ ë¶€ë¶„] ë‚ ì§œ í˜•ì‹ ë³€ê²½
        const timeStr = getCurrentDateTime();

        changeHistory.unshift({
            time: timeStr,
            charName: charName,
            slot: slot,
            old: (oldVal === "" ? "(ë¹ˆì¹¸)" : oldVal),
            new: (newVal === "" ? "(ë¹ˆì¹¸)" : newVal)
        });
        if (changeHistory.length > 10) changeHistory.pop();

        saveHistory();
        updateLastSnapshot();

        // --- [í•µì‹¬ ìˆ˜ì • ë¶€ë¶„] ---
        // 1. ìƒë‹¨ ì†ì„±/ìŠ¤íƒ¯ ì„ íƒì§€ê°€ ë°”ë€” ë•Œ
        // 2. í˜¹ì€ ìŠ¬ë¡¯ì˜ ì— ë¸”ë ˜(_emb)ì´ë‚˜ ë´‰ì¸ì„(_seal) ì„ íƒì§€ê°€ ë°”ë€” ë•Œ
        // ì•„ë˜ ì¡°ê±´ë¬¸ì„ í†µí•´ ë¬´ì¡°ê±´ ê°•ì¡° í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤.
        if (key.includes('info_stat_type') ||
            key.includes('info_ele_type') ||
            key.includes('_emb') ||
            key.includes('_seal')) {

            applySealHighlight(section.id);
        }
        // -----------------------
    }
});
	
	
	// ---------------------------------------------------------
    // ìºë¦­í„° ì‚­ì œ í•¨ìˆ˜ (ì¤‘ë³µ ì œê±° ë° ì ê¸ˆ ì²´í¬ í†µí•© ë²„ì „)
    // ---------------------------------------------------------
    function deleteCharacter(charId) {
        const section = document.getElementById(charId);
        if (!section) return;

        // ì ê¸ˆ ë²„íŠ¼ì´ 'btn-active' í´ë˜ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸ (ì ê¸ˆ ìƒíƒœ ì²´í¬)
        const lockBtn = section.querySelector('.lock-btn');
        const isLocked = lockBtn && lockBtn.classList.contains('btn-active');

        if (isLocked) {
            alert("ìºë¦­í„°ê°€ ì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤. 'í•´ì œ' ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ ì‚­ì œí•´ì£¼ì„¸ìš”.");
            return;
        }

        if(confirm("ì •ë§ë¡œ ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            section.remove();
            delete charRuneData[charId]; // ë©”ëª¨ë¦¬ì—ì„œ ë£¬ ë°ì´í„° ì‚­ì œ
            autoSave(); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì¦‰ì‹œ ê°±ì‹ 
            
            const statusMsg = document.getElementById('statusMsg');
            if (statusMsg) {
                statusMsg.innerText = "ìºë¦­í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.";
                setTimeout(() => statusMsg.innerText = "", 2000);
            }
        }
    }
	
	
function applySealHighlight(charId) {
    const section = document.getElementById(charId);
    if (!section) return;

    const statType = section.querySelector(`select[data-key="info_stat_type"]`)?.value || "";
    const eleType  = section.querySelector(`select[data-key="info_ele_type"]`)?.value || "";

    const armorSlots   = ["ìƒì˜", "ì–´ê¹¨", "í•˜ì˜", "ì‹ ë°œ", "ë²¨íŠ¸"];
    const accSlots     = ["ëª©ê±¸ì´", "íŒ”ì°Œ", "ë°˜ì§€"];
    const specialSlots = ["ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„"];
    const embHighlightSlots = ["ë³´ì¡°ì¥ë¹„", "ê·€ê±¸ì´", "ë§ˆë²•ì„", "ì¹­í˜¸"];

    /* =========================
       tr ìºì‹±
    ========================= */
    const rows = Array.from(section.querySelectorAll('tr'));
    const rowMap = {};
    rows.forEach(r => {
        const slotName = r.querySelector('.col-slot')?.innerText;
        if (slotName) rowMap[slotName] = r;
    });

    slots.forEach(slot => {
        if (slot === "ìŠ¤í‚¬ë£¬" || slot === "í¬ë¦¬ì³") return;
        const row = rowMap[slot];
        if (!row) return;

        const s1 = row.querySelector(`select[data-key="${slot}_seal1"]`);
        const v1 = row.querySelector(`input[data-key="${slot}_seal1_val"]`);
        const s2 = row.querySelector(`select[data-key="${slot}_seal2"]`);
        const v2 = row.querySelector(`input[data-key="${slot}_seal2_val"]`);
        const emb1 = row.querySelector(`[data-key="${slot}_emb1"]`);
        const emb2 = row.querySelector(`[data-key="${slot}_emb2"]`);

        [s1, v1, s2, v2, emb1, emb2].forEach(el =>
            el?.classList.remove('highlight-yellow')
        );

        if (s1 && s2) {
            if (slot === "ë¬´ê¸°" && statType) {
                if (s1.value === "ë°ë¯¸ì§€ ì¦ê°€") {
                    s1.classList.add('highlight-yellow');
                    v1?.classList.add('highlight-yellow');
                }
                if (s2.value === statType) {
                    s2.classList.add('highlight-yellow');
                    v2?.classList.add('highlight-yellow');
                }
            }

            if ((armorSlots.includes(slot) || specialSlots.includes(slot)) && statType) {
                if (s1.value === statType) {
                    s1.classList.add('highlight-yellow');
                    v1?.classList.add('highlight-yellow');
                }
                if (s2.value === statType) {
                    s2.classList.add('highlight-yellow');
                    v2?.classList.add('highlight-yellow');
                }
            }

            if (accSlots.includes(slot) && eleType) {
                if (s1.value === eleType) {
                    s1.classList.add('highlight-yellow');
                    v1?.classList.add('highlight-yellow');
                }
                if (s2.value === eleType) {
                    s2.classList.add('highlight-yellow');
                    v2?.classList.add('highlight-yellow');
                }
            }
        }

        /* =========================
           ì— ë¸”ë ˜ ì†ê°• ê°•ì¡°
        ========================= */
        if (embHighlightSlots.includes(slot) && eleType) {
            if (emb1 && (emb1.value === eleType || emb1.value === "ëª¨ì†ê°•")) {
                emb1.classList.add('highlight-yellow');
                emb2?.classList.add('highlight-yellow');
            }
        }
    });
}


function replaceItemNameField(parentTd, slot, rarity, value, charId) {
    const oldEl = parentTd.querySelector(`[data-key="${slot}_itemname"]`);
    if (oldEl) oldEl.remove();

    // í˜„ì¬ ìºë¦­í„°ì˜ ì ê¸ˆ ìƒíƒœ í™•ì¸
    const section = document.getElementById(charId);
    const isLocked = section?.querySelector('.lock-btn')?.classList.contains('btn-active');

    let newEl;
    if (rarity === "ì—í”½") {
        newEl = document.createElement('select');
        newEl.innerHTML = `<option value=""></option>` +
            (itemOptions[slot] || []).map(opt =>
                `<option value="${opt}">${opt}</option>`
            ).join('');
        
        // ì ê¸ˆ ìƒíƒœë¼ë©´ select ë¹„í™œì„±í™”
        if (isLocked) newEl.disabled = true;
    } else {
        newEl = document.createElement('input');
        newEl.type = 'text';
        
        // ì ê¸ˆ ìƒíƒœë¼ë©´ input ì½ê¸° ì „ìš© ë° ì»¤ì„œ ë³€ê²½
        if (isLocked) {
            newEl.readOnly = true;
            newEl.style.cursor = "default";
        }
    }

    newEl.value = value || "";
    newEl.setAttribute('data-key', `${slot}_itemname`);
    newEl.className = `rare-${rarity} itemname-color-sync`;

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
    newEl.addEventListener('change', () => {
        runSetCheck(slot, charId);
        autoSave();
    });
    newEl.addEventListener('input', () => {
        runSetCheck(slot, charId);
        autoSave();
    });

    parentTd.appendChild(newEl);
    
    // ì„¸íŠ¸ ìƒ‰ìƒ ì¦‰ì‹œ ì ìš©
    runSetCheck(slot, charId);

    const exceedSel = parentTd.closest('tr').querySelector(`select[data-key="${slot}_exceed"]`);
    if (exceedSel && exceedSel.value !== "") {
        newEl.classList.add('ex-itemname-light'); // ìƒˆë¡œ ë§Œë“  ì¹¸ì— ì—°í•œ ë…¹ìƒ‰ ì…íˆê¸°
    }
}

function updateLastSnapshot() {
    lastSnapshot = Array.from(document.querySelectorAll('.char-section')).map(sec => {
        const inputsObj = {};
        sec.querySelectorAll('input[data-key], select[data-key]').forEach(el => {
            inputsObj[el.getAttribute('data-key')] = { val: el.value };
        });
        return { id: sec.id, inputs: inputsObj };
    });
}

window.onload = () => { 
    console.log("í˜ì´ì§€ ë¡œë”© ì™„ë£Œ: ë°ì´í„° ë³µêµ¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.");
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const storageData = localStorage.getItem(STORAGE_KEY);
    let parsedList = [];
    
    try {
        parsedList = JSON.parse(storageData || "[]");
    } catch (e) {
        console.error("ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜ ë°œìƒ:", e);
        parsedList = [];
    }
    
    // í™”ë©´ ì´ˆê¸°í™”
    const container = document.getElementById('characterContainer');
    if (container) container.innerHTML = "";

    // ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ í…Œì´ë¸” ìƒì„±
    if (parsedList && parsedList.length > 0) {
        parsedList.forEach(data => {
            // ì´ ì‹œì ì—ì„œ dataê°€ í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ savedDataë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
            createCharacterTable(data); 
        });
    } else {
        createCharacterTable(); 
    }

    // ë³€ê²½ ì´ë ¥ ì¶”ì ì„ ìœ„í•œ ìŠ¤ëƒ…ìƒ· ìƒì„±
    if (typeof updateLastSnapshot === "function") {
        updateLastSnapshot(); 
    }
};

// ëª¨ë“  ìºë¦­í„°ë¥¼ í•œ ë²ˆì— ì ê·¸ëŠ” í•¨ìˆ˜
function lockAllCharacters() {
    // í™”ë©´ì— ìˆëŠ” ëª¨ë“  ìºë¦­í„° ì„¹ì…˜ì„ ì°¾ìŒ
    const allSections = document.querySelectorAll('.char-section');
    
    if (allSections.length === 0) return;

    if (confirm("ëª¨ë“  ìºë¦­í„°ë¥¼ ì ê¸ˆ ìƒíƒœë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        allSections.forEach(section => {
            const charId = section.id;
            // ê¸°ì¡´ì— ì‘ì„±ëœ toggleEdit í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ 'ì ê¸ˆ(true)' ìƒíƒœë¡œ ë§Œë“¦
            toggleEdit(charId, true);
        });
        
        // ìƒíƒœ ì €ì¥ ì•Œë¦¼ (ì„ íƒ ì‚¬í•­)
        const statusMsg = document.getElementById('statusMsg');
        if (statusMsg) {
            statusMsg.innerText = "ğŸ”’ ëª¨ë“  ìºë¦­í„°ê°€ ì ê²¼ìŠµë‹ˆë‹¤.";
            setTimeout(() => statusMsg.innerText = "", 2000);
        }
    }
}

function moveCharacter(charId, direction) {
    const section = document.getElementById(charId);
    if (!section) return;

    if (direction === 'up') {
        const prev = section.previousElementSibling;
        if (prev && prev.classList.contains('char-section')) {
            section.parentNode.insertBefore(section, prev);
        }
    } else {
        const next = section.nextElementSibling;
        if (next && next.classList.contains('char-section')) {
            section.parentNode.insertBefore(next, section);
        }
    }

    // ìˆœì„œê°€ ë°”ë€Œì—ˆìœ¼ë¯€ë¡œ ìŠ¤ëƒ…ìƒ· ê°±ì‹  ë° ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥
    updateLastSnapshot(); 
    autoSave();
    
    // ì‹œê°ì  í”¼ë“œë°± (ì„ íƒì‚¬í•­)
    section.style.boxShadow = "0 0 10px var(--gold)";
    setTimeout(() => section.style.boxShadow = "", 500);
}


// ìºë¦­í„° ë°ì´í„°ì™€ ë³€ê²½ ì´ë ¥ì„ ë‚ ì§œë¥¼ í¬í•¨í•œ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥í•˜ëŠ” í†µí•© í•¨ìˆ˜
function exportToJSON() { 
    const charData = localStorage.getItem(STORAGE_KEY); 
    const historyData = localStorage.getItem(STORAGE_KEY + "_history"); 
    
    if(!charData) return alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); 

    // 1. ë‚ ì§œ ë° ì‹œê°„ ë°ì´í„° ìƒì„± (ë…„-ì›”-ì¼_ì‹œ-ë¶„)
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    
    // íŒŒì¼ëª… êµ¬ì„±: dnfm_character_equipment_backup_2024-05-20_14-30.json
    const fileName = `dnfm_character_equipment_backup_${year}-${month}-${day}_${hours}-${minutes}.json`;

    // 2. í†µí•© ë°±ì—… ê°ì²´ ìƒì„±
    const backup = {
        characters: JSON.parse(charData),
        history: historyData ? JSON.parse(historyData) : []
    };

    // 3. íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬
    const blob = new Blob([JSON.stringify(backup)], { type: "application/json" }); 
    const a = document.createElement("a"); 
    a.href = URL.createObjectURL(blob); 
    a.download = fileName; // ìš”ì²­í•˜ì‹  ë‚ ì§œ í¬í•¨ íŒŒì¼ëª… ì ìš©
    a.click(); 

    // ë©”ëª¨ë¦¬ ì •ë¦¬
    setTimeout(() => URL.revokeObjectURL(a.href), 1000);
}

function importFromJSON(input) { 
    const reader = new FileReader(); 
    reader.onload = (e) => { 
        try { 
            const importedData = JSON.parse(e.target.result); 
            let charactersToRestore = [];
            let historyToRestore = [];

            // 1. ë°ì´í„° êµ¬ì¡° íŒë³„ (í•˜ì´ë¸Œë¦¬ë“œ ì²´í¬)
            if (Array.isArray(importedData)) {
                // [êµ¬í˜•] íŒŒì¼ì´ ë°”ë¡œ ë°°ì—´ì¸ ê²½ìš° (ìºë¦­í„° ë°ì´í„°ë§Œ ìˆìŒ)
                charactersToRestore = importedData;
                historyToRestore = []; // ê¸°ì¡´ ê¸°ë¡ì€ ë¹„ì›Œë‘ 
            } else if (importedData && importedData.characters) {
                // [ì‹ í˜•] characters í‚¤ë¥¼ ê°€ì§„ ê°ì²´ì¸ ê²½ìš°
                charactersToRestore = importedData.characters;
                historyToRestore = importedData.history || [];
            } else {
                throw new Error("ì§€ì›í•˜ì§€ ì•ŠëŠ” ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.");
            }

            // 2. í™”ë©´ ì´ˆê¸°í™” ë° ìºë¦­í„° ìƒì„±
            document.getElementById('characterContainer').innerHTML = ""; 
            charRuneData = {}; 
            charactersToRestore.forEach(d => createCharacterTable(d)); 

            // 3. ê¸°ë¡ ë³µêµ¬ (ê¸°ì¡´ ê¸°ë¡ êµì²´)
            changeHistory = historyToRestore;

            // 4. ë³µêµ¬ ì™„ë£Œ ë¡œê·¸ ì¶”ê°€ [ìˆ˜ì •ëœ ë¶€ë¶„]
            const timeStr = getCurrentDateTime();
            changeHistory.unshift({ 
                time: timeStr, 
                charName: "ì‹œìŠ¤í…œ", 
                slot: "ë°ì´í„° ë³µêµ¬", 
                old: "-", 
                new: "ë°±ì—… íŒŒì¼ë¡œë¶€í„° ë°ì´í„°ê°€ ë³µì›ë¨" 
            });
            
            if (changeHistory.length > 10) changeHistory.pop();

            // 5. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ìµœì¢… ì €ì¥ ë° ë™ê¸°í™”
            saveHistory(); // ê¸°ë¡ ì €ì¥
            autoSave();    // ìºë¦­í„° ë°ì´í„° ì €ì¥ (ì´ ì•ˆì—ì„œ localStorage.setItem(STORAGE_KEY) ì‹¤í–‰)
            
            alert("ë°ì´í„° ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch(err) { 
            alert("íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + err.message);
            console.error(err);
        } 
    }; 
    reader.readAsText(input.files[0]); 
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë°°ê²½ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
document.addEventListener('DOMContentLoaded', () => {
    const overlay = document.getElementById('modalOverlay');
    
    if (overlay) {
        overlay.addEventListener('click', () => {
            // ì—´ë ¤ ìˆì„ ìˆ˜ ìˆëŠ” ëª¨ë“  ëª¨ë‹¬ì„ ë‹«ìŒ
            if (typeof closeHistoryModal === "function") closeHistoryModal();
            if (typeof closeRuneModal === "function") closeRuneModal();
            
            // ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë‹¤ë¥¸ ëª¨ë‹¬ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€
            // ì˜ˆ: document.getElementById('historyModal').style.display = 'none';
        });
    }
});

</script>
</body>
</html>